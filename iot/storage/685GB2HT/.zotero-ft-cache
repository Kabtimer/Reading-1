This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JIOT.2018.2828867, IEEE Internet of Things Journal

1
LoRaWAN: Evaluation of Link- and System-Level Performance
Luca Feltrin, Chiara Buratti, Member, IEEE, Enrico Vinciarelli, Roberto De Bonis, Member, IEEE Roberto Verdone, Member, IEEE,

Abstract—The Internet of Things (IoT) addresses a huge set of possible application domains, requiring both short- and long-range communication technologies. When long distances are present, a number of proprietary and standard solutions for Low Power Wide Area Networks (LPWAN) are already available. Among them, LoRaWAN is a candidate technology supported by many network operators. This paper discusses the possible role of LoRaWAN for the IoT. First, the LoRaWAN technology is assessed experimentally through a set of laboratory and on-ﬁeld tests, to characterize it from the link-level viewpoint; then, a system-level analysis is performed through simulation, to evaluate the capacity of a LoRaWAN gateway and a multigateway network to serve a large area. Finally, the results are discussed considering a broad set of use cases.
Index Terms—Internet of Things (IoT), LoRa, LPWAN, Use Case, Protection Ratio, Capacity
I. INTRODUCTION
T HE Internet of Things (IoT) is emerging as a set of integrated technologies, new solutions and services, which are expected to change the way people live and produce (or beneﬁt from) goods. The IoT paradigm, making all unmanned ”things” (daily objects, industry machines, sensors, robots, animals, etc.) connected to the Internet, addresses a very large set of application domains. Some of them require shortrange radio communication technologies (like Zigbee), being the network nodes conﬁned in restricted areas; others, like precision agriculture, environmental monitoring, or animal tracking, may require communication solutions able to cover distances up to (or more than) 10 km in rural areas. Recently, the interest of industry towards the latter category, denoted as Low Power Wide Area Networks (LPWAN), grew signiﬁcantly [1].
Some proprietary solutions, working on license-exempt spectrum bands, are already deployed in some regions: as an example, Sigfox1 operates both as a technology and a service provider for LPWAN; another big player is the LoRa Alliance2, which was ofﬁcially established in Mobile World Congress 2015 and produced a proprietary solution known as LoRaWAN working in the license-exempt band, available in many countries, close to 900 MHz.
L. Feltrin, C. Buratti and R. Verdone are with DEI, University of Bologna, Italy, e-mails: {roberto.verdone, luca.feltrin, c.buratti}@unibo.it.
E. Vinciarelli and R. De Bonis are with TIM, Telecom Italia Mobile, Torino, Italy, emails: {enrico.vinciarelli, roberto.debonis}@telecomitalia.it.
Copyright (c) 2012 IEEE. Personal use of this material is permitted. However, permission to use this material for any other purposes must be obtained from the IEEE by sending a request to pubs-permissions@ieee.org.
1Sigfox, http://www.sigfox.com/en/ 2LoRa alliance, https://www.lora-alliance.org/.

Meanwhile, the 3GPP is supporting three different LPWAN standards that will work on the licensed spectrum of mobile networks and will be commercially available by the end of 2017: Extended Coverage GSM (EC-GSM-IoT), LTE Machine Type Communications Category M1 (LTE-MTC Cat M1) and Narrowband IoT (NB-IoT). The latter technology has technical characteristics similar to LPWAN proprietary solutions, with the advantage of being a standard; many mobile network operators worldwide are supporting the development of NB-IoT, which might become a future reference IoT communication technology for several application domains. In the meanwhile, some network operators are pushing the LoRaWAN technology and supporting the developers’ community [2].
In this context, made of many evolving technologies, it can be expected that a single one will not be capable of addressing efﬁciently all the different IoT use cases. It is in the interest of big players, to identify the range of applications that make a speciﬁc technology suitable. In particular, LoRaWAN is available since some time and industry is starting using it, but it is still not clear what are its true potentials. This paper shows results of an ongoing project developed at the University of Bologna supported by Telecom Italia Mobile, aimed at deﬁning the technical limits of LoRaWAN and the opportunities it provides from both a link- and system-level points of view. As an outcome of this activity, LoRaWAN network capacity, deﬁned in terms of maximum number of devices that can coexist in the same network, is assessed in single and multi-cell scenarios, under realistic trafﬁc conditions.
Results show that only certain conﬁgurations are preferable to achieve high capacity, and the presence of multiple gateways improves considerably this performance indicator.
In Section II the main aspects of the LoRaWAN technology are presented. After a short overview of the most recent literature presented in Section III, section IV discusses how the results of few reference use cases can be extended to a broader set. In Section V the LoRa technology is assessed through a set of experimental laboratory and on-ﬁeld tests, to characterize it from the link-level viewpoint. The information gathered during these experiments, in terms of ranging capabilities and interference resilience, is used in Section VI to discuss the design and performance of a network deployed, ﬁrst, in a small area employing a single gateway, and then in a larger area. The paper draws ﬁnal conclusions in Section VII.

2327-4662 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JIOT.2018.2828867, IEEE Internet of Things Journal

2

TABLE I DATARATE DEFINITION FOR EU863-870

Data Rate (DR) DR0 DR1 DR2 DR3 DR4 DR5 DR6

Conﬁguration
SF12 / 125 kHz SF11 / 125 kHz SF10 / 125 kHz SF9 / 125 kHz SF8 / 125 kHz SF7 / 125 kHz SF7 / 250 kHz

Indicative physical bit rate [bit/s] 250 440 980 1760 3125 5470 11000

II. LORAWAN TECHNOLOGY
A. PHY Layer
LoRaWAN uses a proprietary modulation based on chirp spread spectrum, which exploits pulses whose frequency increases or decreases linearly over a certain amount of time; information is inserted in these pulses by introducing a discontinuity at different time offsets from the beginning of a symbol. These pulses occupy a bandwidth (BW) which can typically take values of 125, 250 or 500 kHz. Interference problems are mitigated by employing forward error correcting codes in combination with frequency hopping spread spectrum. For the simulations performed in this work, we considered a network using three 125 kHz bands, from 868 MHz to 868.6 MHz, corresponding to the EU868-870 sub-band G1.
One of the most important parameters affecting the performance at physical level is the Spreading Factor (SF), that is, the ratio between the signal bandwidth and the symbol rate. Keeping the bandwidth constant, it is possible to enhance the receiver sensitivity by increasing the time on air (duration of a packet transmission). More precisely, each increment of the SF by one unit, from the minimum value 6 to the maximum value 12, corresponds to a doubling of the time on air and a decrement of the receiver sensitivity of roughly three dB. As a reference case, with BW=125 kHz, the receiver sensitivity at the end device is -125 dBm and -137 dBm, for SF=7 and 12, respectively. Transmissions with different SFs are claimed to be orthogonal.
The documentation refers often to the Data Rate (DR) rather than the SF directly. In the LoRaWAN documentation framework, each DR value corresponds to a speciﬁc combination of SF and BW. This correspondence, deﬁned in the LoRa Speciﬁcations [3], is reported in Table I. It is clear that, for most of the possible settings, an increment of the DR directly corresponds to a decrement of the SF [4], [5].
B. MAC Layer
The LoRaWAN MAC describes three Classes: i) Class A: end devices, after the transmission of a packet, open two receive windows to get an acknowledgement (ACK) or receive data from the gateway, then they stay in idle mode until the next transmission; ii) Class B: end devices have more receive windows synchronized with a beacon provided by the gateway; iii) Class C: end devices continuously stay in reception mode.

LoRaWAN networks form a star topology rooted at a LoRaWAN gateway, and any device has to be compliant with, at least, Class A (considered in this paper), where in uplink ALOHA protocol is used. There are two types of transmission mode: conﬁrmed, using ACKs, and unconﬁrmed, when no ACKs are used. When an ACK is expected but not received by the transmitter, a recovery algorithm, which consists in multiple retransmissions, is initiated. The maximum number of retransmissions suggested in the speciﬁcation is eight. Moreover, every two failed retransmissions DR is decremented; therefore, the SF increases and the time on air increases as well. This algorithm implicitly assumes that the transmission failed due to poor connectivity, therefore a lower DR should increment the success rate, as the receiver sensitivity will be better.
III. LITERATURE
The scientiﬁc literature on LoRa, and LPWANs in general, is slowly expanding but most of the papers are still related to the link-level evaluation of the technology. Tests using Sigfox, LoRaWAN, and pre-standard NB-IoT solutions, have been made on the ﬁeld by several network operators. Some ﬁeld trials have been carried out, to determine LoRa ranging performance, in free space conditions [6] and in more complex scenarios [7].
Different studies have investigated the use of LoRa technology in speciﬁc ﬁelds of application, as for example, sailing monitoring systems [8], tactical troops tracking systems [9], smart cities [10], etc. In contrast with these works, we address a large set of applications, properly categorizing them.
Many details regarding the LoRa modulation and physical layer have been recently published in [11] and [12], where the Authors studied the output signal generated by commercial transceivers to understand how information is encoded and embedded in the chirp waveforms.
The interference problem has been addressed in [13], where the Authors study packet collisions applying a time offset between each other; in [14] and [1] the orthogonality of transmissions performed with different Spreading Factors, an important issue discussed in more detail in Section V, is studied mathematically. More precisely, in these articles the Authors analyze the architecture of the LoRa (de)modulator and determine the conditions for a capture to happen in the presence of two signals with different SF. We performed a similar analysis, but using an experimental approach.
The ﬁrst papers about the system-level LoRa network capacity have been published very recently, most of them addressing the problem through simple mathematical approaches [15], [16]. In these works the limitations imposed by regulation on the utilization of the channel are taken into consideration as a major limit for the network capacity; although this is true when few continuously transmitting devices are considered, if the trafﬁc generated is more sporadic and the number of devices is higher, this does not represent a problem. It is possible to show that among the use cases that we consider in this paper the channel utilization for a single device is always below 0.55%. Moreover, with respect to [15] and [16], we determine

2327-4662 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JIOT.2018.2828867, IEEE Internet of Things Journal

3

the capacity of a network considering the full LoRa protocol stack, the presence of concurrent transmissions and consequent collisions or captures, and realistic information on the physical layer obtained through experiments.
In [17] the Authors estimated, through simulations, the capacity of a LoRa network assuming a simpler collision mechanism and protocol than what we used in this work; these assumptions lead to a lower capacity with respect to what we present in this paper.
In [18] the Authors studied experimentally the impact on the coverage of having multiple gateways deployed in a particular area of Glasgow. Our work, though, focuses more on capacity than on coverage: a fact of relevance for LoRa, whose receive sensitivity depends on transmission parameters (the Data Rate).
IV. LORAWAN KEY VERTICAL MARKETS
The space of potential LoRaWAN key vertical markets includes Smart Metering, Smart Grids, Smart Cities, Smart Homes, Agriculture, Tracking, Vehicle Telematics and Industrial applications [19]. However, while in some of these cases there are existing competing technologies, it is in the rural areas that the advantage of LoRaWAN, having a link budget tolerating power losses up to about 150 dB at 868 MHz, is the most valuable. In fact, the transmission range of a LoRaWAN gateway can be larger than 10 km; the same tolerance to power losses increases considerably the coverage capabilities in difﬁcult areas, such as the basement of a building; this coverage condition is often referred to as ”deep indoor”. Therefore, for environmental monitoring, precision agriculture or animal tracking applications, LoRaWAN appears as a suitable candidate technology.
Moreover, the scarce spectral resources that LoRaWAN can use (in many countries, no more than 2 MHz of bandwidth), make it difﬁcult to exploit it extensively in crowded environments, like cities where many private stakeholders might want to share the spectrum; in rural areas the opposite might be true, making the spectrum less crowded.
For these reasons, we focus our analysis on rural areas and related key applications. The set of applications for which LoRaWAN may be a well suited technology is still large, even when rural areas only are considered. In Table II we summarize these cases of interest, as they are deﬁned in [20], indicating for each of them a target success rate, and we propose a grouping criterion in order to select few of them as representative for this work.
This criterion is based on trafﬁc considerations, and in particular on the assumption that, given a payload size, and so a packet duration, a single gateway is able to process a certain number of packets per day approximately regardless to how many nodes are present in the network. This trafﬁc, however, is the sum of the trafﬁcs generated by all devices in the network and the same amount of trafﬁc can be generated by a high number of devices which rarely transmit a packet or few devices which transmit packets at a higher pace.
Based on this assumption, all the networks implementing use cases characterized by the same payload size will share

TABLE II APPLICATION REQUIREMENTS FOR THE USE CASES OF INTEREST.

Use Case
Wearables Smoke Detectors
Smart Grid White Goods Waste Management VIP/Pet Tracking Smart Bicycle Animal Tracking Environmental Monitoring Asset Tracking Smart Parking Alarms/Actuators Home Automation Machinery Control Water/Gas Metering Environmental Data Collection Medical Assisted Living Microgeneration Safety Monitoring Propane Tank Monitoring Stationary Monitoring Urban Lighting Vending Machines Payment Vending Machines General

Packet rate (λ) [packet/day] 10 2 10 3 24 48 192 100 5 100 60 5 5 100 8 24 8 2 2 2 4 5 100 1

Minimum success rate (Ps,min)
90% 90% 90% 90% 90% 90% 90% 90% 90% 90% 90% 90% 90% 90% 90% 90% 99% 90% 99% 90% 90% 90% 90% 90%

Grouping Group A PL = 10/20B
Group B PL = 50B
Group C PL = 100/200B
Group D PL = 1KB

the same ability to process their trafﬁc. A common optimal amount of packets per day can be used to compute how many devices could be served individually, knowing how often they have a packet to transmit.
Therefore we can simulate only one case per group and use the results to compute the maximum number of devices that can be served for each individual use case, characterized by a different packet generation rate.
To prove the validity of this criterion, we assume a protection ratio3 α = ∞, N nodes in the network, each of them producing trafﬁc at a given packet rate, denoted as λ [packet/day], with a constant delay between two consecutive transmissions. Each packet has a duration, or time on air (TA), which is a function of the payload size denoted as PL4 [B].
Assuming that a device starts transmitting with a uniformly distributed time offset from t = 0, we can derive the following formula for the packet success rate, denoted as Ps, given by:

Ps =

1

−

2TAλ Kd

N −1

(1)

where Kd is a constant representing the number of seconds in a day and it is equal to 86400.
Figure 1 shows, as an example, Ps for six different use cases belonging to two different groups: Group B (PL = 50 B) and Group C (PL = 100 B), when the offered trafﬁc O = N λ [packet/day] is increasing, SF is set to 7. It is clear that use cases of the same group show a similar behavior in terms of success rate when the network trafﬁc varies, which conﬁrms the validity of our grouping criterion. When more complex protocols are employed by the devices, e.g. including retransmissions, the differences among the use cases of the same group tend to increase, but the above effect remains.
The representative use cases we selected for a deeper analysis are Waste Management in Smart cities for Group A, Animal Tracking for Precision Agriculture for Group B and Environmental Data Collection for Group C (see Table II).

3Properly deﬁned later. 4The equation to calculate the packet time on air is described in [3].

2327-4662 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JIOT.2018.2828867, IEEE Internet of Things Journal

4

100

80

Success rate (Ps) [%]

60

40 20 00.2

Group B, λ = 1 Group B, λ = 1000 Group B, λ = 5000 Group C, λ = 1 Group C, λ = 1000 Group C, λ = 5000
0.4 0.6 0.8 1 1.2 1.4 1.6 Offered trafﬁc (O) [packet/day] ×105

Fig. 1. Proof of concept for the grouping criterion

2). The maximum distance reached in this experiment was 10,8 km and for each location Line-Of-Sight (LOS) conditions5 were met. The Received Signal Strength Indicator (RSSI) provided by the transceiver was used as a measurement of received power after being averaged over the transmission of 10,000 packets per location. The devices were conﬁgured to transmit using BW=250 kHz, coding rate 4/5, packets with a 18 byte payload and a transmit power Pt = 14 dBm. Measurements are discussed in sub-Section V-B.
In order to check the orthogonality among transmissions with different SFs, a wired test bed was setup using Semtech SX1272 as a receiver, and two Microchip RN2483 transceivers as transmitters. The experiments were conducted in a laboratory inspired to the methodology described in [21]. The two sources transmitted packets starting simultaneously, containing independent payload and using different SFs. The signal resulting from the mixing of the two transmitters outputs, is being duplicated, sent to the receiver and to a spectrum analyzer which is used to measure the Signal-to-Interference Ratio (SIR), deﬁned as the ratio between the peak power of the intended received signal, and the peak power of the interfering signal. For each level of SIR, 10,000 packets were transmitted and the number of captured (i.e., correctly received) packets were counted, to assess the packet success rate. From the resulting curve, the protection ratio is derived as the value of SIR which implies a success rate of 50%.
The protection ratios found according to this methodology is representative only of a situation where no time offset is present between two colliding packets. Nevertheless it is expected that the presence of a time offset would reduce the overlap between the two packets and ultimately the amount of energy causing a collision. Therefore the results presented in this work can be considered as a worse case.
Measurement results are described in sub-Section V-C.

Fig. 2. Map of Bologna: setup for ranging experiments with ﬁxed gateway.
V. LINK LEVEL ANALYSIS We performed two types of link-level assessment via experimentation, both needed to properly capture the link performance in system-level simulations. First, we measured the received power as a function of distance; then we assessed the claimed orthogonality of transmissions made with different SFs, and the protection ratio when the same SF is used by two simultaneously transmitting devices.
A. Experimental setup In order to characterize the transmission range of a LoRa
device we performed measurements of received power at increasing distances, with the aim to deﬁne a path loss model usable also in different conditions. Two Semtech SX1272 modules were used during this experiment, one deployed on a 240 m high hill and the other one, the transmitter, deployed in different locations at increasing distances in ﬂat terrain (Figure

B. Transmission Range
Figure 3 presents the results of the measurements focused on the ranging capabilities of LoRa. Three dashed curves, one for each SF considered, show how the RSSI decreases as the distance increases; the SFs were chosen from the set {7, 9, 12}.
In the literature many channel models have been proposed to predict the path loss at 868 MHz, for example the OkumuraHata model [22]. In Figure 3 we show also the expected received power according to the latter when the same scenario is considered, in ideal conditions.
We observed an almost constant difference between the ”Okumura-Hata” curve and our measurements: a gap of about 27 dB (∆), which may be caused by antenna mismatches and other technological impairments. Assuming that this additional loss is present whenever the LoRa technology is involved, we consider from now on a path loss, L, given by the one predicted by the Okumura-Hata model (LOH ) increased by 27 dB; in other words L = LOH + ∆.
Overall, we estimated a path loss given by the following equation which corresponds to the curve ”Channel Model” in
5The ﬁrst Fresnel ellipsoid was free from obstacles.

2327-4662 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JIOT.2018.2828867, IEEE Internet of Things Journal

5

RSSI [dBm]

−80 −90 −100 −110 −120 −130
2

∆ = 27dB

RSSI SF7 RSSI SF9 RSSI SF12 Okumura Hata Channel Model

3

4 5 6 7 8 9 1011

Distance [km]

Fig. 3. Measured average RSSI [dBm] as a function of distance [km] and comparison with Okumura-Hata model.

TABLE III LORA PROTECTION RATIOS IN dB.

Interfering Signal

SF7 SF9 SF12

Useful Signal

SF7

SF9 SF12

0.3 −10.3 −11

−13.8 0.3 −14.6

< −30 −21.6 1.7

Figure 3: L = 113.2 + 29.3 log10(dkm). Being the OkumuraHata formula dependent on the device height and the type of scenario, also our model is inheriting the same dependencies [22].

C. Orthogonality of Spreading Factors
The SFs used by the devices were chosen in the set (7, 9, 12). A ﬁrst measurement campaign was conducted, letting the two transmitters use the same SF. In this case the lack of orthogonality brings to packet losses, as long as the SIR is not sufﬁciently large. Only minor differences were found when varying the SF. Deﬁning conventionally the protection ratio, α, as the value of SIR that ensures a success rate equal to 50%, we then found it varies from 0.3 dB to 1.7 dB (see Table III).
A second campaign was conducted to study the assumption of orthogonality among transmissions performed using different SF. In Table III we report the estimated protection ratios in dB for all the cases already mentioned. As expected, the impact of the interferer on the useful transmissions is much smaller, but in any case different SFs are not perfectly orthogonal.
The effect of this lack of orthogonality may have an impact when a large network is considered; for example, in a network where all devices use the same transmit power, an interferer which is from 2 to 5 times closer to the gateway than another device, may cause a collision even when a different SF is used.
In the literature the possibility to have virtual orthogonal sub-channels is often mentioned, but some of the devices

working in a given sub-channel will always be potential interferers for another set of devices working in a different sub-channel, depending on their relative positions. However, this phenomena can be considered as a second order effect since collisions due to the random access within the same sub-channel have a much stronger impact.

VI. SYSTEM LEVEL ANALYSIS

A. Simulator

We built a system-level simulator accounting for the main

features of LoRaWAN MAC and the link-level aspects dis-

cussed above. We assume the area to cover is a square of side

S, where N sensors are deployed randomly and uniformly.

We also account for log-normal shadowing with standard

deviation σ = 2, a coherence time TC = 200 s, and a

negative exponential autocorrelation function [23], while the

path loss is calculated according to Section V and considering

the gateway(s) to be placed at a height of 30 m from the

ground. As already mentioned in Section V-B the different

height has an impact on the path loss formula which can be

reformulated in our case as L = 127.6 + 35.22 log10(dkm). Different scenarios characterized by a different number of

gateways is considered. When multiple gateways are deployed

they may receive multiple replicas of the same packet; in that

case only one reception is considered in the ﬁnal statistics.

The nodes wake-up, sample and transmit their data through

the LoRaWAN access mechanism at regular time intervals

which depend on λ as described in Section IV.

The simulator is event-based, therefore the packets are

transmitted without any time quantization. A packet is detected

by a device if the received power is greater than the sensitivity,

if this happens the device will lock to the preamble and will

try to decode the payload. When a collision between more

packets happens, with any time offset, their SIR is calculated

and the payload is passed to the upper layers if the device is

locked to that particular packet and if the SIR is greater than

the protection ratio estimated in Section V-C. In each device

the main layers of the LoRaWAN standard are implemented

as state machines. Each Gateway is equipped with parallel

receivers, one for each channel and SF available; in this way

it is able to process concurrent transmissions provided that a

receiver is not busy handling another link.

To emphasize the role of proper link-level considerations,

we used the simulator to compute the curves previously shown

in Figure 1. The resulting curves are closer to a more realistic

value with an absolute difference from the theoretical ones

between 20% and 40%.

The most important simulation outputs consist in the success

rate Ps, calculated as the ratio between the number of packets

correctly received by the network and those transmitted by

the devices, and the network throughput, T , calculated as the

quantity of information correctly received by the network per

unit of

time:

T

=

PL λPs Kd

[B/s].

Network capacity will be deﬁned later based on discussions

about the relationship between Ps, T and the offered trafﬁc O.

This will also require the identiﬁcation of the best transmission

mode (initial SF, conﬁrmed or unconﬁrmed) for each use

case/scenario considered.

2327-4662 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JIOT.2018.2828867, IEEE Internet of Things Journal

6

B. Capacity of a small area
We considered a scenario consisting in a square area of 1 km2 where a variable number of nodes is deployed and a LoRa gateway, placed in the center, is sufﬁcient to cover all of them using any SF. For each group of use cases we vary the number of nodes to simulate different amounts of offered trafﬁc. Let us deﬁne the network capacity as the amount of offered trafﬁc which allows to maximize the network throughput. In Figure 4 we report four curves representing how the network throughput varies as the number of devices, and therefore the offered trafﬁc, increases. Each curve represents a different conﬁguration of the PHY and MAC parameters: conﬁrmed or unconﬁrmed mode and initial SF equal to 7 or 12. In case of retransmissions, the SF increases as mentioned in Section II. For the sake of simplicity we only show the results for the use cases of Group B.

Success rate (Ps) [%]

SF7 conﬁrmed SF12 conﬁrmed

SF7 unconﬁrmed SF12 unconﬁrmed

100

80

60

40

20

00

1

2

3

4

5

Offered trafﬁc (O) [packet/day] ×105

Network throughput (T ) [B/s]

300

SF7 conﬁrmed

SF7 unconﬁrmed

SF12 conﬁrmed

SF12 unconﬁrmed

200

100

Fig. 5. Simulations: success rate for Group A (PL = 10B, λ = 24 packet/day).

SF7 conﬁrmed SF12 conﬁrmed

SF7 unconﬁrmed SF12 unconﬁrmed

100

80

Success rate (Ps) [%]

60

0

40

104

105

106

Offered trafﬁc (O) [packet/day]

20

Fig. 4. Simulations: network throughput for Group B (PL = 50B, λ = 100 packet/day).
It is evident that initial SF equal to 7 and unconﬁrmed mode is the conﬁguration that allows the highest throughput which, for Group B, is around 300 B/s when the offered trafﬁc is 1.3 × 106 packet/day. This is because of the small area size.
The problem with this deﬁnition of capacity, though, is that it leads to an operating point where the packet success rate is around 39% for the case of Group B, which is too low for many applications. The same happens also for the other groups. For this reason we redeﬁne the network capacity, Omax, as the maximum amount of offered trafﬁc O which guarantees a given level of packet success rate Ps,min.
Figures 5, 6 and 7 show how the packet success rate changes when the offered trafﬁc increases for the three groups and for each different conﬁguration used.
Generally speaking, in case of a small area to cover, the best solution is to set the SF to 7 in order to avoid collisions by keeping the packet time on air, and so the SF, as small as possible. Moreover, when there is not much trafﬁc in the network, the conﬁrmed mode is the best choice to guarantee a high success rate.

00

0.5 1 1.5 2 2.5 3 Offered trafﬁc (O) [packet/day] ×105

Fig. 6. Simulations: success rate for Group B (PL = 50B, λ = 100 packet/day).

When the network is more congested, the retransmission mechanism increases the collision probability which leads to a lower success rate and throughput; for this reason the curves for SF7 and conﬁrmed mode become lower than the curves for SF7 and unconﬁrmed mode when the offered trafﬁc becomes higher than a certain value. This can be observed easily in Figures 5 and 6, while in Figure 7 this phenomena happens at higher amounts of offered trafﬁc.
From these curves, considering the desired minimum success rates reported in Table II, we derived the network capacity for the different use case groups; this capacity is always reached when conﬁrmed mode and SF7 are used. All the resulting capacities are reported in Table IV. For each use case the maximum number of devices that guarantees the required success rate can be calculated as Nmax = Omax/λ. Moreover,

2327-4662 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JIOT.2018.2828867, IEEE Internet of Things Journal

7

Success rate (Ps) [%]

SF7 conﬁrmed SF12 conﬁrmed

SF7 unconﬁrmed SF12 unconﬁrmed

100

80

60

40

20

00

0.5

1

1.5

Offered trafﬁc (O) [packet/day] ×105

Fig. 7. Simulations: success rate for Group C (PL = 200B, λ = 24 packet/day).

TABLE IV NETWORK CAPACITY FOR THE USE CASES OF INTEREST IN A SMALL
AREA.

Use Case Wearables

Network capacity (Omax ) ×103 [packet/day] 390

Network size (Nmax )
×103 [devices]
39

Node Density (ρmax )
[devices/hectare]
390

Smoke Detectors

390

195

Smart Grid

390

39

1950 390

White Goods

390

130

Waste Management

390

16.3

1300 163

VIP/Pet Tracking

208

4.33

43.3

Smart Bicycle

208

1.08

10.8

Animal Tracking

208

2.08

20.8

Environmental Monitoring

208

41.6

416

Asset Tracking

208

2.08

20.8

Smart Parking

208

3.47

34.7

Alarms/Actuators

208

41.6

416

Home Automation

208

41.6

416

Machinery Control

208

2.08

20.8

Water/Gas Metering

148

18.5

185

Environmental Data Collection

148

6.17

61.7

Medical Assisted Living

756

9.38

93.8

Microgeneration

148

74

740

Safety Monitoring

756

37.5

375

Propane Tank Monitoring

148

74

740

Stationary Monitoring

148

37

370

Urban Lighting

148

29.6

296

Vending Machines Payment

148

1.48

14.8

Vending Machines General

-

-

-

the maximum node density compatible with the requirement is given by ρmax = Nmax/S2. These results are shown in Table IV as well.
The average latency, deﬁned as the average delay between the request of transmission at device side and the notiﬁcation to the application layer of correct reception at gateway side, is 4.1, 6.9 and 7.8 seconds for Groups A, B and C, respectively. This high latency is due to the retransmission mechanism employed to achieve the higher capacity, but it can be easily reduced below one second by using unconﬁrmed mode which cause a drop in the success rate of less than 10%.

6Note that these two use cases have a more strict requirement in terms of success rate.

C. Coverage of a large area
Let us assume to have a scenario where the area to cover is larger. As we already discussed, a solution to the problem may be to increase the SF used by the devices; in this way the transmission range of the devices is larger but the radio channel is utilized more intensively due to longer packet durations, a behavior that can lead quickly to the saturation of the network. Another solution is to deploy more gateways in the territory; this allows us both, to cover a larger area without the need for the devices to use a high SF, and also to help the network process the trafﬁc when the channel is congested.
According to the LoRaWAN speciﬁcation, when a device sends a packet, potentially all gateways in the network could receive it. It is sufﬁcient that only one is received to succeed. This implies that the higher is the amount of gateways in the networks, the higher is the success rate.
Before analyzing the network capacity, a set of simulations has been performed to study the beneﬁts of having multiple gateways; the scenario considered is a square area of side S = 6.82 km, which is represented in Figure 8; the gateways are disposed in a hexagonal grid and every cell has a radius Rcell = 1.97 km which corresponds to the average transmission range of a LoRa device considering the downlink, SF7 and the channel path loss formula already used in the previous section. Simulations are performed by varying the number of sinks deployed, in particular a scenario with only gateway A is considered ﬁrst, then a network with only four gateways (A, B, C and D), and ﬁnally one with all seven gateways deployed. Notice that when all gateways are considered the area is fully covered with SF7, while when only gateway A is present a SF higher than 10 is needed to cover the area. The devices in the network generate an offered trafﬁc (O) of approximatively 112 thousands packet/day.
Figure 9 shows how the success rate increases as the number of gateways employed rises. All the curves shown represent the performance of the network when unconﬁrmed mode is selected. The dashed curves are made considering initial SF = 7 while the solid ones considering initial SF = 12.
When the initial SF is 7 the network is not congested, therefore every packet is received by a gateway that is simply within the transmission range of the sender; in this case the improvement in terms of success rate, represented by the dashed lines, is given by a better geometrical coverage provided by the additional gateways. This can be seen also by comparing the three curves with the ”Geometrical Coverage” curve, which represents the fraction of the area deﬁned by the union of all the circles centered in the gateway locations and with radius equal to the transmission range with SF7, with respect to the total area. This curve is very close to those mentioned above, proving that all the effects related to the MAC protocol are negligible.
When the initial SF is 12, the geometrical coverage is always 100%, so the improvement represented with the solid lines is only due to the higher probability of having at least one packet received with a signal to interference ratio higher than the protection ratio. This improvement is similar among the three groups; their success rates differ only in the absolute

2327-4662 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JIOT.2018.2828867, IEEE Internet of Things Journal

8

Rcell = RSDFL7 = 1.97km

B

E

F

A

D

C

G S = 6.82km

value due to the different payload sizes which cause different levels of congestion when the offered trafﬁc (O) is ﬁxed, as in this case.
The previous statement can be conﬁrmed also by observing the set of points representing the case with only one gateway deployed; this case differs from the one discussed in the previous section only in the size of the area. The success rates when the initial SF = 12 are identical in both scenarios, being the transmission range enough to cover all the devices in both cases, while with initial SF = 7 the success rate values are close to the amount of area in range, 100% when the area is small, 55% when it is large.
It is evident that, for the scenario proposed, the option that guarantees the highest success rate, therefore network capacity, is to use seven gateways and SF7.
D. Capacity of a large area
We now move to the characterization of Ps versus O as done in Section VI-B, this time varying the number of gateways in order to estimate how the network capacity improves when a more complex network is considered. For the sake of simplicity we consider only Group C and SF7. The four curves in Figure 10 represent the behavior of the network when conﬁrmed or unconﬁrmed mode is used and when the number of gateways varies from one to four.

Fig. 8. Scenario with multiple gateways.

100

Success rate (Ps) [%] Success rate (Ps) [%]

80

60

100 80 60

Group A, SF7 Group B, SF7 Group C, SF7
Geometrical Coverage

Group A, SF12 Group B, SF12 Group C, SF12

40

1 GW, SF7, Conﬁrmed

20

4 GW, SF7, Conﬁrmed 1 GW, SF7, Unconﬁrmed

4 GW, SF7, Unconﬁrmed

0

104

105

Offered trafﬁc (O) [packet/day]

40

20

0

1

4

7

Number of gateways

Fig. 9. Success rate for the three groups as a function of the number of gateways.

Fig. 10. Simulations: success rate for Group C with different number of Gateways (PL = 200B, λ = 24 packet/day).
When unconﬁrmed mode is used the amount of trafﬁc has a minor impact on the success rate as the geometrical coverage plays the main role, resulting in a success rate of 55% or 93% depending on the number of gateways.
When conﬁrmed mode is used the coverage problem is overcome, therefore the success rate is limited only by capacity issues. When only one gateway is present, the success rate requirement (Ps,min = 90%) is satisﬁed with an offered trafﬁc smaller than Omax = 40 thousands packet/day, a signiﬁcantly smaller value with respect to the scenario described in Section

2327-4662 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JIOT.2018.2828867, IEEE Internet of Things Journal

9

TABLE V NETWORK CAPACITY FOR THE USE CASES IN GROUP C IN A LARGE AREA.

Use Case

Network capacity (O×m10a3x )
[packet/day]

Network size (Nmax )
×103 [devices]

1 Gateway

Node Density
(ρmax ) [devices/hectare]

Water/Gas Metering

40

5

1.07

Environmental Data Collection

40

1.67

0.358

Medical Assisted Living

4.8

0.6

0.129

Microgeneration

40

20

4.3

Safety Monitoring

4.8

2.4

0.516

Propane Tank Monitoring

40

20

4.3

Stationary Monitoring

40

10

2.15

Urban Lighting

40

8

1.72

Vending Machines Payment

40

0.4

0.086

4 Gateways

Water/Gas Metering

1500

188

40.3

Environmental Data Collection

1500

62.5

13.4

Medical Assisted Living

190

23.8

5.11

Microgeneration

1500

750

161

Safety Monitoring

190

95

20.4

Propane Tank Monitoring

1500

750

161

Stationary Monitoring

1500

375

80.6

Urban Lighting

1500

300

64.5

Vending Machines Payment

1500

15

3.22

VI-B because more devices tend to use a higher SF in order to reach the gateway. When four gateways are present, the minimum success rate is reached with an offered trafﬁc Omax = 1.5 million packet/day, much higher than the case with only one gateway.
In Table V we report the capacity (Omax), the size (Nmax) and the maximum node density (ρmax) of a network implementing the use cases of Group C.

VII. CONCLUSIONS
We have assessed the capacity of a LoRaWAN network for a broad range of use cases of interest, speciﬁcally focusing on rural environments. This has been achieved through an experimental assessment of the link-level characteristics of the system, followed by a system-level simulation implementing all LoRaWAN speciﬁcations.
With reference to each use case, network capacity has been deﬁned based on requirements on the success probability and the transmission rates of nodes.
Two separate scenarios have been analyzed, of very different size. In the smaller case, where one single gateway is used, as might be expected we found that optimal conﬁguration of the network is achieved by setting lower values of SF, using conﬁrmed mode. In the case of a larger scenario, we analyzed the network capacity obtained with one or more gateways. In the former case, as expected, network capacity is severely degraded, due to the need to use larger (and less efﬁcient) values of SF; in the latter, a signiﬁcant improvement is found.
More precisely, let us make reference to a speciﬁc use case, as an example: water/gas monitoring. When one gateway covers an area of one square km, the maximum density of nodes compatible with the application requirements is 185 nodes/hectare. If the same gateway is used in a much larger area (of size equal to about 46.5 square km) the maximum node density is signiﬁcantly decreased: it is close to 1 node/hectare, a value reduced by a factor much larger than the area size. The reason stands in the need to use larger values of SF to cover far nodes, bringing to a much smaller efﬁciency in the use of the spectral resource. On the other hand, using in the same large area four gateways instead of

one, introduces a notable improvement in network capacity: the maximum node density is about 40 nodes/hectare, that is, greater by a factor much higher than the number of additional gateways.
The analysis performed provides useful insights for the development of LoRaWAN networks.
VIII. ACKNOWLEDGMENT
The Authors wish to thanks Stefan Mijovic and Andrea Skajkic for the helpful discussions.
REFERENCES
[1] C. Goursaud and J.-M. Gorce, “Dedicated networks for IoT : PHY / MAC state of the art and challenges,” EAI endorsed transactions on Internet of Things, Oct. 2015. [Online]. Available: https://hal.archives-ouvertes.fr/hal-01231221
[2] Orange, “LoRa Device Developer Guide,” Tech. Rep., April 2016. [3] LoRa Alliance, “LoRaWAN speciﬁcation,” January 2015. [4] Semtech, “AN1200.22 LoRa Modulation Basics,” May 2015. [5] Semtech, “Datasheet SX1272/73 - 860 MHz to 1020 MHz Low Power
Long Range Transceiver,” March 2015. [6] M. Aref and A. Sikora, “Free space range measurements with semtech
LoRaTMtechnology,” in Wireless Systems within the Conferences on Intelligent Data Acquisition and Advanced Computing Systems: Technology and Applications (IDAACS-SWS), 2014 2nd International Symposium on, Sept 2014, pp. 19–23. [7] J. Petajajarvi, K. Mikhaylov, A. Roivainen, T. Hanninen, and M. Pettissalo, “On the coverage of LPWANs: range evaluation and channel attenuation model for lora technology,” in ITS Telecommunications (ITST), 2015 14th International Conference on, Dec 2015, pp. 55–59. [8] L. Li, J. Ren, and Q. Zhu, “On the application of LoRa LPWAN technology in sailing monitoring system,” in 2017 13th Annual Conference on Wireless On-demand Network Systems and Services (WONS), Feb 2017, pp. 77–80. [9] W. San-Um, P. Lekbunyasin, M. Kodyoo, W. Wongsuwan, J. Makfak, and J. Kerdsri, “A long-range low-power wireless sensor network based on U-LoRa technology for tactical troops tracking systems,” in 2017 Third Asian Conference on Defence Technology (ACDT), Jan 2017, pp. 32–35. [10] V. A. Stan, R. S. Timnea, and R. A. Gheorghiu, “Overview of high reliable radio data infrastructures for public automation applications: LoRa networks,” in 2016 8th International Conference on Electronics, Computers and Artiﬁcial Intelligence (ECAI), June 2016, pp. 1–4. [11] B. Sikken. (2016) Decoding LoRa. [Online]. Available: https://revspace.nl/DecodingLora [12] M. Knight and B. Seeber, “Decoding LoRa: Realizing a modern LPWAN with SDR,” 2016. [13] M. Bor, J. Vidler, and U. Roedig, “LoRa for the Internet of Things,” in Proceedings of the 2016 International Conference on Embedded Wireless Systems and Networks, ser. EWSN ’16, 2016, pp. 361–366. [14] O. Georgiou and U. Raza, “Low power wide area network analysis: Can LoRa scale?” IEEE Wireless Communications Letters, vol. PP, no. 99, pp. 1–1, 2017. [15] K. Mikhaylov, J. Petaejaejaervi, and T. Haenninen, “Analysis of capacity and scalability of the lora low power wide area network technology,” in European Wireless 2016; 22th European Wireless Conference, May 2016, pp. 1–6. [16] F. Adelantado, X. Vilajosana, P. Tuset-Peiro´, B. Mart´ınez, and J. Melia`, “Understanding the limits of lorawan,” CoRR, vol. abs/1607.08011, 2016. [Online]. Available: http://arxiv.org/abs/1607.08011 [17] M. C. Bor, U. Roedig, T. Voigt, and J. M. Alonso, “Do LoRa low-power wide-area networks scale?” in Proceedings of the 19th ACM International Conference on Modeling, Analysis and Simulation of Wireless and Mobile Systems, ser. MSWiM ’16. New York, NY, USA: ACM, 2016, pp. 59–67. [Online]. Available: http://doi.acm.org/10.1145/2988287.2989163 [18] A. J. Wixted, P. Kinnaird, H. Larijani, A. Tait, A. Ahmadinia, and N. Strachan, “Evaluation of LoRa and LoRaWAN for wireless sensor networks,” in 2016 IEEE SENSORS, Oct 2016, pp. 1–3. [19] Orange, “LoRa device developer guide,” April 2016. [20] GSMA, “3GPP low power wide area technologies, GSMA white paper,” Tech. Rep., October 2016.

2327-4662 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JIOT.2018.2828867, IEEE Internet of Things Journal
10 [21] C. Gezer, C. Buratti, and R. Verdone, “Capture effect in IEEE 802.15.4
networks: Modelling and experimentation,” pp. 204–209, May 2010. [22] A. F. Molisch, Wireless communications. John Wiley & Sons, 2007. [23] M. Gudmundson, “Correlation model for shadow fading in mobile radio
systems,” Electronics Letters, vol. 27, no. 23, pp. 2145–2146, Nov 1991.
2327-4662 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

