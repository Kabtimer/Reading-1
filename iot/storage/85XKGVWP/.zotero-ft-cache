Universidad de Cuenca
Facultad de Ingeniería
Escuela de Electrónica y Telecomunicaciones
Evaluación del Rango de Transmisión de LoRa para Redes de Sensores Inalámbricas con LoRaWAN en Ambientes Forestales
Trabajo de titulación previo a la obtención del título de Ingeniero en
Electrónica y Telecomunicaciones.
Autor : Pablo Esteban Avila Campos C.I. 0105737118
Director : Ing. Darwin Fabián Astudillo Salinas, PhD C.I. 0103907036
Co-Director : Ing. Andrés Marcelo Vázquez Rodas, PhD C.I. 0301496840
Cuenca - Ecuador 2017

Universidad de Cuenca

Resumen
Las redes de bajo consumo y amplia área de cobertura (Low Power Wide Area Network (LPWAN)) se presentan como una nueva tendencia en la evolución de las telecomunicaciones, una de las tecnologías que ha surgido como parte de las LPWAN, es Long Range (LoRa); además de las claras ventajas de las LPWAN, LoRa se caracteriza por el bajo costo de los nodos y un rápido despliegue.
En este momento, surgen nuevos paradigmas en las redes de comunicaciones, como el Internet de las cosas (Internet of Things (IoT)), cuyas necesidades son solventadas en tecnologías aún en desarrollo como 5G, es por esta razón que grupos de desarrollo como LoRa Alliance, proponen soluciones como Long Range Wide Area Network (LoRaWAN) para solventar las necesidades del mercado. LoRaWAN, se deﬁne como una capa de Media Access Control Layer (MAC) que utiliza las características de LoRa para crear redes enfocadas en IoT.
El propósito de este estudio es ajustar modelos de pérdidas de propagación utilizando mediciones del Indicador de Nivel de Señal Recibida (Received Signal Strength Indicator (RSSI)) y el Radio Señal a Ruido (Signal to Noise Ratio (SNR)) en diferentes ambientes, relacionados con el despliegue de redes de sensores en ambientes forestales, especíﬁcamente en riveras de ríos. Con estos modelos se pretende dar respuesta a la hipótesis de que en ambientes rurales se tendrá una mejor cobertura que en entornos urbanos.
La metodología utilizada consiste en el envío y captura de mensajes LoRaWAN con el kit de desarrollo 900 de Microchip. Estos envíos se realizan en intervalos de diez metros a una altura ﬁja de dos metros sobre el nivel del suelo. En cada punto de envío, se transmiten veinte mensajes, diez de ellos con la mayor tasa de datos (Data Rate (DR)) y diez con la menor permitidos por el kit mencionado. El número de mensajes recibidos se utiliza como parámetro de calidad de cada transmisión, ayudando a determinar cuando ya no es factible enviar información.
Como resultados se demostró que en ambientes rurales en comparación a los urbanos, la cobertura mejora hasta en un 40 % con el mayor DR y un 60 % con el menor. Ambos DR presentan

Pablo Avila Campos

iii

modelos similares hasta determinada distancia que depende del ambiente medido. Esto demostraría que se debe usar un DR mayor siempre y cuando exista cobertura ya que su uso se traduciría en un menor consumo energético por un menor tiempo aire. Otro de los resultados que se presentan es que en ambientes urbanos existe mayor desviación estándar en las muestras. Esto conﬁrmaría y está directamente relacionado con la mayor densidad de obstáculos, provocando también que los modelos ajustados en ambientes rurales, sean más conﬁables. Finalmente, se realizaron test estadísticos que comparan las distribuciones en los tres ambientes, conﬁrmando la necesidad de caracterizar los ambientes de manera independiente.
Palabras clave : LoRa, LoRaWAN, IoT, RSSI, SNR, pérdidas, forestal, río, propagación, modelo.

Universidad de Cuenca

Abstract
LPWAN are a new trend in the telecommunications evolution. One of the technologies that has emerged as part of LPWAN, is LoRa. In addition to the clear advantages of LPWAN, LoRa is characterized by low cost of nodes and rapid deployment.
At the moment, new paradigms as the IoT emerge in the telecommunications networks, whose needs are solved in technologies still in development like 5G. It is for this reason that development groups like LoRa Alliance, propose solutions like LoRaWAN to solve the needs of the market. LoRaWAN, is deﬁned as a MAC that uses LoRa features to create networks focused on IoT.
The purpose of this study is to adjust propagation loss models using Received Signal Strength Indicator (RSSI) and Signal to Noise Radio (SNR) measurements in diﬀerent environments, related to the deployment of sensor networks in forest environments, speciﬁcally on riverbanks. These models are intended to answer the hypothesis that rural environments will have better coverage than urban.
The methodology consists in sending and capture messages LoRaWAN with the Microchip development kit 900. The transmissions are made at intervals of ten meters at a ﬁxed height of two meters above ground level. At each point of transmission, twenty messages are transmitted. Ten with the highest data rate (DR) and ten with the lowest allowed by the kit. The number of received packets is used as the quality parameter of each transmission, helping to determine when it is no longer feasible to send information.
As a result, it is shown that coverage improved by up to 40 % with the highest DR and 60 % with the lowest comparing rural with urban environment. Both DR present similar models up to a certain distance depending on the measured environment. This would demonstrate that a higher DR should be used as long as there is coverage since its use would result in lower energy consumption. Another result found is a greater standard deviation in urban environment. This would conﬁrm and is directly related to the greater density of obstacles, also causing the adjusted

Pablo Avila Campos

v

models in rural environments, to be more reliable. Finally, we performed statistical tests that compared the distributions in the three environments, conﬁrming the need to characterize the environments independently.
Keywords : LoRa, LoRaWAN, IoT, RSSI, SNR, path loss, forested, riverside, propagation, model

Universidad de Cuenca

Índice general

Resumen

III

Abstract

V

Índice general

VII

Índice de ﬁguras

XIII

Índice de tablas

XVII

Dedicatoria

XXII

Agradecimientos

XXIII

Abreviaciones y acrónimos

XXIV

1. Introducción

2

1.1. Identiﬁcación del Problema . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3

1.2. Justiﬁcación . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3

1.3. Alcance . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4

1.4. Objetivos . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5

Pablo Avila Campos

vii

Universidad de Cuenca 1.4.1. Objetivo General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 1.4.2. Objetivos especíﬁcos . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5

2. Marco Teórico

6

2.1. Introducción . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7

2.2. Redes de Sensores Inalámbricos . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7

2.2.1. Principales Tecnologías de IoT . . . . . . . . . . . . . . . . . . . . . . . . 8

2.3. Redes de Amplia Cobertura y Baja Potencia (LPWAN) . . . . . . . . . . . . . . 9

2.3.1. Características Principales de una red LPWAN . . . . . . . . . . . . . . . 9

2.4. Aspectos básicos de la modulación LoRa . . . . . . . . . . . . . . . . . . . . . . . 9

2.4.1. Principios del Espectro Ensanchado . . . . . . . . . . . . . . . . . . . . . 10

2.4.2. Espectro Ensanchado LoRa . . . . . . . . . . . . . . . . . . . . . . . . . . 11

2.4.3. Parámetros de Transmisión . . . . . . . . . . . . . . . . . . . . . . . . . . 12

2.4.4. Propiedades Clave de la Modulación LoRa . . . . . . . . . . . . . . . . . . 12

2.5. LoRa MAC: LoRaWAN . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13

2.5.1. Clases en LoRaWAN . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15

2.5.2. Formatos de Mensajes Físicos - Clase A . . . . . . . . . . . . . . . . . . . 16

2.5.3. Formatos de Mensajes MAC - Clase A . . . . . . . . . . . . . . . . . . . . 17

2.5.4. Activación de Dispositivos Finales . . . . . . . . . . . . . . . . . . . . . . 18

2.5.5. Tasa de Datos (DR) y Potencia de Transmisión . . . . . . . . . . . . . . . 19

2.6. Modelo de Pérdidas de Trayectoria . . . . . . . . . . . . . . . . . . . . . . . . . . 20

2.7. Conclusiones . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21

3. Estado del Arte de LoRa y LoRaWAN

23

Pablo Avila Campos

viii

Universidad de Cuenca 3.1. Introducción . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24 3.2. Capa Física - LoRa . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24 3.3. Capa MAC . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26 3.4. Análisis del Sistema . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27 3.5. Conclusiones . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28

4. Metodología

29

4.1. Introducción . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30

4.2. Descripción de Equipos . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30

4.2.1. Kit de Evaluación de LoRa - 900 . . . . . . . . . . . . . . . . . . . . . . . 30

4.2.2. Raspberry Pi 3 Modelo B . . . . . . . . . . . . . . . . . . . . . . . . . . . 32

4.2.3. Disposición de Equipos . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32

4.3. Conﬁguración de Dispositivos . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33

4.4. Descripción del Ambiente . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33

4.4.1. Ambiente 1: Urbano - Río Tomebamba . . . . . . . . . . . . . . . . . . . . 34

4.4.2. Ambiente 2: Semiurbano - Rio Machángara . . . . . . . . . . . . . . . . . 35

4.4.3. Ambiente 3: Rural - Rio Yanuncay . . . . . . . . . . . . . . . . . . . . . . 36

4.5. Descripción del Procedimiento . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38

4.5.1. Intervalos de Medición . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38

4.5.2. Paquetes Enviados . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38

4.5.3. Captura de Paquetes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39

4.5.4. Desencriptado y Almacenamiento . . . . . . . . . . . . . . . . . . . . . . . 40

4.6. Métricas de Análisis de Datos . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 40

Pablo Avila Campos

ix

Universidad de Cuenca 4.6.1. Descripción de Datos con Medidas Numéricas . . . . . . . . . . . . . . . . 40 4.6.2. Estimación de Intervalos de Conﬁanza . . . . . . . . . . . . . . . . . . . . 41 4.6.3. Análisis de Correlación . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41 4.6.4. Comparación de Poblaciones . . . . . . . . . . . . . . . . . . . . . . . . . 42 4.7. Conclusiones . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42

5. Resultados: Análisis de Mediciones y Ajuste del Modelo Empírico basado en

RSSI y SNR

44

5.1. Introducción . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45

5.2. Mediciones Previas . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45

5.2.1. Salto de Frecuencia . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45

5.2.2. Cantidad de Paquetes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46

5.2.3. Índice de Potencia . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46

5.3. Mediciones de RSSI y SNR . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47

5.4. Análisis Estadísticos . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49

5.4.1. Correlación . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49

5.4.2. Comparación de Ambientes . . . . . . . . . . . . . . . . . . . . . . . . . . 49

5.5. Modelamiento en Base a Pérdidas de Trayectoria . . . . . . . . . . . . . . . . . . 51

5.5.1. Medición 1 - Ambiente Urbano . . . . . . . . . . . . . . . . . . . . . . . . 52

5.5.2. Medición 2 - Ambiente Urbano - Orilla 2 . . . . . . . . . . . . . . . . . . 53

5.5.3. Medición 3 - Ambiente Semiurbano . . . . . . . . . . . . . . . . . . . . . . 53

5.5.4. Medición 4 - Ambiente Rural . . . . . . . . . . . . . . . . . . . . . . . . . 55

5.5.5. Comparación de Modelos . . . . . . . . . . . . . . . . . . . . . . . . . . . 57

5.6. Tasa de Errores de Paquetes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59

Pablo Avila Campos

x

Universidad de Cuenca 5.7. Conclusiones . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 62

6. Conclusiones y Recomendaciones

63

6.1. Conclusiones . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 64

6.2. Recomendaciones . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 64

6.3. Trabajos Futuros . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65

A. Conﬁguración de Dispositivos

68

A.1. Instalación y conﬁguración del servidor y Gateway LoRaWAN . . . . . . . . . . . 68

A.1.1. Instalación . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69

A.1.2. Preparación del Sistema . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70

A.1.3. Conﬁguración del Servidor . . . . . . . . . . . . . . . . . . . . . . . . . . . 73

A.1.4. Conﬁguración de Red . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75

A.1.5. Conﬁguración Adicional para 915 MHz . . . . . . . . . . . . . . . . . . . . 78

A.2. Conﬁguración del Nodo . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79

B. Desencriptado y Almacenamiento

84

B.1. Desencriptación de Paquetes - LoRaWAN . . . . . . . . . . . . . . . . . . . . . . 85

B.2. Desencriptado y Almacenaje . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 86

C. Mediciones de RSSI y SNR

91

C.1. Mediciones de RSSI . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 92

C.2. Mediciones de SNR . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 96

Bibliografía

101

Pablo Avila Campos

xi

Universidad de Cuenca

Pablo Avila Campos

xii

Universidad de Cuenca

Índice de ﬁguras

2.1. Proceso de ensanchamiento [1] . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10 2.2. Extracto del Espectrograma de un chirp (SF=8, BW=125kHz) [2] . . . . . . . . 11 2.3. Arquitectura del sistema LoRaWAN [3] . . . . . . . . . . . . . . . . . . . . . . . 14 2.4. Arquitectura del protocolo LoRaWAN [3] . . . . . . . . . . . . . . . . . . . . . . 14 2.5. Clases LoRaWAN . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15 2.6. Estructura Física de Uplink[4] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 2.7. Estructura Física de Downlink[4] . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 2.8. Temporización de Recepción[4] . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 2.9. Formato de Mensaje LoRa[4] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17
3.1. Comparación de coberturas . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26
4.1. Kit de Evaluación de LoRa - 900 [5] . . . . . . . . . . . . . . . . . . . . . . . . . 31 4.2. Tarjeta RF y Gateway [6] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31 4.3. Mota LoRa [7] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32 4.4. Raspberry Pi 3 modelo B [8] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33 4.5. Disposición Física de Dispositivos . . . . . . . . . . . . . . . . . . . . . . . . . . . 33

Pablo Avila Campos

xiii

Universidad de Cuenca 4.6. Ambiente 1 - Río Tomebamba . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34 4.7. Ambiente 1 - Esquema de Elevación . . . . . . . . . . . . . . . . . . . . . . . . . 35 4.8. Ambiente 2 - Río Machángara . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 36 4.9. Ambiente 3 - Río Yanuncay . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37 4.10. Ambiente 3 - Esquema de Elevación . . . . . . . . . . . . . . . . . . . . . . . . . 37 4.11. Captura de Paquetes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39
5.1. Valores de RSSI obtenidos para las diferentes frecuencias . . . . . . . . . . . . . . 46 5.2. Medición de RSSI en Ambiente 1 con DR0 . . . . . . . . . . . . . . . . . . . . . . 48 5.3. Medición de SNR en Ambiente 1 con DR0 . . . . . . . . . . . . . . . . . . . . . . 48 5.4. Análisis de Correlación de RSSI con DR0 - Ambiente 1 . . . . . . . . . . . . . . . 50 5.5. Análisis de Correlación de RSSI con DR3 - Ambiente 1 . . . . . . . . . . . . . . . 50 5.6. Ajuste de P L del Ambiente 1 con DR0 - Río Tomebamba . . . . . . . . . . . . . 52 5.7. Ajuste de P L del Ambiente 1 con DR3 - Río Tomebamba . . . . . . . . . . . . . 53 5.8. Ajuste de P L del Ambiente 1 con DR0, orilla 2 - Río Tomebamba . . . . . . . . 54 5.9. Ajuste de P L del Ambiente 1 con DR3, orilla 2 - Río Tomebamba . . . . . . . . 54 5.10. Ajuste de P L del Ambiente 2 con DR0 - Río Machángara . . . . . . . . . . . . . 55 5.11. Ajuste de P L del Ambiente 2 con DR3 - Río Machángara . . . . . . . . . . . . . 56 5.12. Ajuste de P L del Ambiente 3 con DR0 - Río Yanuncay . . . . . . . . . . . . . . 56 5.13. Ajuste de P L del Ambiente 3 con DR3 - Río Yanuncay . . . . . . . . . . . . . . 57 5.14. Ajustes de P L con DR0 - Todos los Ambientes . . . . . . . . . . . . . . . . . . . 58 5.15. Ajustes de P L con DR3 - Todos los Ambientes . . . . . . . . . . . . . . . . . . . 59 5.16. Tendencia de Promedios de Pérdidas de Paquetes con DR0 - Medición 1 . . . . . 60

Pablo Avila Campos

xiv

Universidad de Cuenca 5.17. Promedios de Pérdidas de Paquetes con DR0 - Todos los Ambientes . . . . . . . 61 5.18. Promedios de Pérdidas de Paquetes con DR3 - Todos los Ambientes . . . . . . . 61
A.1. Esquema de conﬁguración del kit LoRa [9] . . . . . . . . . . . . . . . . . . . . . . 69 A.2. Instalación de la suite de desarrollo de LoRa . . . . . . . . . . . . . . . . . . . . . 70 A.3. Virtualización de Docker en Windows . . . . . . . . . . . . . . . . . . . . . . . . 71 A.4. Reglas de Reenvío de Puertos . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72 A.5. Conﬁguración de IP estática en adaptador de red Ethernet . . . . . . . . . . . . 73 A.6. Terminal Docker . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 74 A.7. Software de Utilidades de LoRa Microchip . . . . . . . . . . . . . . . . . . . . . . 75 A.8. Software de Utilidades de LoRa Microchip - Gateway . . . . . . . . . . . . . . . . 76 A.9. Conﬁguración para Personalización Auto-Creada . . . . . . . . . . . . . . . . . . 77 A.10.Conexión con el servidor MySQL . . . . . . . . . . . . . . . . . . . . . . . . . . . 77 A.11.Habilitación de ocho canales en el módulo RN . . . . . . . . . . . . . . . . . . . . 78 A.12.Envio de un mensaje Uplink desde el módulo RN . . . . . . . . . . . . . . . . . . 79 A.13.Cambio de Región del Gateway . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79
C.1. Medición de RSSI del Ambiente 1 con DR0 - Río Tomebamba . . . . . . . . . . . 92 C.2. Medición de RSSI del Ambiente 1 con DR3 - Río Tomebamba . . . . . . . . . . . 93 C.3. Medición de RSSI del Ambiente 1, orilla 2 con DR0 - Río Tomebamba . . . . . . 93 C.4. Medición de RSSI del Ambiente 1, orilla 2 con DR3 - Río Tomebamba . . . . . . 94 C.5. Medición de RSSI del Ambiente 2 con DR0 - Río Machángara . . . . . . . . . . . 94 C.6. Medición de RSSI del Ambiente 2 con DR3 - Río Machángara . . . . . . . . . . . 95 C.7. Medición de RSSI del Ambiente 3 con DR0 - Río Yanuncay . . . . . . . . . . . . 95

Pablo Avila Campos

xv

Universidad de Cuenca C.8. Medición de RSSI del Ambiente 3 con DR3 - Río Yanuncay . . . . . . . . . . . . 96 C.9. Medición de SNR del Ambiente 1 con DR0 - Río Tomebamba . . . . . . . . . . . 97 C.10.Medición de SNR del Ambiente 1 con DR3 - Río Tomebamba . . . . . . . . . . . 97 C.11.Medición de SNR del Ambiente 1, orilla 2 con DR0 - Río Tomebamba . . . . . . 98 C.12.Medición de SNR del Ambiente 1, orilla 2 con DR3 - Río Tomebamba . . . . . . 98 C.13.Medición de SNR del Ambiente 2 con DR0 - Río Machángara . . . . . . . . . . . 99 C.14.Medición de SNR del Ambiente 2 con DR3 - Río Machángara . . . . . . . . . . . 99 C.15.Medición de SNR del Ambiente 3 con DR0 - Río Yanuncay . . . . . . . . . . . . 100 C.16.Medición de SNR del Ambiente 3 con DR3 - Río Yanuncay . . . . . . . . . . . . 100

Pablo Avila Campos

xvi

Universidad de Cuenca
Índice de tablas
2.1. Descripción de campos del mensaje MAC . . . . . . . . . . . . . . . . . . . . . . 17 2.2. Direcciones Almacenadas en el Dispositivo Final . . . . . . . . . . . . . . . . . . 18 2.3. Tabla de tasas de Datos (DR) [4] . . . . . . . . . . . . . . . . . . . . . . . . . . . 19 2.4. Tabla de potencias de Transmisión [4] . . . . . . . . . . . . . . . . . . . . . . . . 20 4.1. Tasas de Datos Permitidas . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39 5.1. Resultados de Desviación Estándar con diferentes número de paquetes . . . . . . 47 5.2. Variación de Índices de Potencia . . . . . . . . . . . . . . . . . . . . . . . . . . . 47 5.3. Valores P del Test de Dunn . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51 5.4. Valores utilizados para el cálculo de las pérdidas de trayectoria . . . . . . . . . . 52 5.5. Compraración de Características de Propagación con DR0 . . . . . . . . . . . . . 58 5.6. Comparación de Características de Propagación con DR3 . . . . . . . . . . . . . 59

Pablo Avila Campos

xvii

Universidad de Cuenca
Dedicatoria
A mi madre Gloria. Por el ejemplo de perseverancia y constancia que la caracterizan, por sus consejos, valores y la motivación que siempre me ha dado, lo que me ha permitido ser una persona de bien, pero más que nada, por su amor. Pablo Avila

Pablo Avila Campos

xxii

Universidad de Cuenca
Agradecimientos
A mis familiares. A mis tíos Olga, Lucy, Hugo, Fredy, Diana, mi abuela Carmela, mi padre Manuel y a todos aquellos que siempre me apoyaron, creyeron en mi y que participaron directa o indirectamente en la elaboración de esta tesis. ¡Gracias a ustedes!
A mis maestros. A todos quienes marcaron cada etapa de mi vida universitaria pero especialmente a los Ingenieros Fabián Astudillo y Andrés Vázquez por su gran apoyo y motivación para la elaboración de esta tesis. Pablo Avila

Pablo Avila Campos

xxiii

Universidad de Cuenca
Abreviaciones y Acrónimos
BW Bandwidth. 15, 16 CR Coding Rate. 15 DR Data Rate. 7, 15, 16, 23 GPIO General Purpose Input/Output. 8 LoRa Long Range. 3–5, 7–9, 19, 23 LoRaWAN Long Range Wide Area Network. 3–5, 7, 10, 15, 16, 22, 23, 27 LPWAN Low Power Wide Area Network. 3 PER Packet Error Rate. 4, 7, 19, 28 RSSI Received Signal Strength Indicator. 4, 5, 7, 11, 14–19, 22, 28, 33, 38 SF Spreading Factor. 15, 16, 23 SNR Signal to Noise Ratio. 4, 7, 14–17, 19, 28, 33, 38 SPI Serial Peripheral Interface. 7 WiFi Wireless Fidelity. 3 WSN Wireless Sensor Network. 3, 13

Pablo Avila Campos

xxiv

Universidad de Cuenca
Capítulo 1
Introducción
En este capítulo, se presenta el problema a tratar, así como la justiﬁcación, el alcance y los objetivos general y especíﬁcos a cumplir durante esta investigación.

Pablo Avila Campos

2

Universidad de Cuenca
1.1. Identiﬁcación del Problema
Se estima que para 2020, más de cincuenta billones de dispositivos estarán conectados mediante comunicaciones inalámbricas. [10] Esto es parte del enfoque de hacer más con menos que se encuentra con trabas al aplicar redes tradicionales como las celulares o tecnologías como WiFi debido a los requerimientos de escalabilidad y enegía. Muchos de estos dispositivos serán parte de redes de sensores inalámbricos (WSN), por sus siglas en inglés. De hecho, actualmente, las WSN cubren un amplio rango de aplicaciones, una de las que se ha desarrollado con mas éxito es la del monitoreo ambiental. [11]
Es por esto que surgen proyectos como el de Aplicación de tecnologías inalámbricas al sistema de predicción de caudales en la cuenca del río Tomebamba [12], realizado por el Departamento de Eléctrica, Electrónica y Telecomunicaciones (DEET) en beneﬁcio del Programa para el Manejo del Agua y Suelo (PROMAS). En este proyecto, se pretende utilizar una tecnología que es parte de las WSN, llamada LoRaWAN para conectar nodos con sensores limnigráﬁcos 1. Para este tipo de proyectos que utilizan tecnologías nuevas, es necesario tener un primer acercamiento que permita facilitar la implementación del mismo.
Junto al desarrollo de nuevas tecnologías como LoRaWAN, surgen también dudas relacionadas con el comportamiento de las mismas en ambientes especíﬁcos, como el mencionado anteriormente. Este comportamiento puede depender de diferentes factores que determinan su efectividad. Estos factores deben ser deﬁnidos con el objetivo de lograr el mejor provecho con respecto al alcance o a la conﬁabilidad que provee dicha tecnología.
1.2. Justiﬁcación
LoRaWAN es parte de las llamadas redes de área extensa y bajo consumo (LPWAN) por sus siglas en inglés, que representan una nueva tendencia en la evolución en las telecomunicaciones [14]. LoRaWAN utiliza los beneﬁcios de LoRa. LoRa es una tecnología de radio frecuencia propietaria que se caracteriza por el uso eﬁciente de la energía con baterías que pueden durar hasta 10 años, cobertura con línea de vista de más de 10 km en entornos rurales, así como un rápido despliegue de red con nodos de bajo costo [3, 15]. Estos nodos pueden recolectar y transmitir información en tiempo real como temperatura, lluvia, humedad y otras variables
1Medidores de los niveles de agua de los ríos, lagos o algún cuerpo de agua, se usan para la predicción de crecidas (máximas alturas de agua), deﬁnir o delinear zonas con riesgo de inundación y para proyectar estructuras (puentes u otras obras hidráulicas).[13]

Pablo Avila Campos

3

Universidad de Cuenca
climáticas [16], haciendo propicia a esta tecnología en entornos forestales como el propuesto en el proyecto mencionado [12].
De manera especíﬁca, LoRaWAN, es una capa de acceso al medio (MAC), creada con el objetivo de utilizar la modulación LoRa de la mejor manera y enfocarla al internet de las cosas (IoT) [4], por sus siglas en inglés. La información de los sensores, es transmitida a los Gateway, mediante un salto, para luego ser enviada a servidores web, en los que puede ser procesada para inﬁnidad de aplicaciones. Entre los beneﬁcios que agrega LoRaWAN están el direccionamiento, la seguridad a través de encriptación AES de 128 bits, y comandos MAC que hacen que el desarrollo de una red LoRaWAN sea rápido y preciso [4, 17, 18].
Hasta el momento, se han realizado estudios sobre desempeño, escalabilidad, propagación general en interiores y exteriores [2, 14, 16–23] pero dado que LoRaWAN es una tecnología aún nueva, no se han reportado estudios de evaluación de rango de transmisión en ambientes forestales.

1.3. Alcance
La contribución de este trabajo se centra en el desarrollo de un modelo de pérdidas de trayectoria que facilite el desarrollo de redes de sensores con tecnología LoRaWAN. Para lograr esto, se harán mediciones del Indicador de Nivel de Señal Recibida (RSSI), por sus siglas en inglés, utilizando el Kit de Evaluación LoRa 900, de Microchip [26]. Este kit permite la modiﬁcación de diferentes parámetros como el Factor de Ensanchamiento (SF), Ancho de Banda (BW) y Potencia de Transmisión, conforme los establecido en LoRaWAN [4], con las cuales, se pueden obtener diferentes alcances, permitiendo evaluar el rango de transmisión.
Se realizarán conjuntos de mediciones en la margen del río Tomebamba, en las que un nodo LoRa actuará como transmisor, y el Gateway del kit como receptor. La tasa de paquetes recibidos (PER), por sus siglas en inglés, actuará como parámetro de calidad general de la red. Las transmisiones serán receptadas por el Gateway, que a su vez las transmitirá al servidor, el mismo, irá guardando un registro de los RSSI, SNR y PER de las transmisiones.
Luego de obtenidos los datos, se propone ajustar una curva de pérdidas de trayectoria basada en RSSI, esto permitirá tener un modelo empírico de pérdidas para el área requerida [24–26], cumpliendo así con el objetivo principal de este trabajo de investigación.

Pablo Avila Campos

4

Universidad de Cuenca
1.4. Objetivos
1.4.1. Objetivo General
Ajustar un modelo de pérdidas de trayectoria basado en RSSI que permita realizar modelos analíticos y simulaciones para facilitar la implementación de redes de sensores con tecnología LoRaWAN en márgenes de ríos con entornos forestales.
1.4.2. Objetivos especíﬁcos
• Hacer un análisis del estado del arte, así como de la metodología de medición. • Conﬁgurar el kit de desarrollo de LoRa con LoRaWAN, para el envío y captura de datos. • Hacer dos conjuntos mediciones en las que se tomarán muestras de RSSI a distancias ﬁjas
y variables. • Ajustar un modelo pérdidas de trayectoria adecuado para el uso de LoRa en márgenes de
ríos con ambientes forestales.

Pablo Avila Campos

5

Universidad de Cuenca
Capítulo 2
Marco Teórico
En el presente capítulo, se muestra de manera detallada el funcionamiento de LoRaWAN, partiendo desde una base general en la que se explican conceptos de Redes de Sensores Inalámbricos hasta el funcionamiento y aspectos importantes de la modulación LoRa y la manera en la que se puede utilizar el RSSI para determinar un modelo de pérdidas de propagación.

Pablo Avila Campos

6

Universidad de Cuenca
2.1. Introducción
Se estima que para 2020, más de cincuenta billones de dispositivos estarán conectados mediante comunicaciones inalámbricas [10]. Para esto, será necesaria la siguiente generación de sistemas de comunicación, llamada 5G. 5G debe integrar de manera nativa los servicios del Internet de las Cosas (IoT), sin degradar la calidad de los servicios tradicionales.
Hasta el momento, el término IoT ha sido utilizado para una variedad de tecnologías que en general intentan conectar objetos físicos al internet [3]. La principal diferencia entre el Internet tradicional y el Internet de las Cosas es que en IoT los dispositivos tienen menos recursos disponibles como memoria, potencia de procesamiento, ancho de banda y energía [10].
Esta tendencia de hacer más con menos se ha encontrado con restricciones tecnológicas en las redes inalámbricas actuales que no cumplen con los requerimientos energéticos ni de escalabilidad necesarios. Es por esto que han emergido nuevos protocolos y tecnologías como las Redes de Amplia Cobertura y Baja Potencia (LPWAN). Esta tecnología permite el desarrollo de redes de área amplia con Gateways y adaptar parámetros como la tasa de transmisión, potencia, modulación, etc, de tal manera que los dispositivos ﬁnales, llamados nodos sean eﬁcientes en cuanto al gasto energético [10].

2.2. Redes de Sensores Inalámbricos
Debido en gran medida a los recientes avances en tecnologías inalámbricas y de electrónica digital, el diseño y desarrollo de nodos sensores de bajo costo y bajo consumo energético, se ha vuelto factible [27].
Las propiedades de los nodos individuales ubicados, por lo general, en diferentes puntos geográﬁcos, presentan retos a los protocolos de comunicación en términos de consumo de energía. Es por esta razón que su enfoque principal se centra en la eﬁciencia energética al contrario que en redes tradicionales que se centran en mejorar el desempeño de retardo o cantidad de información procesada.
Las WSN se deﬁnen como sensores distribuidos que monitorean parámetros físicos o ambientales y que usualmente colaboran para transportar esa información hacia servidor o un nodo central [28].

Pablo Avila Campos

7

Universidad de Cuenca
2.2.1. Principales Tecnologías de IoT
En esta sección, se realiza una breve revisión de tecnologías relacionadas con IoT para proveer de una mejor perspectiva acerca de LoRaWAN [10]:

IEEE 802.15.4 es un estándar que deﬁne las capas física y de enlace para Redes Inalámbricas Personales de Baja Tasa de Transmisión (LR-WPAN) [29]. Entre sus principales características está el soporte de bandas sin licencia (868 MHz, Europa; 928 MHz, Norte América; 2.4 GHz, mundial). Ofrece tasas de datos de hasta 250 kbps y alcances con línea de vista (LOS) de hasta 1000 m. Sobre IEEE 802.15.4 se puede utilizar Zigbee que es una tecnología que ofrece perﬁles de comunicaciones y una capa de red [30].
Bluetooth/LE fue originalmente creado para reemplazar inalámbricamente cables de dispositivos que típicamente se conectan entre sí, como teléfonos celulares, computadoras portátiles, dispositivos de audio, teclados, etc. Ofrece bajas tasas de datos de alrededor de 1 Mbps y corto alcance con distancias típicas de 5-10 m con bajo consumo energético. Luego de varias revisiones, en 2016 se presentó Bluetooth 5.0 [31]. Esta versión se encuentra sumamente enfocada en IoT. Es completamente compatible con la anterior versión 4.2, aumenta el ancho de banda hasta 2 Mbps, modo de bajo consumo (LE), por sus siglas en inglés, con alcances de hasta 240 m.
IEEE 802.11 ah provee un estándar LAN [32]. En comparación a IEEE 802.11 que opera a 2.4 GHz y 5 GHz, IEEE 802.11 ah soporta mayores rangos de transmisión de hasta 1 km a una potencia por defecto de 200 mW. Este estándar puede operar con un ancho de banda de 4 o 7.8 Mbps. Gracias a los nuevos esquemas de modulación y codiﬁcación de 802.11 ac se pueden alcanzar tasas de transferencia de cientos de Mbps.
Sigfox fue la primera tecnología LPWAN propietaria, propuesta para el consumidor. Su capa física utiliza una modulación de banda ultra estrecha (UNB). Teóricamente cada Gateway Sigfox puede soportar hasta un millón de dispositivos conectados con un área de cobertura de 30-50 km en entornos rurales y 3-10 km en áreas urbanas [33]. Cada nodo puede enviar hasta 140 mensajes por dia, a una tasa de datos de hasta 100 bps.

Pablo Avila Campos

8

Universidad de Cuenca
2.3. Redes de Amplia Cobertura y Baja Potencia (LPWAN)
El ecosistema IoT es amplio, conteniendo dispositivos con tasas de datos que van desde unos cuantos bps a Mbps. La cobertura es también variable desde pocos centímetros a varios kilómetros. LPWAN se encarga de cubrir estas necesidades en nuevas aplicaciones que surgen a diario [34].
2.3.1. Características Principales de una red LPWAN
Aunque estas redes deben cubrir diferentes necesidades, existen requerimientos comunes en el diseño de una red LPWAN:
• Su funcionamiento debe requerir un mínimo consumo energético. Esto dado a la limitada capacidad de las baterías actuales y su elevado costo.
• El costo es un factor importante. Especialmente en los nodos, se deben proveer herramientas de fácil instalación y tanto el hardware como el software deben ser limitados.
• El nivel de actividad depende de la aplicación, sin embargo, el dispositivo debe ser capaz de despertar únicamente al enviar información. Este punto apoyaría la idea de las arquitecturas tipo estrella contra las arquitecturas en malla.
• La infraestructura de red debe ser fácil de montar. La adición de dispositivos o el traslado a otros países debe cumplir con algún estándar.
• La transferencia de información entre el objeto y el usuario ﬁnal, debe ser segura. • Aunque en la mayoría de aplicaciones, los objetos no se encuentran en movimiento, por
lo que el canal se mantiene constante, la robustez de modulación es una característica valiosa.
2.4. Aspectos básicos de la modulación LoRa
LoRa es un esquema de modulación propietario derivado de la modulación de espectro ensanchado con chirps (CSS), cuyo objetivo principal es mejorar la sensibilidad a costa de una reducción en la tasa de datos para un ancho de banda (BW) dado. Implementa tasas de datos variables, usando factores de ensanchamiento (SF) ortogonales, lo que permite hacer un compromiso entre tasa de datos y alcance, así como optimizar el desempeño de la red con un ancho de banda constante.

Pablo Avila Campos

9

Universidad de Cuenca
LoRa es una implementación de capa física y no depende de implementaciones en capas superiores. Esto le permite coexistir con diferentes arquitecturas de red. A continuación, se presentan algunos conceptos básicos sobre la modulación LoRa y las ventajas de desarrollar una red LPWAN. [1]
2.4.1. Principios del Espectro Ensanchado
En teoría de la información, el teorema de Shannon - Hartley, deﬁne la máxima tasa a la que la información puede ser transmitida en un canal de comunicaciones con un ancho de banda especíﬁco en presencia de ruido.
De esta conocida ecuación, se puede concluir que si se incrementa el ancho de banda, se puede compensar la degradación del SNR del canal de radio.
En los sistemas de Espectro Ensanchado por Secuencia Directa (DSSS), la fase de la portadora del transmisor cambia de acuerdo a una secuencia de código. Este proceso se logra multiplicando la señal de datos deseada con un código de ensanchamiento, conocido como secuencia chip. Esta secuencia chip tiene una más alta tasa que la señal de datos por lo que ensancha el ancho de banda de la señal original. Esto se observa en la Figura 2.1.
De esta manera, se produce una ganancia de procesamiento además de una reducción en la cantidad de interferencia. DSSS es ampliamente utilizado en aplicaciones de comunicación, sin embargo se presentan retos cuando se necesita reducir el costo y el gasto energético de los dispositivos con esta tecnología.

Figura 2.1: Proceso de ensanchamiento [1]

Pablo Avila Campos

10

Universidad de Cuenca
2.4.2. Espectro Ensanchado LoRa

La modulación LoRa, resuelve los problemas de DSSS proveyendo una alternativa de menor costo y menor consumo energético.
En la modulación LoRa, se logra el espectro ensanchado generando una señal chirp que varía continuamente en frecuencia, como se observa en la Figura 2.2. Una ventaja de este método es que las variaciones de temporización y frecuencia entre el transmisor y el receptor son equivalentes, reduciendo la complejidad del receptor. El ancho de banda de este chirp es equivalente al ancho de banda espectral de la señal. La señal deseada es ensanchada con un chip y modulada sobre un chirp. La relación entre la tasa de datos deseada, la tasa de símbolos y la tasa de chips para LoRa, se puede expresar de la siguiente manera:
En la ecuación 2.1, se deﬁne la tasa de bits de la modulación, Rb

Donde: Donde:

Rb

=

SF

∗

C ódig odetasa

2SF

bits/sec

BW

C ódig odetasa

=

4

4 + CR

(2.1) (2.2)

• SF = Factor de ensanchamiento, que puede variar entre 7 y 12 • CR = Tasa de codiﬁcación, que varía entre 1 y 4 • BW = Ancho de Banda (Hz)

Figura 2.2: Extracto del Espectrograma de un chirp (SF=8, BW=125kHz) [2]

Pablo Avila Campos

11

Universidad de Cuenca
2.4.3. Parámetros de Transmisión
Como se ha mencionado ya anteriormente, un dispositivo LoRa, puede ser conﬁgurado para utilizar diferente Potencia de Transmisión (TP), Frecuencia de Portadora (CF), Factor de Ensanchamiento (SF), Ancho de banda (BW) y Tasa de Codiﬁcación (CR) para conseguir el mejor desempeño de conexión y menor consumo energético.
La combinación de estas variables resulta en alrededor de 6720 posibles conﬁguraciones, lo que permite al usuario ajustar completamente LoRa a su aplicación [35]. A continuación, se hace una breve descripción de cada uno de los parámetros mencionados [36]:
1. Potencia de Transmisión (TP): (TP) en LoRa, puede ser variado entre -4 dBm y 20 dBm, pero debido a límites de implementación, se puede ajustar de 2 dBm a 20 dBm. Con potencias mayores a 17 dBm sólo se puede usar el 1 % del ciclo de trabajo.
2. Frecuencia de Portadora (CF): Es la frecuencia central que puede ser variada en saltos de 61 Hz entre 137 MHz y 1020 MHz, dependiendo del chip y la región de uso.
3. Factor de Ensanchamiento (SF): Es la razón entre la tasa de símbolos y la tasa de chips. Un mayor SF no solo incrementa el SNR, el alcance y la sensibilidad, sino también el tiempo aire del paquete. Cada incremento en el SF también disminuye a la mitad la tasa de transmisión, duplica la duración de la transmisión y el consumo de energía. El SF puede variar entre 6 y 12, siendo útil para la separación de redes ya que los SF son ortogonales.
4. Ancho de banda (BW): Es el rango de frecuencias en la banda de transmisión. Un BW mayor, da una mayor tasa de datos (menor tiempo aire), pero menor sensibilidad por agregación de ruido. Un menor BW requiere cristales mas precisos, es decir menos partes por millón (ppm). Los datos son enviados a una tasa de chips equivalente al BW; un BW de 125 kHz equivale a una tasa de chips de 125 kcps. Una red LoRa típica opera en: 125 kHz, 250 kHz o 500 kHz.
5. Tasa de Codiﬁcación (CR): CR es la tasa de corrección de errores hacia adelante (FEC) usada por LoRa en contra de interferencias y puede ser conﬁgurada con: 4/5, 4/6, 4/7 y 4/8. Un CR mayor ofrece más protección frente a ruido, pero incrementa el tiempo aire. Transmisores con diferente CR pueden comunicarse ya que el CR se encuentra en una cabecera del paquete que siempre se encuentra codiﬁcado a 4/8.
2.4.4. Propiedades Clave de la Modulación LoRa
A continuación, se presentan algunos aspectos clave que resaltan a LoRa y lo convierten en el mejor candidato para aplicaciones IoT [1]:

Pablo Avila Campos

12

Universidad de Cuenca
• Ancho de Banda Escalable: Puede usarse en saltos de frecuencia de banda estrecha y en aplicaciones de secuencia directa de banda ancha.
• Bajo Consumo Energético: La potencia de salida puede reducirse en comparación a FSK manteniendo el mismo o mejor presupuesto de enlace.
• Alta Robustez: Debido a naturaleza asíncrona, la señal LoRa es resistente a interfencias en y fuera de banda.
• Resistente a Desvanecimiento: Gracias a la banda ancha de los pulsos chirp, LoRa ofrece inmunidad a desvanecimiento y multitrayectoria, haciéndolo ideal para ambientes urbanos y suburbanos.
• Resistente a Doppler: El desplazamiento Doppler provoca un pequeño desplazamiento de frecuencia en el impulso LoRa que introduce un desplazamiento insigniﬁcante en el eje de tiempo de la señal de banda base, haciéndolo inmune al efecto Doppler.
• Capacidad de Amplia Cobertura: Comparado con FSK, manteniendo una misma potencia de transmisión, el presupuesto de enlace es mayor en LoRa.
• Capacidad de Red Mejorada: La modulación de SemTech LoRa emplea SF ortogonales que permiten transmitir múltiples señales de propagación al mismo tiempo y en el mismo canal sin una degradación considerable de la sensibilidad RX. Las señales moduladas con diferentes SF aparecen como ruido al receptor objetivo y pueden ser tratadas como tales.

2.5. LoRa MAC: LoRaWAN
LoRaWAN es un protocolo de red creado por la LoRa Alliance1 que optimiza los parámetros de LoRa para un menor consumo energético en dispositivos ﬁnales (nodos).
Las redes LoRaWAN son redes centralizadas que utilizan típicamente una topología estrella en la cual los gateways pasan los paquetes entre los dispositivos ﬁnales (nodos o motas) y un servidor de red central. Los gateways se conectan al servidor de red vía IP mientras que los dispositivos ﬁnales utilizan transmisiones de un solo salto con LoRa o FSK. Aunque la comunicación es bidireccional, el ﬂujo de información desde el dispositivo ﬁnal al gateway corresponde al tráﬁco predominante [4]. En la ﬁgura 2.3 se observa la arquitectura de un sistema LoRaWAN.

1https://www.lora-alliance.org/

Pablo Avila Campos

13

Universidad de Cuenca
Figura 2.3: Arquitectura del sistema LoRaWAN [3] La comunicación entre dispositivos ﬁnales y gateways utiliza diferentes frecuencias y canales, utilizando las siguientes reglas:
• El dispositivo ﬁnal cambia de canal de manera pseudoaleatoria en cada transmisión. • El dispositivo ﬁnal respeta el máximo ciclo de trabajo de transmisión relativo a la sub-
banda y a las regulaciones locales. • El dispositivo ﬁnal respeta la máxima duración de transmisión. Una transmisión con LoRaWAN, utiliza las capas que se observan en la Figura 2.4.

Figura 2.4: Arquitectura del protocolo LoRaWAN [3]

Pablo Avila Campos

14

Universidad de Cuenca
2.5.1. Clases en LoRaWAN
LoRaWAN deﬁne tres clases que fueron diseñadas para diferentes aplicaciones en las cuales se hace un compromiso entre gasto energético y latencia. Todos los dispositivos LoRaWAN deben implementar al menos la clase A y ser compatibles con la misma. En la Figura 2.5, se observa la ubicación de las clases con respecto a las capas de LoRa.

Figura 2.5: Clases LoRaWAN
• Clase A: Los dispositivo ﬁnales de clase A, permiten comunicación bidireccional ya que luego de cada transmisión uplink (nodo al servidor) existen dos ventanas downlink (servidor al nodo). La operación de clase A es la que menos consumo de energía produce.
• Clase B: Los dispositivos ﬁnales de clase B, permiten más ventanas de recepción. En adición a las ventanas de recepción de la clase A, la clase B abre ventanas de recepción extra en tiempos ﬁjos. Esto se logra enviado Beacons desde el gateway para ﬁjar el tiempo en el que el dispositivo ﬁnal debe estar en modo de escucha.
• Clase C: Los dispositivos ﬁnales de clase C tienen ventanas de recepción casi continuas que solo se cierran cuando se encuentra transmitiendo. Los dispositivos clase C consumen más energía para su funcionamiento que la Clase A o Clase B, pero ofrecen la menor latencia entre el servidor y el dispositivo ﬁnal.
Ya que todos los dispositivos LoRaWAN deben implementar al menos la Clase A y que el dispositivo a utilizar en este trabajo utiliza esta clase, en los siguientes puntos se explicará el protocolo desde este punto de vista.

Pablo Avila Campos

15

Universidad de Cuenca
2.5.2. Formatos de Mensajes Físicos - Clase A
En LoRaWAN, se distiguen mensajes uplink (nodo al servidor) y downlink (servidor al nodo).
Mensajes Uplink Estos mensajes son enviados por dispositivos ﬁnales hacia uno o varios gateways, los que los reenvían hacia el servidor. Estos mensajes utilizan el modo explícito en el cual se incluye una cabecera física LoRa (PHDR) más un encabezado CRC (PHDR CRC). La integridad de la carga útil es protegida por el CRC. Estos encabezados son agregados por el transceptor. La estructura de un mensaje Uplink, se observa en la Figura 2.6.
Figura 2.6: Estructura Física de Uplink[4]
Mensajes Downlink Cada mensaje downlink es enviado por el servidor de red a uno de los dispositivos ﬁnales, siendo reenviado por un solo gateway. Figura 2.7.
Figura 2.7: Estructura Física de Downlink[4]
Ventanas de Recepción Como se mencionó anteriormente, luego de cada transmisión uplink, el dispositivo ﬁnal abre dos ventanas cortas de recepción. Para deﬁnir el inicio se utiliza el ﬁnal de la transmisión como referencia. Figura 2.8.

Figura 2.8: Temporización de Recepción[4]

Pablo Avila Campos

16

Universidad de Cuenca
2.5.3. Formatos de Mensajes MAC - Clase A
Todos los mensajes uplink y downlink llevan una carga útil PHY que empieza por un encabezado MAC de un octeto (MHDR), seguido por una carga útil MAC (MACPayload) y ﬁnalizando con un mensaje de integridad de código de 4 octetos (MIC). Las diferentes partes del mensaje Clase A, se observa en la Figura 2.9.

Figura 2.9: Formato de Mensaje LoRa[4]

En la Tabla 2.1, se da la descripción de las diferentes partes del mensaje:

Tabla 2.1: Descripción de campos del mensaje MAC Campo de Mensaje MAC LoRa Descripción

MHDR MAC Payload MIC FHDR FPort FRMPayload Devaddr FCtrl FCnt FOpts

Encabezado MAC, un octeto de longitud Datos de la capa superior Código de Integradad de Mensaje, cuatro octetos de longitud Encabezado de trama Campo opcional de puerto Campo opcional de carga útil de trama Dirección del dispositivo Octeto de control de trama Contador de trama, dos octetos de longitud Opciones de trama, para enviar comandos MAC, 15 octetos

Pablo Avila Campos

17

Universidad de Cuenca
2.5.4. Activación de Dispositivos Finales
Para ser parte de una red LoRa, cada dispositivo debe ser activado. Esta activación se puede hacer de dos maneras: Activación en el Aire (OTAA), cuando se desea agregar un dispositivo nuevo o, Activación por Personalización (ABP). [4]

Datos Almacenados en el Dispositivo Final
Después de la activación, se almacena la siguiente información en el dispositivo ﬁnal: Una dirección de dispositivo (DevAddr), un identiﬁcador de Aplicación (AppEUI), una clave de sesión de red (NwkSKey) y una clave de sesión de aplicación (AppSKey). La descripción de estas direcciones se muestra en la Tabla 2.2.

Clave

Tabla 2.2: Direcciones Almacenadas en el Dispositivo Final Descripción

DevAddr AppEUI NwkSKey AppSKey

Consiste de 32 bits que identiﬁcan al dispositivo en la red Es un identiﬁcador global que identiﬁca a una entidad capaz de procesar una trama de solicitud de agregación. Es usada por el servidor de red y el dispositivo ﬁnal para calcular el MIC. Se usa para encriptar y desencriptar la carga útil del campo de carga útil en mensajes MAC. Se usa para encriptar y desencriptar la carga útil del campo de carga útil en mensajes de datos especíﬁcos de una aplicación.

Activación en el Aire (OTAA)
Para esta activación, los dispositivos ﬁnales deben seguir un procedimiento de agregación antes del envío de información con el servidor de red. Una OTAA requiere que el dispositivo ﬁnal tenga la siguiente información antes del procedimiento de agregación: un identiﬁcador único global (DevEUI), el identiﬁcador de aplicación (AppEUI) y la clave AES-128 (AppKey).
• Identiﬁcador de Dispositivo Final (DevEUI): Es una identiﬁcación global en el espacio de direcciones IEEE EUI64 que identiﬁca de manera única al dispositivo.
• Clave de Aplicación (AppKey): Es una clave AES-128 única del dispositivo. Cuando el dispositivo ﬁnal realiza una OTAA, se utiliza la AppKey para generar la NwkSKey y AppSKey especíﬁcas del dispositivo que son usadas para encriptar y veriﬁcar la comunicación con la red.

Pablo Avila Campos

18

Universidad de Cuenca

Tabla 2.3: Tabla de tasas de Datos (DR) [4]

Tasa de Datos (DR) Conﬁguración Tasa de bits física (bit/sec)

0 1 2 3 4 5:7 8 9 10 11 12 13 14:15

SF10 / 125 kHz SF9 / 125 kHz SF8 / 125 kHz SF7 / 125 kHz SF8 / 500 kHz RFU SF12 / 500 kHz SF11 / 500 kHz SF10 / 500 kHz SF9 / 500 kHz SF8 / 500 kHz SF7 /500 kHz RFU

980 1760 3125 5470 12500
980 1760 3900 7000 12500 21900

El procedimiento que siguen los dispositivos consiste en un mensaje de solicitud de agregación o activación en el que se incluye AppEUI y DevEUI. El servidor de red responde con un mensaje de aceptación de agregación que contiene una dirección de dispositivo ﬁnal (DevAddr) y un campo AppNonce que es usado por el dispositivo para calcular la NwkSKey y AppSKey.
Activación por Personalización (ABP) Bajo determinadas circunstancias, los dispositivos ﬁnales pueden ser activados o agregados a la red por personalización. Este procedimiento agrega al dispositivo directamente a la red sin la necesidad de los mensajes de solicitud y aceptación de la red utilizados en la ABP.
Esta activación requiere que las claves la DevAddr y las dos claves de sesión NwkSKey y AppSKey estén ya almacenadas en el dispositivo ﬁnal. Cada dispositivo debe tener NwkSKey y AppSKey únicas, para no comprometer la seguridad de la comunicación de otros dispositivos. Estas claves deben ser creadas de tal manera que no puedan ser calculadas a partir de información pública.

2.5.5. Tasa de Datos (DR) y Potencia de Transmisión
LoRaWAN cumple con las regulaciones establecidas por la FCC que impone un tiempo máximo de transmisión de 400 ms en Uplink en la banda US 902-928 MHz. En la Tabla 2.3 se presentan los DR permitidos con sus respectivas conﬁguraciones.

Pablo Avila Campos

19

Universidad de Cuenca Las potencias de transmisión por su parte, se especiﬁcan en la Tabla 2.4.

Tabla 2.4: Tabla de potencias de Transmisión [4]

TXPower

Conﬁguración

0 1 2 3:9 10 11:15

30 dBm - 2*TXPower 28 dBm 26 dBm ... 10 dBm RFU

2.6. Modelo de Pérdidas de Trayectoria
El indicador de energía de la señal RSSI, mide la intensidad de la señal que llega al receptor en dBm. Este parámetro de la señal, ha sido ampliamente usado para medir la calidad de la propagación en diferentes ambientes y con diferentes tecnologías [20, 22, 24, 37]. Se usa para posicionamiento y rastreo en nodos móviles como se evidencia en [38–40]. En cualquier caso, se debe tomar en cuenta que los valores de RSSI ﬂuctúan debido a cambios en el ambiente que afectan a la propagación.

Modelo de Pérdidas

Para que los resultados de un estudio sean útiles, usualmente se genera un modelo de pérdidas de trayectoria. Estos modelos reﬂejan la reducción de potencia de la señal mientras se propaga por el espacio y comúnmente se expresan de manera logarítmica, como se muestra en la Ecuación 2.3 [24].

PL(dB)

=

P0(dBm)

+

20log(

d d0

)

+

Xθ

(2.3)

dónde d y d0 son la distancia de transmisión y la distancia de referencia, mientras que P0 es el nivel de potencia en d0. Xθ es una variable aleatoria con distribución normal con desviación estándar θ

La otra manera comúnmente usada para expresar la propagación en entornos forestales introducida por Weissberger y modiﬁcada en los modelos de ITU-R y COST235 es la de desvanecimiento exponencial que se observa en la Ecuación 2.4 [41].

Pablo Avila Campos

20

Universidad de Cuenca

L(dB) = A ∗ f BdC

(2.4)

dónde f es la frecuencia, d la distancia; A, B y C son ajustados en base a los datos medidos.

En trabajos como [15] y [24], se combina y simpliﬁca los modelos en la Ecuación 2.5.

PL(dB) = a + b ∗ log(d) + Xθ

(2.5)

En el cual a y b son ajustados por los datos medidos, mientras Xθ representa la característica estocástica de la señal debido a ruido y desvanecimiento multitrayectoria. En esta forma, el factor exponencial de distancia es expresado por b, mientras otros factores en (2.3) y (2.4) son incluidos en a.

La aleatoriedad de la señal recibida es calculada con los datos medidos. Se asume una distribución normal con media cero y distribución estándar θ.

Cálculo de Pérdidas de Trayectoria con RSSI y SNR

Para calcular las pérdidas de trayectoria que serán ajustadas a la curva logarítmica descrita por la Ecuación 2.5, se utiliza la Ecuación 2.6, tomada de [15].

PL = |RSSI| + SN R + Ptx + Grx

(2.6)

Donde SNR es el radio señal a ruido, P tx es la potencia radiada por el transmisor y Grx es la ganancia de la antena receptora.

2.7. Conclusiones
LoRa se presenta como una solución tecnológica que ayudará y será parte de 5G. Existen varias tecnologías con características LPWAN que pueden solventar algunas de las necesidades de esta evolución, sin embargo, no fueron diseñadas para cumplir este propósito especíﬁco.
En cuanto a su capa física, se presenta como una modulación de espectro ensanchado que permite la modiﬁcación de parámetros fundamentales como factor de ensanchamiento, ancho de banda, potencia de transmisión y tasa de codiﬁcación, permitiendo al usuario enfocar LoRa a sus necesidades especíﬁcas. Su resistencia a Doppler, bajo consumo energético y grandes rangos de cobertura que superan los 10 km en entornos rurales, la hacen ﬁable para redes de sensores inalámbricos WSN.

Pablo Avila Campos

21

Universidad de Cuenca
Por otro lado, LoRaWAN es un protocolo de red que hace uso de LoRa con un enfoque IoT. A pesar de que muchas de las características variables de LoRa son suprimidas en LoRaWAN, se intenta dar opciones al usuario a través de Clases y se provee seguridad usando diferentes claves que permiten la encriptación de la información.
RSSI se presenta como un indicador de energía recibida que, en conjunto con el SNR, pueden ser utilizados para generar modelos de pérdidas de trayectoria. Estos modelos son usados para caracterizar una tecnología en un ambiente especíﬁco por lo que es importante deﬁnir el tipo de modelo a ajustar.

Pablo Avila Campos

22

Universidad de Cuenca
Capítulo 3
Estado del Arte de LoRa y LoRaWAN
Este capítulo presenta un resumen de los principales trabajos realizados en la capa física LoRa, MAC LoRaWAN y trabajos que analizan de manera general a redes LoRa.

Pablo Avila Campos

23

Universidad de Cuenca
3.1. Introducción
Como se ha mostrado en el capítulo anterior, las ventajas de esta tecnología permiten su uso no solo con el enfoque del Internet de las Cosas como lo propone LoRaWAN sino, con otros enfoques que se han venido desarrollando desde que se presentó LoRa.
A continuación, se mostrarán algunos de estos enfoques y se hará una comparativa que demostrará el estado del arte de LoRa.
3.2. Capa Física - LoRa
Como ya se discutió en el capítulo anterior, la capa física LoRa es propietaria y fue desarrollada por Semtech por lo que las diferentes implemententaciones utilizan chips Semtech. En general los protocolos propietarios no se extienden de igual manera que los libres por lo que se han hecho trabajos [2] que analizan e implementan con un análisis a ciegas (Blind Analysis), diferentes partes de la capa física LoRa. Entre las partes analizadas, están la demodulación, la detección del preámbulo, inicio de trama y cabecera. Otra parte fundamental es la decodiﬁcación en la que se presenta el gray indexing, whitening, entrelazado y FEC. Lo anteriormente mencionado es implementado en gr-LoRa, que se encuentra libre, mejorando el desarrollo del LoRa.
Otro de los puntos claves en la capa física de LoRa es el alcance. Éste ha sido probado en varios trabajos tanto en interiores como en exteriores. En [15], se estudia la cobertura en dos ambientes: en la ciudad de Oulu, Finlandia y en el mar. Para evaluar la cobertura, se estima la tasa de pérdida de paquetes. Se usa una potencia de transmisión de 14 dBm, Factor de ensanchamiento (SF) de 12 y Ancho de Banda (BW) de 125kHz. Se presentan inconvenientes con la tasa de envío de paquetes y la potencia de transmisión, debido a regulaciones de telecomunicaciones del país. Los autores, lograron distancias de 15km en tierra y 30km en mar con pérdidas de hasta el 38 % de envíos.
Otro trabajo que presenta mediciones de propagación en exteriores es [20]. Su característica principal es que considera el área de Fresnel, enfocándose en propagación en espacio libre. El área de medición se divide en de corto y largo alcance. El corto alcance cubre distancias de hasta 6km. Se realizan dos pruebas con diferentes valores de SF, BW, CR y carga útil. Los parámetros de medición son la tasa de errores de paquetes (PER), Indicador de nivel de la señal recibida (RSSI) y la relación señal a ruido (SNR). Los autores lograron una distancia máxima de 6.66 km con un PER <7.3 % con la conﬁguración de la prueba 1 (SF=10, BW=250 kHz, CR= 4/6, DR= 1626.6 bps).

Pablo Avila Campos

24

Universidad de Cuenca
En [22], se prueba la cobertura en interiores de LoRa en un ediﬁcio de concreto reforzado en la ciudad de Praga. Se realizan dos experimentos uno con el receptor en el sótano y otro con el receptor en el techo del ediﬁcio. Se utiliza el RSSI para graﬁcar el mapa de calor del ediﬁcio. Los dispositivos usados no son capaces de cubrir todo el ediﬁcio; sin embargo, se logran mejores resultados con el receptor en el techo, cubriendo casi la totalidad del ediﬁcio.
Otro trabajo en interiores, se presenta en [19]. La ﬁnalidad del mismo es la de comprobar la conﬁabilidad del sistema en casos relacionados con la salud. Un nodo LoRa en el brazo de una persona envía paquetes cada 13 segundos. Los parámetros de transmisión son elegidos para lograr el mayor alcance. SF=12 y BW=125kHz, data rate= 293bps, Ptx= 14 dBm, f=868 MHz. Se envían de 300 a 1800 paquetes en los diferentes lugares. El radio de paquetes correctos fue de 96.7 %, por lo que se concluye que es una tecnología ﬁable para esta aplicación.
LoRa se presenta como una tecnología orientada a redes de sensores por lo que en trabajos como [18], se prueba su conﬁabilidad en esta aplicación. La conﬁabilidad se prueba haciendo que se envíen paquetes durante largos periodos de tiempo y con condiciones de SF y canal, aleatorios. Se concluye que esta tecnología puede ser conﬁable para aplicaciones de sensado remoto de bajo costo; sin embargo, la topografía y la densidad de las ediﬁcaciones juega un rol importante en la propagación de la señal.
En los siguientes trabajos de investigación, se muestra una clara tendencia con respecto a la combinación de LoRa con otras tecnologías que aprovechen de mejor manera características como alcance, ancho de banda o facilidad de implementación de las mismas.
En el caso de [42], la tecnología WiFi se combina con LoRa. WiFi destaca por su mayor ancho de banda y alcance por otro lado LoRa ofrece bajo consumo de potencia y aún mayor alcance. En [21], además de estas dos tecnologías, se usa Bluetooth de baja energía (BLE) y a través de un algoritmo que es controlado por un agente, se toma la decisión de qué tecnología usar. La decisión se basa en maximizar la tasa efectiva y minimizar el gasto de energía. En ambos casos se ve una mejoría, especialmente de los niveles de RSSI.
En resumen, en cuanto a los parámetros comparables entre los trabajos anteriores, la frecuencia es una de las principales variables que deﬁnen el alcance de un sistema de comunicaciones inalámbricas. En el caso de los artículos descritos, todos usan 868MHz excepto por [22] que utiliza 2.4 GHz. Otra variable importante es la potencia de transmisión. Como se sabe, ésto se ve genralmente restringido por las regulaciones de cada país, es así que en [15] y [19] se utiliza 14dBm. El valor de ganancia depende de la antena elegida y varía de 2 a 4.5dBi en [15] y tiene un máximo de 8dBi en [42]. La tasa de bits (BR), depende del valor de SF que tiene un valor de 12 en el caso de [15], [22] y [19], por otro lado 10 en [20]. Se dan valores altos para lograr mayores alcances pero se debe tomar en cuenta que disminuye el BR y el Ancho de Banda (BW). Con respecto al BW, se dan valores de 125KHz en [15], [22] y [19]; un valor de 25KHz en

Pablo Avila Campos

25

Universidad de Cuenca
[20]. La tasa de codiﬁcación es otro de los factores que deﬁne el BR, sin embargo en la mayoría de los estudios no se da el valor utilizado, excepto en [22] en que el CR es de 4/6.
Como era de esperarse, el alcance depende de una variedad de parámetros, además del tipo de aplicación. El mayor alcance se logra en [42] con 20km, en [15] 15km, luego 7.482km en [22], 420m en [19]. Figura 3.1

Figura 3.1: Comparación de coberturas
Se debe tomar en cuenta que en la mayoría de los trabajos presentados, se realizaron pruebas con diferentes valores de BR, BW y SF, por lo que lo deﬁnido anteriormente pertenece a los alcances máximos logrados por cada estudio.
3.3. Capa MAC
Como ya se mencionó en el capítulo anterior, la capa MAC de LoRa, está deﬁnida por diferentes implementaciones. La más extendida es LoRaWAN. LoRaWAN fué desarrollado por LoRa Alliance [4] y entre sus características, deﬁne tres clases diferentes de dispositivos que aprovechan de la mejor manera las capacidades de LoRa. Este protocolo está orientado hacia el Internet de las Cosas (IoT) y divide a la red en cuatro partes. Dispositivos ﬁnales en donde se encuentran los sensores, Gateways que enrutan el tráﬁco, servidores de red y servidores de aplicación que procesan y responden a las peticiones respectivamente. [4]
En general, las diferentes implementaciones de la capa MAC sobre LoRa, se enfocan en lograr mayores alcances o implementar diferentes formas de arquitectura. En el caso de [36], se presenta

Pablo Avila Campos

26

Universidad de Cuenca
un análisis de desempeño y capacidad del transceptor Semtech SX1272. Para esto, se implementa el protocolo MAC LoRaBlink que permite la recolección de datos con multisalto. Se concluye que los radios LoRa pueden usar multisalto y, a pesar del aumento de complejidad, mantiene la eﬁciencia de uso energético.
Otro trabajo relacionado con la capa MAC es el realizado en [43]. Se presenta LoRa FABIAN como una pila de protocolos que puede ser usada sobre cualquier capa física. Está enfocada en la simpliﬁcación del acceso, utilizando protocolos comunes de internet como DNS y HTTP. Su principal ventaja sobre LoRaWAN es su interoperablidad con internet. Al igual que en anteriores trabajos, se mide el desempeño utilizando el PER, RSSI y SNR. Se concluye que la ubicación y elevación de la antena juegan un rol fundamental en el desempeño y que el RSSI por si solo, no es un buen medidor ya que las mediciones no muestran una fuerte correlación.
3.4. Análisis del Sistema
Al ser LoRa una tecnología relativamente nueva, algunos trabajos se han concentrado en evaluar sus características de manera más general.
En el caso de [14], se hace la medición del desempeño de un único nodo LoRa utilizando la tasa efectiva de uplink y tiempo de transmisión de datos. Para varios escenarios, se analiza el número máximo de nodos que pueden ser servidos por un GW. Se demuestra que la capacidad de uplink, depende de la distancia a la Estación Base (BS) y no excede de 2 kbps. En conclusión, los autores determinan que un solo BS LoRa puede servir teóricamente a millones de dispositivos, sin embargo, la mayoría de estos deben estar a una distancia media de la BS. LoRaWAN tiene gran cobertura, y escalabilidad con poco tráﬁco, sin embargo, tiene baja conﬁabilidad, retardos, y bajo desempeño en tráﬁco downlink. LoRa debe ser usado, por lo tanto, con dispositivos con poco tráﬁco que no requieran estricta latencia o conﬁabilidad por ejemplo, monitoreo ambiental no crítico.
Otro trabajo que hace un análisis general es el presentado en [17]. En este artículo, se provee un marco de modelado de desempeño de una red LoRa con un GW. Se incluyen peculiaridades de LoRa como la técnica de modulación, limitaciones de regulación y el uso de ALOHA. Se determina que la probabilidad de cobertura decae exponencialmente con el aumento de nodos debido a la interferencia de señales utilizando la misma secuencia de spreading. El análisis teórico matemático realizado en este trabajo fue veriﬁcado mediante simulaciones. Analizando los resultados de la simulación, se obtuvo que el aumento de nodos, produce interferencia que conlleva a un problema de desempeño y falta de escalabilidad.
Como se puede observar, existen resultados comunes entre los estudios que muestran a LoRa

Pablo Avila Campos

27

Universidad de Cuenca
como una tecnología útil para ciertas aplicaciones como redes de sensores que no requieran gran ﬁabilidad ni escalabilidad.
3.5. Conclusiones
Los trabajos realizados hasta el momento, demuestran que la tecnología LoRa no tiene un escenario de operación deﬁnido por lo que la investigación se ha centrado en probar diferentes enfoques con el objeto de deﬁnir el área de trabajo ideal.
La capa física LoRa ofrece ventajas relacionadas con el alcance, consumo energético y simplicidad. Estas ventajas se ven reﬂejadas en los diferentes trabajos realizados en los cuales se destacan las variables de medición de la calidad de enlace usadas: PER, RSSI y SNR. Otro aspecto a destacar en este punto es que no existe un consenso con respecto al número de paquetes a enviar y algunas de las características de la transmisión, no son presentadas, complicando la replicabilidad de algunos de los estudios. Quizás, el aspecto más importante a reﬂejar es el alcance logrado. El mayor alcance, se logra en [6] con 20km y sin obstáculos. Es importante recalcar en este punto que la mayoría de los trabajos utilizan 868 MHz y no 915MHz lo cual presenta una oportunidad para más investigaciones.
Los trabajos relacionados con la capa MAC, se enfocan en el desempeño general del sistema, buscando utilizar de la mejor manera las características de LoRa. En este documento se revisan tres principales enfoques de capa MAC: LoRaWAN, LoRaBlink y LoRa FABIAN. Cada una de estas capas MAC tiene diferentes enfoques. LoRaWAN pretende el uso de LoRa para Internet de las cosas con arquitectura de un salto. Por otro lado, LoRaBlink permite multisalto, manteniendo la eﬁciencia energética. Por último, LoRa FABIAN adapta de mejor manera LoRa a los protocolos de Internet para facilitar su uso.
Por último, existen estudios que evalúan LoRa desde un plano superior. Uno de los aspectos evaluados es la escalabilidad en la que se han realizado simulaciones y pruebas de campo en las que se concluye que la conﬁabilidad de LoRaWAN es baja y debe ser usado en aplicaciones no críticas. Por otro lado, se evalúa también el desempeño general de LoRa en el que la cobertura es un aspecto esencial que decae exponencialmente con el aumento de nodos.

Pablo Avila Campos

28

Universidad de Cuenca
Capítulo 4
Metodología
En este capítulo se trata la metodología de manera técnica, mostrando las características de los dispositivos utilizados, la disposición física de los mismos, los ambientes elegidos y la metodología utilizada para las mediciones y su posterior análisis.

Pablo Avila Campos

29

Universidad de Cuenca
4.1. Introducción
Uno de los pilares de la investigación es sin duda la replicabilidad. La replicabilidad se basa en que un estudio debe producir los mismos resultados si se repite exactamente. Para lograrlo, es importante que la metodología se encuentre clara para el lector, es por esto que en este capítulo se tratan aspectos técnicos de los dispositivos utilizados así como los parámetros utilizados para su conﬁguración.
Otro punto importante al hacer un estudio de campo es el describir el ambiente a profundidad para determinar todas las variables que podrían incidir en la toma de datos. Parte fundamental de la metodología es la descripción del procedimiento de medición, en el que se explica cómo se midieron las variables como el RSSI, SNR o PER. Por último, se explican los análisis estadísticos a realizarse en el siguiente capítulo y cuál es su inﬂuencia sobre el estudio.
4.2. Descripción de Equipos
En este punto, se describen los equipos utilizados durante las mediciones de RSSI, SNR y PER. Primero, se da una breve descripción del kit de Evaluación de LoRa en la sección 4.2.1, luego, en la sección 4.2.2, se habla sobre el Raspberry Pi, que controla al transmisor (mota o nodo), y ﬁnalmente, en la sección 4.2.3, se presenta la disposición de los equipos utilizados en las pruebas.
4.2.1. Kit de Evaluación de LoRa - 900
El kit de evaluación de LoRa provee varias herramientas para probar parámetros como el alcance y tasas de datos (DR) de LoRaWAN. El kit se compone de un Gateway y dos motas o nodos con el módulo RN2903. En la Figura 4.1 se observan los componentes mencionados. A continuación, se describen las principales características de los dispositivos:
Gateway LoRaWAN con tarjeta de RF El gateway LoRa es una placa demostrativa fabricada para el uso con módulos que utilicen los transceptores RN de Microchip a 915 MHz. Provee la comunicación con el servidor de aplicación de la red LoRa. Los paquetes Uplink son capturados y retransmitidos a través del protocolo TCP/IP de acuerdo a la especiﬁcación de LoRaWAN. Figura A.8. La tarjeta de radio captura todos los paquetes Uplink usando dos transceptores Semtech SX1257 y los envía al procesador de banda base SX1301 que a su vez los envía a la tarjeta Gateway vía Interfaz Periférica Serial (SPI). La tarjeta Gateway recibe la

Pablo Avila Campos

30

Universidad de Cuenca

Figura 4.1: Kit de Evaluación de LoRa - 900 [5]
información capturada por la tarjeta de red. Utilizando el PIC-24 con el dispositivo codiﬁcador (ENC624J600), el gateway convierte los paquetes en TCP/IP y los envía al puerto ethernet. Mota LoRa RN2903 La mota LoRa es una tarjeta demostrativa que facilita un primer acercamiento hacia la tecnología LoRa. Figura 4.3. Provee acceso al módulo LoRa a través de un puente USB a UART y soporta conexiones mediante puertos GPIO. El acceso USB es provisto mediante un PIC 18 que es parte de la placa y que permite el manejo del módulo LoRa con comandos ASCII. Se puede también modiﬁcar la información del PIC utilizando los conectores

Figura 4.2: Tarjeta RF y Gateway [6]

Pablo Avila Campos

31

Universidad de Cuenca

Figura 4.3: Mota LoRa [7]
disponibles en la tarjeta. Se soportan dos modos: USB y batería. Cuando la tarjeta está conectada a un computador mediante USB, opera en modo USB. Como se mencionó anteriormente el PIC18LF45K50 funciona como un puente USB-UART, de manera que se puedan enviar comandos directamente al módulo.
Cuando no está conectado mediante USB sino energizado por las baterías AAA, la tarjeta entra en modo batería. En este modo el PIC18LF45K50 puede ejecutar funciones personalizadas enviando comandos ASCII directamente al módulo.
4.2.2. Raspberry Pi 3 Modelo B
Raspberry Pi es una microcomputadora linux de bajo costo ($20-$35) del tamaño de una tarjeta de crédito. Fue desarrollada por la fundación Raspberry Pi, esta fundación está enfocada en promocionar de las ciencias computacionales y en hacer que el aprendizaje sea fácil [8]. Para este caso, fue utilizado para el envío de paquetes mediante el modo USB de la mota descrita en la sección anterior. Figura 4.4.
4.2.3. Disposición de Equipos
La disposición de los equipos se muestra en la Figura 4.5. El nodo o mota LoRa es controlado mediante la interfaz USB por el Raspberry Pi, el cual envía paquetes ASCII. En el lado del receptor, los paquetes son recibidos por el Gateway y reenviandos mediante TCP/IP hacia el servidor que captura los mismos y los guarda en su base de datos.

Pablo Avila Campos

32

Universidad de Cuenca

Figura 4.4: Raspberry Pi 3 modelo B [8]

Figura 4.5: Disposición Física de Dispositivos
4.3. Conﬁguración de Dispositivos
Al ser los dispositivos un kit de evaluación de LoRaWAN, algunas de las funciones como el envío de datos o el servidor, ya venían implementadas, sin embargo fue necesaria la conﬁguración y la modiﬁcación, en el caso del nodo para ajustar los parámetros de transmisión a la metodología escogida y descrita en la Sección 4.5. En el Apéndice A, se detalla la conﬁguración de los dispositivos descritos.
4.4. Descripción del Ambiente
El objetivo de la investigación es el de evaluar el rango de transmisión de LoRaWAN y sus características de propagación en ambientes forestales en las riveras de ríos, usando diferentes mediciones. Para estas mediciones, se tomó en cuenta el ambiente planteado en el proyecto de aplicación de tecnologías inalámbricas al sistema de predicción de caudales en la cuenca del río Tomebamba [12]. Dado que se requiere darle generalidad a la investigación, se escogieron tres ambientes en zonas: urbana, semiurbana y rural de la ciudad de Cuenca, Ecuador. En los cuales

Pablo Avila Campos

33

Universidad de Cuenca

Figura 4.6: Ambiente 1 - Río Tomebamba
se buscó que exista diferente densidad forestal así como diferente vegetación.
Por trabajos relacionados con mediciones de RSSI, se sabe que las mismas usualmente se realizan en tramos en los que existe una linea recta entre el transmisor y el receptor, por lo que se trató que los ambientes seleccionados pertenezcan a tramos rectos [24, 41].
En cuanto a los factores climáticos, las mediciones se tomaron en el día, en horas de la mañana y la tarde. La temperatura promedio es un parámetro difícil de estimar puesto que resulta sumamente variante en esta región del país, sin embargo, de manera general varía entre los 10 y 19 grados centígrados. No se registraron precipitaciones ni niebla durante las mediciones. A continuación, se describen con detalle cada uno de los ambientes analizados.
4.4.1. Ambiente 1: Urbano - Río Tomebamba
El río Tomebamba es uno de los principales aﬂuentes de la ciudad de Cuenca. Fue escogido como ambiente propicio ya que cruza a la ciudad de Cuenca cerca de su zona urbana. La Figura 4.6 muestra el tramo escogido. Este tramo, fue elegido porque no presenta mayor curvatura y por su cercanía a la Universidad de Cuenca.
Vegetación

Pablo Avila Campos

34

Universidad de Cuenca

Figura 4.7: Ambiente 1 - Esquema de Elevación
En cuanto a la vegetación, se observan variadas especies de árboles con alturas de entre 2 y 4 metros, plantadas con una distancia de entre 3 a 5 metros. Topografía La topografía es uno de los factores más importantes en la medición de propagación ya que inﬂuye directamente en la potencia recibida en el Gateway. En la Figura 4.7, se muestra el perﬁl de elevación. Otros Siguiendo los lineamientos de medición planteados en [12], los envíos se realizaron a una altura de 2 metros sobre el nivel del suelo y lo más próximos a la orilla que es dónde se concentra la mayor cantidad de vegetación. Se debe resaltar que en ciertos tramos de la medición, por obstáculos como puentes, el transmisor se encontraba a una altura mayor, lo que inﬂuye en los resultados que se mostrarán en el capítulo 5. Al ser éste un estudio exploratorio, se decidió medir en las dos orillas del río, que tiene un ancho variable de entre 10 y 18 metros, con el objetivo de deﬁnir la diferencia que puede existir entre las dos orillas de un mismo río. Por este motivo, en los siguientes capítulos se presentarán dos mediciones relacionadas con el ambiente 1.
4.4.2. Ambiente 2: Semiurbano - Rio Machángara
El segundo ambiente elegido es otro de los aﬂuentes de la ciudad de Cuenca. Este río nace al norte del parque nacional El Cajas. Se escogió este ambiente porque se encuentra al borde del perímetro urbano de la ciudad. No existen grandes construcciones cerca del mismo y presenta características de ambiente semiurbano. De manera más precisa, se escogió el tramo del sector de Patamarca, al frente de la ciudadela de los médicos. La Figura 4.8, muestra el tramo medido que tiene las siguientes características:
Vegetación En el caso del río Machángara, la densidad de vegetación presente, fue notablemente

Pablo Avila Campos

35

Universidad de Cuenca

Figura 4.8: Ambiente 2 - Río Machángara
menor. Se observaron principalmente dos clases de vegetación: arbustos de hasta tres metros de altura y gran cantidad de eucaliptos de hasta siete metros de altura, con espaciamientos de entre tres y siete metros entre ellos. Topografía La topografía del lugar escogido no presenta grandes pendientes, por lo que puede considerarse plana. Otros De igual manera que en el ambiente 1, se debe considerar, en el análisis de resultados que en algunos puntos, debido a la metodología de medición que será descrita en la Sección 4.5, algunos envíos resultan en zonas poco favorables en cuanto a la altura del transmisor o a la vegetación cercana.
4.4.3. Ambiente 3: Rural - Rio Yanuncay
Las WSN, como se revisó en el segundo capítulo, pueden ser desplegadas en variedad de ambientes. Es por esta razón que el tercer ambiente complementa los anteriores, presentando un escenario rural libre de ediﬁcaciones. De manera especíﬁca, las mediciones se realizaron en la población de Barabón. En la Figura 4.9 se presenta el tramo medido, que tiene las siguientes características:

Pablo Avila Campos

36

Universidad de Cuenca

Figura 4.9: Ambiente 3 - Río Yanuncay

Figura 4.10: Ambiente 3 - Esquema de Elevación

Vegetación En el caso de este río, se observó mayor densidad de vegetación así como una mayor variedad de especies de árboles y plantas. Existen árboles entre 1 y 7 metros de altura, plantados a menos de un metro de distancia entre los mismos.
Topografía
La zona elegida está cerca al parque nacional El Cajas, por lo que presenta una tendencia a la elevación del terreno que se observa claramente en la Figura 4.10. Otros Al no existir construcciones aledañas, se observa una mejora signiﬁcativa en términos de RSSI, SNR y número de paquetes recibidos, lo cual será analizado en el Capítulo 5.

Pablo Avila Campos

37

Universidad de Cuenca
4.5. Descripción del Procedimiento
El procedimiento de medición, consistió en el envío de paquetes desde un transmisor (mota) que variaba su distancia en intervalos ﬁjos. El receptor (Gateway), y el transmisor fueron colocados de manera ﬁja a una altura de 2 metros sobre el nivel del suelo, con el objetivo de que la señal pase a través de la vegetación. Tanto el transmisor como el receptor cuentan con antenas de 1.3 dBi de ganancia. En cada punto se enviaron 20 paquetes, de los cuales se recolectó RSSI, SNR y número de paquetes no recibidos.

4.5.1. Intervalos de Medición
Para la adquisición de datos, se utilizó el proceso de medición llamado de promediado espacial, propuesto por [44]. De acuerdo a este procedimiento, uno debe moverse una distancia de entre 20λ y 40λ en una frecuencia dada.

Como se dijo en el marco teórico, LoRaWAN hace saltos pseudoaleatorios de frecuencia, sin embargo, para el cálculo realizado en las ecuaciones (4.1), (4.2) y (4.3), se consideró la frecuencia de funcionamiento de los equipos de 915 MHz.

λ=

c f

=

3 ∗ 108 915 ∗ 106

= 0,327m

(4.1)

20 ∗ λ = 6,54m

(4.2)

40 ∗ λ = 13,08m

(4.3)

Dado que el valor debe estar en el intervalo entre (4.2) y (4.3), se eligió 10 m por operatividad.

4.5.2. Paquetes Enviados
Dado que los equipos descritos utilizan LoRaWAN, la conﬁguración de parámetros como el SF, BW, y CR se encuentran limitados, no sólo por la especiﬁcación de parámetros regionales de LoRaWAN [45], que se puede encontrar en la Tabla 2.3 sino por las características técnicas del kit de desarrollo utilizado. En la Tabla 4.1, se muestran los DR permitidos.

Pablo Avila Campos

38

Universidad de Cuenca

Tabla 4.1: Tasas de Datos Permitidas Data Rate Conﬁguración [SF/BW] Bit Rate [bit/sec]

0

SF10 / 125 kHz

1

SF9 / 125 kHz

2

SF8 / 125 kHz

3

SF7 / 125 kHz

980 1760 3125 5470

Figura 4.11: Captura de Paquetes
Dado que es un estudio inicial, se utilizaron las tasas de datos mínima y máxima DR0 y DR3 en cada punto de envío con 10 paquetes para cada DR. Para facilitar el cálculo de paquetes perdidos, cada mensaje es enviado con un número de envío en su carga útil.
4.5.3. Captura de Paquetes
Al ser este un trabajo de evaluación referente a parámetros físicos de la tecnología LoRaWAN, y por la facilidad de guardado de los paquetes recibidos, se optó por no utilizar el servidor LoRaWAN puesto que los valores de RSSI, SNR y carga útil se pueden obtener y almacenar de una manera más óptima haciendo una captura de los mismos, la conﬁguración se detalla en el Apéndice A.1.
Dado que el Gateway recibe los paquetes y los envía por el puerto Ethernet hacia el servidor, estos pueden ser fácilmente capturados con un software como Wireshark. En Wireshark, se realiza la captura de los 20 paquetes enviados y se los guarda para su posterior desencriptado.
En la Figura 4.11 se muestra la imagen de una de las capturas realizadas con Wireshark y guardadas en formato .txt:
Como se observa, los paquetes de DR0 y DR3, se encuentran mezclados y la carga útil, se encuentra encriptada, por lo que es necesario un proceso de selección, desencriptado y almacenamiento, descrito en la Sección 4.5.4.

Pablo Avila Campos

39

Universidad de Cuenca
4.5.4. Desencriptado y Almacenamiento
Para realizar la separación, desencriptado y almacenamiento de los paquetes, se hizo un script en Python que utiliza el decodiﬁcador de paquetes de LoRaWAN [46]. este decodiﬁcador, requiere de la instalación previa de Node.js y npm, que son plataformas de programación basadas en Javascript. El decodiﬁcador, también distingue los diferentes tipos de paquetes posibles, por lo que fue necesario modiﬁcarlo para realizar sólo la decodiﬁcación. El código ﬁnal, se encuentra en el Apéndice B. El código en Python realiza el siguiente procedimiento:
• Separa los diferentes paquetes en sus componentes (RSSI, SNR, frecuencia, modulación, tasa de codiﬁcación, canal y carga útil)
• Decodiﬁca las cargas útiles de cada uno de los paquetes • Separa los paquetes con DR0 de los de DR3 • Almacena cada captura en un archivo .csv • Crea un archivo resumen con las medias y desviaciones estándar de los RSSI y SNR.
4.6. Métricas de Análisis de Datos
A continuación, se desarrollan las herramientas que serán utilizadas para el análisis de las mediciones obtenidas en los tres ambientes anteriormente descritos.
4.6.1. Descripción de Datos con Medidas Numéricas
Las medidas numéricas carecen de la efectividad de las gráﬁcas, sin embargo ayudan a tener una idea de la tendencia de los datos sin la necesidad de observar la imagen de los mismos [47].
Medidas Centrales: Son medidas a lo largo del eje horizontal de una distribución que localizan el centro de la misma. La media, mediana y moda son utilizados para describir conjuntos de datos.
Medidas de Variabilidad: Dos conjuntos de datos pueden tener el mismo centro pero diferente dispersión o variación. Las medidas de variabilidad ayudan a crear una imagen de la distribución de los datos. Entre ellas se encuentra el rango, que es la diferencia entre la medición más grande y la más pequeña; la varianza de la población y de la muestra que se deﬁnen como los promedios de los cuadrados de las desviaciones alrededor de la media. La desviación estándar es igual a la raiz cuadrada positiva de la varianza. Una

Pablo Avila Campos

40

Universidad de Cuenca
característica de ésta es que su unidad de medida es la misma que la de las mediciones [47].

4.6.2. Estimación de Intervalos de Conﬁanza
Se trata de encontrar un intervalo en el que se esté seguro con cierta probabilidad de que sea un parámetro de interés. Esta probabilidad se llama coeﬁciente de conﬁanza. Usualmente se construyen intervalos de conﬁanza al 95 % [47].

Construcción del Intervalo de Conﬁanza

Cuando la distribución muestral de una variable, en el caso el RSSI, es aproximadamente normal, se puede aplicar la Ecuación 4.4 que se basa en el número de muestras y en la desviación estándar.

media ± 1,96 ∗

θ √

n

Siendo θ la desviación estándar y n el número de muestras. Intervalo de Conﬁanza en el Caso de cantidades de Muestras Pequeñas

(4.4)

Existen casos en el que es difícil o resulta costoso obtener un gran número de observaciones. En estos casos la Ecuación 4.4 puede no aplicarse, siendo necesaria una distribución alternativa como la t Student [48]. En este caso, el intervalo de conﬁanza se puede encontrar con la Ecuación 4.5.

media ± t ∗ √θ n

(4.5)

El valor de t se encuentra en la tabla de la distribución t Student, en donde se deben tomar en cuenta n − 1 grados de libertad, además del nivel de conﬁanza típico de 0.95. Dado que las muestras de este trabajo tienen un n = 10, se debe utilizar la distribución t-student para calcular los intervalos de conﬁanza.

4.6.3. Análisis de Correlación
El análisis de correlación, se basa en el coeﬁciente de correlación (r) que no es más que una medida de la fuerza de la relación entre dos variables. Este puede asumir valores entre -1 y +1. Un r = −1 indica una relación negativa perfecta entre las variables. En general, mientras mayor

Pablo Avila Campos

41

Universidad de Cuenca
sea el valor absoluto de r, más fuerte será la relación entre las variables [48].
Este análisis es usado en este trabajo para determinar la fuerza de la relación entre las mediciones 1 y 2 que se realizaron en dos orillas diferentes del mismo río (Ambiente 1).
4.6.4. Comparación de Poblaciones
El objetivo de esta prueba es el de comparar las mediciones de RSSI entre los tres ambientes estudiados. Para esto, se utiliza el test de Kruskal-Wallis que prueba la hipótesis con respecto a la distribución de tres o más poblaciones, utilizando las medianas. Esto se lo hace puesto que el RSSI no sigue una distribución normal. Se prueba la hipótesis nula de que los tres ambientes tienen la misma distribución [47].
Esto se realiza con el objetivo de saber si es necesario hacer un ajuste a los tres ambientes deﬁnidos. En el caso de que se cumpla la hipótesis alternativa de que al menos un ambiente es diferente, se procede a realizar el test de Dunn que reporta los resultados entre las combinaciones de los ambientes [47]. Estas pruebas, se realizarán utilizando el software libre de análisis estadístico R1.
4.7. Conclusiones
La evaluación de rango de transmisión requiere que se tomen en cuenta diferentes variables que, para este trabajo, se basan en el procedimiento y equipos que son descritos con detalle en este capítulo.
El kit de Evaluación de LoRa tiene la ventaja de que permite variar la mayoría de los parámetros de conﬁguración disponibles en LoRa, esto con el objetivo de realizar pruebas globales del sistema. La adición de sensores de temperatura y luz en la mota, permiten probar la ﬁabilidad en la transmisión de la información. La adición de una interfaz gráﬁca en conjunto con un servidor pre conﬁgurado, ayudan a que la experiencia del usuario ante esta nueva tecnología sea la mejor.
Los ambientes escogidos para la toma de muestras de RSSI, SNR y PER obedecen a la necesidad del despliegue de sensores en las orillas de ríos en la ciudad de Cuenca que ayuden al monitoreo en tiempo real del caudal de los mismos. Para ganar generalidad se escogieron tres ambientes: urbano, semiurbano y rural cuyos datos y resultados, son explicados en capítulos posteriores.
1https://www.r-project.org/

Pablo Avila Campos

42

Universidad de Cuenca
Las pruebas estadísticas como el análisis de correlación y los test de comparación de distribuciones, ayudarán a validar las mediciones realizadas, interpretar y a mostrar los resultados de la mejor manera.
Por otro lado, como se explicó en la introducción, se ha considerado como importante el describir con exactitud el procedimiento de medición para que el mismo pueda ser validado y de ser necesario, replicado.

Pablo Avila Campos

43

Universidad de Cuenca
Capítulo 5
Resultados: Análisis de Mediciones y Ajuste del Modelo Empírico basado en RSSI y SNR
En este capítulo se cumple el último objetivo planteado en este trabajo, que es el de ajustar un modelo de pérdidas de trayectoria para el uso de LoRa en margenes de ríos con ambientes forestales. Antes del ajuste, se realizan pruebas estadísticas de validación que demuestran que la correlación entre las dos orillas de un río es alta y que no existe relación de distribuciones entre los ambientes urbano y semiurbano. Se comparan los diferentes ambientes y se muestra cómo la desviación estándar disminuye en el ambiente rural debido a que existen menos obstáculos. Finalmente, se muestran las pérdidas de paquetes en las mediciones como medida de calidad de la transmisión.

Pablo Avila Campos

44

Universidad de Cuenca
5.1. Introducción
Como se planteó en el capítulo anterior, con los valores de RSSI y SNR, se puede generar un modelo de pérdidas de trayectoria que sea ﬁable y que pueda ser ajustable a una ecuación logarítmica que sirva para hacer estimaciones de cobertura y simulaciones con redes de sensores que usen tecnología LoRaWAN. Antes de generar los modelos, se puede realizar un análisis estadístico de correlación que conﬁrme la hipótesis de que no existe gran diferencia en la propagación de las dos orillas de un mismo río. Esto se lo realizó únicamente con el ambiente 1 (Río Tomebamba).
Los modelamientos se los realizó con la función ﬁt de Matlab. En estos se conﬁrma que los ambientes rurales presentan menos obstáculos por lo que se observa un mayor alcance. Por otro lado, se calcula la desviación estándar que está ligada al llamado desvanecimiento por sombra, provocado por obstáculos.
Para ﬁnalizar, como se propuso en el primer capítulo, se utiliza la tasa de pérdida de paquetes para saber cuando la transmisión ya no es ﬁable y por lo tanto las mediciones deben detenerse. Dependiendo de la aplicación, el porcentaje de paquetes perdidos aceptable varía, sin embargo, para este procedimiento, y teniendo en cuenta que la frecuencia de transmisión máxima típica de redes LoRaWAN es de cinco minutos, se ﬁjó un límite del 60 % de paquetes perdidos para detener la medición.
5.2. Mediciones Previas
En este punto se describen algunas de las mediciones que sirvieron para determinar la inﬂuencia del salto de frecuencia de LoRaWAN, el número óptimo de paquetes a enviar y el índice de potencia a seleccionar.
5.2.1. Salto de Frecuencia
Como se explicó en la Sección 2.5, referente a las reglas que utilizan los dispositivos con LoRaWAN, los dispositivos ﬁnales o nodos transmiten en diferentes canales de manera pseudoaleatoria. Como se observa en la Figura 5.1, al transmitir 100 paquetes en un ambiente de prueba, la frecuencia varía desde 902.3 MHz hasta 903.5 MHz, en intervalos de 200 kHz. El objetivo de este estudio previo fue el de deﬁnir si el canal atenúa el RSSI de manera selectiva en determinadas frecuencias.

Pablo Avila Campos

45

Universidad de Cuenca

Figura 5.1: Valores de RSSI obtenidos para las diferentes frecuencias
De la Figura 5.1, se puede concluir que no existe un canal selectivo por lo que el salto de frecuencia propuesto por LoRaWAN, es válido.
5.2.2. Cantidad de Paquetes
Para determinar el número de paquetes necesarios en cada punto de transmisión, primero se revisó en los diferentes trabajos que fueron parte del estado del arte, presentado en el capítulo 3. En estos se enviaban diferentes cantidades de paquetes y no se da una explicación a esto. Por este motivo se realizó una prueba en la que se fueron enviando diferentes cantidades de paquetes y se calculó la desviación estándar de cada grupo. En la Tabla 5.1, se observan los resultados. Se observa que de manera general, la desviación estándar disminuye 1 dBm. Aunque existe esta disminución, la misma no es signiﬁcativa, por lo que, como se explicó en la sección 4.5.2, en cada transmisión se envían 10 paquetes.
5.2.3. Índice de Potencia
El índice de potencia deﬁne la potencia con la que el nodo o mota transmite el paquete. El módulo de Microchip RN2903, admite los índices 5, 7, 8, 9, 10 [49]. Se sabe que la potencia

Pablo Avila Campos

46

Universidad de Cuenca

Tabla 5.1: Resultados de Desviación Estándar con diferentes número de paquetes

Prueba Nro. Nro. Paquetes Desviación Estándar (dBm)

1

10

1.94

2

20

1.16

3

30

1.76

4

40

1.63

5

50

2.06

6

60

1.57

7

70

1.18

8

80

1.10

9

90

1.25

10

100

1.05

máxima de transmisión pertenece al índice 5, sin embargo, se realizó una prueba en un ambiente controlado, variando este índice. Los resultados, se observan en la Tabla 5.2.

Tabla 5.2: Variación de Índices de Potencia Índice RSSI promedio (dBm)

5

-23.7

7

-27.9

8

-29.8

9

-30.2

10

-32.3

Como se observa en la Tabla 5.2, el índice 5, provee el mayor RSSI por lo que fue seleccionado para usarse en las mediciones mostradas en la Sección 5.3. Se debe acotar que no se encontró una referencia a la potencia de transmisión de los otros índices. Esta información, fue solicitada a Microchip, sin obtener respuesta.

5.3. Mediciones de RSSI y SNR
Para estas gráﬁcas se tomó en cuenta una distribución t student en cada punto debido al reducido número de muestras (10). En cada gráﬁca, se muestra la media y el intervalo de conﬁanza al 95 %. En las Figuras 5.2 y 5.3, se observan el RSSI y SNR correspondientes a la primera medición. Los demás resultados de las mediciones de RSSI y SNR, se muestran en las gráﬁcas del Apéndice C.

Pablo Avila Campos

47

Universidad de Cuenca Figura 5.2: Medición de RSSI en Ambiente 1 con DR0

Figura 5.3: Medición de SNR en Ambiente 1 con DR0

Pablo Avila Campos

48

Universidad de Cuenca
5.4. Análisis Estadísticos
A continuación, se presentan los análisis estadísticos que ayudarán a validar las mediciones y a comprobar las hipótesis planteadas en este trabajo.
5.4.1. Correlación
Como se mencionó en el capítulo anterior, la correlación muestra la fuerza de la relación entre dos variables. En este caso, se quiere mostrar que la relación entre los RSSI de las dos orillas del Ambiente 1 - Rio Tomebamba, es fuerte. Esto indicaría que el cambio de orilla y ligera variación de topografía y vegetación, no afecta en gran medida a los valores de RSSI. Las características del ambiente probado se detallan en la Sección 4.4.1.
Análisis de Correlación con DR0
El análisis de correlación muestra una fuerte relación entre las dos orillas presentando un valor de 0.92. En la Figura 5.4, se presentan los dos RSSI con DR0 del Ambiente 1. Como se puede observar, se presenta una clara tendencia de linealidad que conﬁrma el alto valor de correlación. Análisis de Correlación con DR3
De igual manera que en el punto anterior, el valor de correlación muestra una alta relación entre los valores de RSSI de ambas orillas del río Tomebamba. El valor obtenido es de 0.92. De igual manera, la gráﬁca conﬁrma una fuerte relación entre ambas variables. Figura 5.5.
5.4.2. Comparación de Ambientes
Como se explicó en la sección 4.6.4, se realizará una prueba de comparación de las distribuciones en los tres ambientes de medición (urbano, semiurbano y rural). Esto con el objetivo de probar que se requiere un ajuste para cada entorno. Como se observa en la sección 5.3, las mediciones realizadas tanto de RSSI como de SNR, con DR0 y DR3 son muy parecidas por lo que estas pruebas estadísticas se realizarán solamente con los valores de RSSI con DR0 de las Mediciones 1, 3 y 4.
Test de Kruskal-Wallis Al realizar el Test de Kruskal-Wallis en R, se obtuvo un valor p de 0.01. Al ser menor a 0.05, indica una fuerte evidencia en contra de la hipótesis nula, así

Pablo Avila Campos

49

Universidad de Cuenca Figura 5.4: Análisis de Correlación de RSSI con DR0 - Ambiente 1

Figura 5.5: Análisis de Correlación de RSSI con DR3 - Ambiente 1

Pablo Avila Campos

50

Universidad de Cuenca
que se puede rechazar la misma. Por lo tanto, las distribuciones de los tres ambientes, no son iguales. Para determinar que ambientes son estadísticamente iguales y cuales no, se utiliza el Test de Dunn. Test de Dunn Una vez realizado el Test de Dunn, en la Tabla 5.3 se pueden observar los resultados de la comparación:

Tabla 5.3: Valores P del Test de Dunn

Valor P

Rural SemiUrbano

SemiUrbano 0.0010

Urbano

0.3788

0.01

Se puede observar que la única combinación que no rechaza la hipótesis nula es la de Urbano con Rural. Se puede decir entonces que las distribuciones de las demás combinaciones no están relacionadas. Test de Mann-Whitney-Wilcoxon Ya que al parecer no existe una diferencia signiﬁcativa en las mediciones urbana y rural, se decidió hacer el test de Mann-Whitney-Wilcoxon que prueba la independencia de dos poblaciones sin la necesidad de asumir que las mismas tienen distribuciones normales [47, 48]. El valor p obtenido fue de 0.9721 por lo que nuevamente se concluye que no existe suﬁciente evidencia para concluir que los ambientes urbano y rural sean diferentes. Estos test estadísticos no son usuales en el área de telecomunicaciones, por lo que se recomienda una futura veriﬁcación y validación de los resultados obtenidos.

5.5. Modelamiento en Base a Pérdidas de Trayectoria

Como se explicó en la sección 2.6, la ecuación que se utiliza para el modelamiento es una logarítmica. (Ecuación 5.1).

PL(dB) = a + b ∗ log(d) + Xθ

(5.1)

Para realizar el ajuste se debe calcular las pérdidas de trayectoria (P L) utilizando la Ecuación 2.6, con los parámetros ﬁjos presentados en la Tabla 5.4.

Pablo Avila Campos

51

Universidad de Cuenca

Figura 5.6: Ajuste de P L del Ambiente 1 con DR0 - Río Tomebamba

Tabla 5.4: Valores utilizados para el cálculo de las pérdidas de trayectoria Constante Valor

Ptx

18.5 dBm

Grx

1.3 dBi

5.5.1. Medición 1 - Ambiente Urbano

Pérdidas de Trayectoria con DR0 En la Figura 5.6 se observa el ajuste logarítmico realizado a las P L de la medición 1 con DR0, correspondiente al ambiente urbano descrito en la sección 4.4.1. El resultado del mismo, se presenta en la Ecuación 5.2.

PL(dB) = 59,53 + 11,26 ∗ log(d) + Xθ(θ = 6,29)

(5.2)

Pérdidas de Trayectoria con DR3

En la Figura 5.7 se observa el ajuste logarítmico realizado a las P L de la medición 1 con DR3, correspondiente al ambiente urbano, descrito en la sección 4.4.1. El resultado del mismo, se presenta en la Ecuación 5.3.

PL(dB) = 53,38 + 12,98 ∗ log(d) + Xθ(θ = 5,12)

(5.3)

Pablo Avila Campos

52

Universidad de Cuenca

Figura 5.7: Ajuste de P L del Ambiente 1 con DR3 - Río Tomebamba

5.5.2. Medición 2 - Ambiente Urbano - Orilla 2
Pérdidas de Trayectoria con DR0

En la Figura 5.8 se observa el ajuste logarítmico al P L de la medición 2 con DR0, correspondiente a la orilla 2 del ambiente urbano descrito en la sección 4.4.1. El resultado del mismo, se presenta en la Ecuación 5.4.

PL(dB) = 44,96 + 13,39 ∗ log(d) + Xθ(θ = 5,83) Pérdidas de Trayectoria con DR3

(5.4)

En la Figura 5.9 se observa el ajuste logarítmico realizado a las P L de la medición 2 con la tasa de datos máxima, correspondiente a la orilla 2 del ambiente urbano descrito en la sección 4.4.1. El resultado del mismo, se presenta en la Ecuación 5.5.

PL(dB) = 26,24 + 17,49 ∗ log(d) + Xθ(θ = 3,72)

(5.5)

5.5.3. Medición 3 - Ambiente Semiurbano
Pérdidas de Trayectoria con DR0 En la Figura 5.10 se observa el ajuste logarítmico realizado a las P L de la medición 3 con

Pablo Avila Campos

53

Universidad de Cuenca Figura 5.8: Ajuste de P L del Ambiente 1 con DR0, orilla 2 - Río Tomebamba

Figura 5.9: Ajuste de P L del Ambiente 1 con DR3, orilla 2 - Río Tomebamba

Pablo Avila Campos

54

Universidad de Cuenca

Figura 5.10: Ajuste de P L del Ambiente 2 con DR0 - Río Machángara

DR0, correspondiente al ambiente semiurbano descrito en la sección 4.4.2. El resultado del mismo, se presenta en la Ecuación 5.6.

PL(dB) = 61,55 + 10,7 ∗ log(d) + Xθ(θ = 2,92) Pérdidas de Trayectoria con DR3

(5.6)

En la Figura 5.11 se observa el ajuste logarítmico realizado a las P L de la medición 3 con DR3, correspondiente al Ambiente semiurbano descrito en la sección 4.4.2. El resultado del mismo, se presenta en la Ecuación 5.7.

PL(dB) = 62,74 + 10,67 ∗ log(d) + Xθ(θ = 3,20)

(5.7)

5.5.4. Medición 4 - Ambiente Rural
Pérdidas de Trayectoria con DR0

En la Figura 5.12 se observa el ajuste logarítmico realizado a las P L de la medición 4 con DR0, correspondiente al Ambiente rural descrito en la sección 4.4.3. El resultado del mismo, se presenta en la Ecuación 5.8.

PL(dB) = 55,36 + 11,27 ∗ log(d) + Xθ(θ = 3,73)

(5.8)

Pablo Avila Campos

55

Universidad de Cuenca Figura 5.11: Ajuste de P L del Ambiente 2 con DR3 - Río Machángara

Figura 5.12: Ajuste de P L del Ambiente 3 con DR0 - Río Yanuncay

Pablo Avila Campos

56

Universidad de Cuenca

Figura 5.13: Ajuste de P L del Ambiente 3 con DR3 - Río Yanuncay

Pérdidas de Trayectoria con DR3

En la Figura 5.13 se observa el ajuste logarítmico realizado a las P L de la medición 4 con DR3, correspondiente al Ambiente rural descrito en la sección 4.4.3. El resultado del mismo, se presenta en la Ecuación 5.9.

PL(dB) = 61,13 + 10,55 ∗ log(d) + Xθ(θ = 3,88)

(5.9)

5.5.5. Comparación de Modelos
Una vez obtenidos los ajustes logarítmicos, se puede hacer una comparación para determinar cual de los ambientes provee el mejor alcance al desplegar una red utilizando tecnología LoRa.
Comparación de Ambientes con DR0 A continuación, la Figura 5.14, muestra los ajustes de P L con DR0 en las cuatro mediciones. En la Tabla 5.5, se observa un resumen de los resultados.

Pablo Avila Campos

57

Universidad de Cuenca

Figura 5.14: Ajustes de P L con DR0 - Todos los Ambientes

Tabla 5.5: Compraración de Características de Propagación con DR0

Parámetro

Medición 1 Medición 2 Medición 3 Medición 4

Distancia Máxima (m)

800

950

1170

1600

Desviación Estándar (dB)

6.29

5.83

2.92

3.73

Se puede observar que la Medición 4, perteneciente al Ambiente Rural, presenta el mejor alcance de las cuatro. En el caso de la Medición 1, perteneciente al Ambiente Urbano, decrece rápidamente hasta llegar alrededor de 800 metros en donde ya no existe conexión ﬁable. La Medición 3, como era esperado, presenta un resultado intermedio. En cuanto a las desviaciones estándar, se sabe que se encuentran relacionadas directamente con el entorno. En los ambientes urbanos se presenta mayor cantidad de obstáculos por lo que las mediciones son variantes y la curva no se ajusta de la mejor manera al contrario que en los ambientes semiurbano y rural. Comparación de Ambientes con DR3
A continuación, la Figura 5.15 muestra los ajustes P L con DR3 en las cuatro mediciones. En la Tabla 5.6, se observa un resumen de los alcances y desviaciones estándar.

Pablo Avila Campos

58

Universidad de Cuenca

Figura 5.15: Ajustes de P L con DR3 - Todos los Ambientes

Tabla 5.6: Comparación de Características de Propagación con DR3

Parámetro

Medición 1 Medición 2 Medición 3 Medición 4

Distancia Máxima (m)

640

600

1100

1500

Desviación Estándar (dB)

5.12

5.72

3.20

3.88

De igual manera que en la Figura 5.14, la Figura 5.15 muestra que el ambiente Rural tiene el mayor alcance. Algo que se puede resaltar es que las mediciones 3 y 4 presentan curvas muy parecidas hasta alrededor de los 1200 metros. En cuanto a las mediciones 1 y 2 decaen de manera rápida y su diferencia se debe principalmente al entorno en el que se hicieron las mediciones.

5.6. Tasa de Errores de Paquetes
Como se explicó en el capítulo introductorio, se envían 10 paquetes con cada tasa de datos. En el receptor, se registran cuantos de estos paquetes llegaron con éxito. Esto se lo realiza como una medición del desempeño general de las transmisiones y que además da una pauta para detener las mismas.
A continuación se muestran las tasas de errores de paquetes, que fueron calculadas con Ecuación 5.10 [50].

Pablo Avila Campos

59

Universidad de Cuenca

Figura 5.16: Tendencia de Promedios de Pérdidas de Paquetes con DR0 - Medición 1

Error =

10 − paquetesrecibidos 10

(5.10)

En las Figura 5.16, se observa la tendencia de pérdidas de paquetes en la primera medición con la menor tasa de datos. Se observa una tendencia a crecer de manera rápida al acercarse el alcance máximo.

Promedios de Pérdidas de Paquetes enviados con DR0 En la Figura 5.17, se formaron intervalos de 100 metros y se calculó el promedio de paquetes perdidos para las cuatro mediciones realizadas. Se puede observar en las diferentes mediciones que al alcanzar sus límites de cobertura, presentados e las tablas 5.5 y 5.6, la pérdida aumenta rápidamente.
Promedios de Pérdidas de Paquetes enviados con DR3 De igual manera que en la Figura 5.17, la Figura 5.18 presenta la tendencia de aumento de pérdidas de paquetes conforme la distancia aumenta, para el caso de una transmisión con mayor tasa de bits.

Pablo Avila Campos

60

Universidad de Cuenca Figura 5.17: Promedios de Pérdidas de Paquetes con DR0 - Todos los Ambientes

Figura 5.18: Promedios de Pérdidas de Paquetes con DR3 - Todos los Ambientes

Pablo Avila Campos

61

Universidad de Cuenca
5.7. Conclusiones
El ajuste de un modelo de pérdidas de trayectoria para LoRa con LoRaWAN en un ambiente especíﬁco, como es el forestal, permite caracterizar la propagación en el mismo.
Las pruebas previas que se realizaron con el kit de evaluación permitieron deﬁnir aspectos como, que la desviación estándar del número de paquetes no resulta signiﬁcativa si el mismo se aumenta. En base a estas pruebas, se deﬁnió el índice de potencia a utilizar en las mediciones además de comprobar que no existe selectividad de canal en las frecuencias utilizadas por LoRaWAN.
Con respecto a la propagación en ambas orillas de un mismo río, se comprobó que la correlación que se presenta, aún en un ambiente difícil como el urbano, es alta. Los test de Kruskal-Wallis y Dunn realizados para comparar las distribuciones de los ambientes muestreados concluyen que no existe relación estadística entre los ambientes Rural y Semiurbano, reforzando la necesidad de caracterizar a los mismos de manera separada. No se pudo veriﬁcar la independencia entre los ambientes urbano y rural, esto se puede deber a una posible relación entre la alta densidad de vegetación y las ediﬁcaciones. Estos test estadísticos no son usualmente aplicados con este tipos de datos por lo que los resultados deben ser veriﬁcados y validados en un estudio futuro.
Utilizando los valores de RSSI y SNR, se calcularon las pérdidas de trayectoria y se ajustaron para las cuatro mediciones con las tasas de datos utilizadas. Si se comparan las mediciones con diferente DR, se observa que presentan valores muy similares de RSSI y SNR, con la diferencia de que DR0 presenta un mayor alcance. Se recomienda en lo posible utilizar DR3, ya que al tener menor tiempo aire, se tiene un menor consumo energético.
Los ajustes muestran diferentes valores de desviación estándar que pueden ser revisados en las tablas comparativas 5.5 y 5.6. Se observa una clara tendencia a disminuir en ambientes rurales o semiurbanos. Esto se debe a que la desviación estándar de las muestras son mayores en la medición 1 y 2 por la gran cantidad de obstáculos que existen en la urbe.
Por último, se concluye que la tasa de pérdida de paquetes es un buen parámetro para deﬁnir el desempeño de la trasmisión en determinado punto, sin embargo se debe notar de las Figuras 5.17 y 5.18 que las pérdidas tienden a variar rápidamente.

Pablo Avila Campos

62

Universidad de Cuenca
Capítulo 6
Conclusiones y Recomendaciones
En este capítulo se presentan las conclusiones ﬁnales del trabajo realizado así como la interpretación de los resultados, las limitaciones que se encontraron en el proceso, y ﬁnalmente, se proponen maneras de ampliar la investigación a futuro.

Pablo Avila Campos

63

Universidad de Cuenca
6.1. Conclusiones
En este estudio se ha demostrado que el ambiente en donde se desarrolla la red LoRaWAN, así como la topografía, inﬂuyen en el alcance y en el porcentaje de paquetes recibidos correctamente.
Las mediciones previas realizadas, ayudaron a deﬁnir aspectos de la transmisión como el índice de potencia que da los mejores valores de RSSI, sin embargo, se debe tomar en cuenta que al haberse utilizado el mismo, la vida útil de los dispositivos puede verse reducida. Otro aspecto fue desviación estándar de RSSI que no varía de manera signiﬁcativa al aumentar la cantidad de mensajes a enviar. Por último, se observó, con respecto a la frecuencia de transmisión, que el canal no es selectivo, por lo que LoRaWAN, puede ser utilizado en los ambientes seleccionados.
En cuanto a las mediciones de RSSI, se observa una clara tendencia a decaer con la distancia de manera logarítmica, lo que conﬁrmaría la hipótesis planteada en el marco teórico. Los resultados obtenidos indican que el ajuste de un modelo de pérdidas de trayectoria tiene menor desviación estándar, en ambientes semiurbanos o rurales. Esto se traduce en una mayor ﬁabilidad del modelo en los mismos.
De los cálculos de correlación, realizados en un ambiente urbano, detallado en la Sección 4.4.1, se concluye que existe una fuerte relación entre las dos orillas de un río. De las pruebas estadísticas, se concluye que no se puede caracterizar con sólo una ecuación los diferentes ambientes. Se observa también que en la mayoría de las mediciones, el ruido no es un factor importante en el decaimiento de la señal, en los primeros 300 metros. Esto indicaría que si se desarrolla una red con este o menor alcance, el nivel de ruido es despreciable.
6.2. Recomendaciones
Existen diferentes variables que pueden ser mejoradas en estudios posteriores y que no fueron tomadas en cuenta en este por ser un primer estudio exploratorio de LoRaWAN. A continuación se presentan las principales:
• Una de las aspiraciones de esta tecnología es el gran alcance que provee, sin embargo, al haber utilizado en este estudio una metodología que se enfocaba hacia la caracterización de la señal a través de diferentes ambientes forestales, no se obtuvieron alcances mayores a 1600 metros.
• En algunos de los puntos que se tomaron, por problemas del terreno, no se pudo cumplir con la metodología propuesta, lo que causó que existan mejoramiento o disminución repentina de RSSI, visible en las gráﬁcas del Anexo A.

Pablo Avila Campos

64

Universidad de Cuenca
• Al tomarse puntos en un intervalo relativamente pequeño de diez metros, se compensó de alguna manera el limitado número de mensajes enviados (diez), sin embargo, este se podría ampliar al doble para disminuir la desviación estándar y mejorar la ﬁabilidad de las muestras.
• La cantidad de mensajes recibidos correctamente no es una medida ﬁable de la cobertura ya que tiende a variar rápidamente con las condiciones del entorno.
• Los equipos presentan tasas de datos deﬁnidas por LoRaWAN, sin embargo, no están implementados todos, por lo que en este estudio sólo se pudieron probar dos, que de manera básica, varían el SF.
6.3. Trabajos Futuros
En esta sección, se explica cómo se podrían aplicar los resultados obtenidos y cómo estos pueden ser mejorados o ampliados con futuras investigaciones.
• Como se mencionó en las conclusiones, la topografía es un parámetro importante. Uno de los aspectos en que se puede trabajar a futuro es la variación de la altura de la antena receptora. Esto ayudaría a determinar con que altura se consiguen los mejores resultados.
• Las potencia de transmisión es un factor clave al analizar la cobertura. En este estudio solo se utilizó la mayor, sin embargo se propone en un estudio futuro probar al menos tres potencias ya que el uso continuo de la máxima puede afectar a la vida útil de los dispositivos.
• Aunque ya existen trabajos en los que se varían los parámetros de LoRa, estos aún no se realizan sobre ambientes forestales. Un futuro estudio podría no utilizar LoRaWAN y probar si se dan mejoras al hacerlo.
• La escalabilidad de una red LoRaWAN, aunque requeriría cierta cantidad de nodos, es un parámetro que no ha sido medido bajo condiciones forestales y que presenta una alternativa de estudio interesante que podría ser enfocada desde un punto de vista de red.
• Otra de las ventajas de LoRa es el bajo consumo energético. Se puede realizar un estudio futuro de consumo utilizando los DR planteados por LoRaWAN para determinar las diferencias de consumo energético.
• Aunque los parámetros de red dependen de los equipos y las capacidades de la misma, se puede realizar un estudio de retardos y variaciones de retardos de mensajes desde que son enviados por el nodo hasta que son recibidos por el servidor.

Pablo Avila Campos

65

Universidad de Cuenca
Anexos

Pablo Avila Campos

66

Universidad de Cuenca
Apéndice A
Conﬁguración de Dispositivos
A.1. Instalación y conﬁguración del servidor y Gateway LoRaWAN

En este punto se detalla la conﬁguración sugerida por Microchip para un primer acercamiento al kit de desarrollo de LoRaWAN. Para este procedimiento, se utilizó la Guía de Usuario de la Tecnología LoRa [9]. Un sistema LoRa puede ser implementado de muchas maneras, sin embargo, el kit de Evaluación utilizado puede ser conﬁgurado como se observa en la Figura A.1.

Pablo Avila Campos

68

Universidad de Cuenca

Figura A.1: Esquema de conﬁguración del kit LoRa [9]
A.1.1. Instalación
La suite de desarrollo de tecnología LoRa tiene todos los componentes necesarios para conﬁgurar el sistema LoRa. Incluye la utilidad de desarrollo, la cual ha sido desarrollada para ayudar al usuario a evaluar, desarrollar e implementar LoRa con el kit de evaluación. El objetivo de esta suite es la de proveer un único paquete que haga que la introducción del usuario a una red LoRaWAN fácil. El contenido de la suite de desarrollo es el siguiente:
• La utilidad de Desarrollo

Pablo Avila Campos

69

Universidad de Cuenca
• Servidor Docker y la base de datos de evaluación • Java Runtime Environment
Para iniciar la instalación, los paquetes necesarios deben ser descargados de la siguiente página web:
http://www.microchip.com/DevelopmentTools/ProductDetails.aspx?PartNO=dv164140-2 Una vez descargada la suite de desarrollo de LoRa, se procede a instalar. Por defecto el directorio de instalación es Microchip/LoRaSuite. Figura A.2.

Figura A.2: Instalación de la suite de desarrollo de LoRa
Se deben elegir todos los componentes y de esta manera se completa la instalación. Uno de los componentes elegidos es Java Runtime, este se instalará durante la instalación de los demás componentes.
A.1.2. Preparación del Sistema
Para preparar al sistema se deben hacer los siguientes pasos:

Pablo Avila Campos

70

Universidad de Cuenca
Abrir VirtualBox
VirtualBox corre Docker Engine, en el cual se encuentra almacenado el servidor LoRaWAN y la base de datos. En Windows y MAC OS, Docker corre de manera virtual usando VirtualBox y de manera nativa en sistemas Linux de 64 bits. Para Windows y MAC también es necesario conﬁgurar el reenvío de puertos que se realizará en la siguiente sección. Figura A.3.

Figura A.3: Virtualización de Docker en Windows

Agregar Reglas de Reenvío de Puertos en VirualBox
En VirtualBox se busca la opción de conﬁguración, luego red, y clic en avanzado. En Reenvío de Puertos, se agregan las reglas de la Figura A.4.

Pablo Avila Campos

71

Universidad de Cuenca Figura A.4: Reglas de Reenvío de Puertos

Asignación de IP estática
Este paso conﬁgura al puerto Ethernet del computador con una IP ﬁja de tal manera que coincida con la dirección del servidor que tiene conﬁgurada el Gateway. La conﬁguración se la realiza en el adaptador Ethernet y en IPv4. Quedaría como en la Figura A.5.

Pablo Avila Campos

72

Universidad de Cuenca

Figura A.5: Conﬁguración de IP estática en adaptador de red Ethernet

A.1.3. Conﬁguración del Servidor
Como se dijo anteriormente, el servidor se encuentra virtualizado y es manejado a través de VirtualBox, sin embargo, primero es necesario instalarlo. Una vez instalado, para correr el servidor, no es necesario abrir VirtualBox. Solo abrir el terminal de Docker y correr el Servidor LoRaWAN.

Abrir el Terminal Docker El Terminal Docker sirve para enviar comandos a Docker que a su vez corre el Servidor y Base de datos de evaluación. Para correrlo, se da doble click sobre su icono que se encuentra en la carpeta Docker. Se abrirá una ventana como se observa en la Figura A.6.

Pablo Avila Campos

73

Universidad de Cuenca

Figura A.6: Terminal Docker
Cargar la Imagen Docker
Para cargar la imagen de Docker, se utiliza el siguiente comando: docker load < /C/microchip/LoRaSuite/Docker/mchplora Crear el contenedor Docker
En este punto, se va a crear un contenedor con el nombre loraserver, utilizando la imagen recién cargada. El comando es el siguiente: docker create --name lora_server –p 1700:1700/UDP –p 3306:3306/TCP -p 5000:5000/UDP mchplo Este contenedor asigna el puerto 1700 para tráﬁco UDP y 3306 para TCP. Iniciar el Contenedor
Con este comando, el contenedor Docker correrá. docker start lora_server

Pablo Avila Campos

74

Universidad de Cuenca Una vez que el contenedor ha sido creado, el servidor puede iniciar con este comando y continuará activo aún si VirtualBox o el Terminal Docker están cerrados.
A.1.4. Conﬁguración de Red
Conectar los dispositivos LoRa Con el contenedor de LoRa creado e iniciado, conectar las tarjetas de evaluación de LoRa a los puertos USB del computador. A continuación, abrir el software de Utilidad de Desarrollo. La interfaz se presenta en la Figura A.7.

Figura A.7: Software de Utilidades de LoRa Microchip
Conﬁguración del Gateway El Gateway ya viene conﬁgurado de fábrica sin embargo se deben conﬁrmar los parámetros del mismo. En la Figura A.8, se muestra como deben estar conﬁgurados.

Pablo Avila Campos

75

Universidad de Cuenca

Figura A.8: Software de Utilidades de LoRa Microchip - Gateway

En este punto, si se siguieron los pasos anteriores, al igual que en la imagen anterior, se debería observar un indicador verde y el enunciado online en la esquina de conﬁguración del Gateway y en el panel LCD del mismo. Hay veces en que el Gateway tarda unos segundos en pasar a online. Hay veces en que es necesario desconectar y reconectar el Gateway al puerto USB del computador Conﬁguración para Personalización Auto-Creada
Con esta conﬁguración, se puede hacer uso inmediato del servidor de evaluación. Esta conﬁguración hace uso de ABP utilizando direcciones preconﬁguradas. Para hacer uso de esto se debe acceder a la pestaña LoRaWAN en el módulo RN y dar click en la opción de Conﬁguración para Personalización Auto-Creada, como se observa en la Figura A.9.

Pablo Avila Campos

76

