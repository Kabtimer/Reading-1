sensors
Article
Modeling the Energy Performance of LoRaWAN
Lluís Casals ID , Bernat Mir ID , Rafael Vidal ID and Carles Gomez * ID
Department of Network Engineering, Universitat Politècnica de Catalunya/Fundació i2Cat, C/Esteve Terradas, 7, 08860 Castelldefels, Spain; lluis.casals@entel.upc.edu (L.C.); bernatmir13@gmail.com (B.M.); rafael.vidal@entel.upc.edu (R.V.) * Correspondence: carlesgo@entel.upc.edu; Tel.: +34-93-413-7206; Fax: +34-93-413-7007
Received: 4 August 2017; Accepted: 14 October 2017; Published: 16 October 2017
Abstract: LoRaWAN is a ﬂagship Low-Power Wide Area Network (LPWAN) technology that has highly attracted much attention from the community in recent years. Many LoRaWAN end-devices, such as sensors or actuators, are expected not to be powered by the electricity grid; therefore, it is crucial to investigate the energy consumption of LoRaWAN. However, published works have only focused on this topic to a limited extent. In this paper, we present analytical models that allow the characterization of LoRaWAN end-device current consumption, lifetime and energy cost of data delivery. The models, which have been derived based on measurements on a currently prevalent LoRaWAN hardware platform, allow us to quantify the impact of relevant physical and Medium Access Control (MAC) layer LoRaWAN parameters and mechanisms, as well as Bit Error Rate (BER) and collisions, on energy performance. Among others, evaluation results show that an appropriately conﬁgured LoRaWAN end-device platform powered by a battery of 2400 mAh can achieve a 1-year lifetime while sending one message every 5 min, and an asymptotic theoretical lifetime of 6 years for infrequent communication.
Keywords: LoRaWAN; LoRa; energy; energy modeling; performance evaluation; Internet of Things; IoT; smart cities; LPWAN

1. Introduction
Low-Power Wide Area Networks (LPWAN) deﬁne a category of wireless communication technologies that have recently gained signiﬁcant momentum. Industry, academia and standards development organizations have devoted signiﬁcant efforts to LPWAN in the last years [1,2]. Such technologies typically offer a link range of one or more kilometers, while a single infrastructure element (often called a gateway) is capable of supporting hundreds of thousands of devices such as sensors and actuators [3,4]. Therefore, LPWAN technologies enable Internet of Things (IoT) applications, such as smart cities, by means of low cost and low complexity infrastructure.
Among LPWAN technologies, LoRaWAN (and its related modulation, LoRa), is perhaps the technology that has attracted the attention of most academic work as of the writing of this paper [5–26]. This can be explained by the public availability of its speciﬁcations [27], the availability of certiﬁed hardware [28] and the fact that LoRaWAN communication can be enabled without the need to establish a relationship with an operator.
Many LoRaWAN devices, such as sensors or actuators, will typically be battery-operated. Therefore, it is crucial to investigate the characteristics of LoRaWAN energy consumption. However, published works only focus on this topic to a limited extent, providing only rough estimates on parameters related with LoRaWAN energy performance, while not considering realistic behavior of LoRaWAN device hardware, as well as the impact of the main LoRaWAN parameters and mechanism settings [13,22,25,26].

Sensors 2017, 17, 2364; doi:10.3390/s17102364

www.mdpi.com/journal/sensors

Sensors 2017, 17, 2364

2 of 30

In this paper, we present analytical models that characterize device current consumption, device lifetime and energy cost of data delivery with LoRaWAN. For a realistic analysis, the models are derived based on measurements performed on a currently prevalent LoRaWAN platform. The models developed allow studying the impact of relevant LoRaWAN parameters and mechanisms such as data rates, acknowledged transmission and payload size, as well as Bit Error Rate (BER) and collisions, on LoRaWAN energy performance. Evaluation results illustrate energy performance and trade-offs of LoRaWAN. Among others, we have found that using an appropriate conﬁguration a LoRaWAN end-device platform powered by a 2400 mAh battery can achieve a 1-year lifetime while sending one message every 5 min, and an asymptotic theoretical lifetime of 6 years as communication becomes infrequent.
The remainder of the paper is organized as follows. Section 2 reviews related work. Section 3 overviews LoRaWAN, describing its general architecture and focusing on its physical and MAC layers. Section 4 models LoRaWAN end-device current consumption, end-device lifetime, and energy cost of data delivery, whereas Section 5 provides evaluation results obtained by using the models presented. Section 6 concludes the paper.
2. Related Work
Most of the research done on LoRa/LoRaWAN has focused on features such as coverage, robustness, capacity, scalability, delay and throughput [3,5–12]. However, a characteristic such as energy consumption, which is crucial considering that many LoRa/LoRaWAN devices will not be grid-powered, has received limited attention. We next review the literature on LoRaWAN energy consumption. We ﬁrst focus on current consumption details of LoRa/LoRaWAN devices reported in published works, and secondly we discuss the few existing models of LoRa/LoRaWAN energy consumption, node lifetime or energy cost of data delivery.
Several works provide current consumption data of LoRa/LoRaWAN devices, obtained from a datasheet or by empirical means [12–22]. Such details, which are summarized in Table 1, correspond to sleep, transmission and reception device states. As it can be seen, sleep current ranges from 7.66 µA to 34 mA (or between 30.9 µA and 3.4 mA excluding LoRa-only and custom devices). Sleep current for the considered hardware platforms is up to several orders of magnitude greater than that of their transceivers (see Table 2), which can be near or even lower than 1 µA. One important conclusion is that current LoRa/LoRaWAN nodes are far from the degree of optimization exhibited by platforms that use other low power technologies. For example, IEEE 802.15.4 and Bluetooth Low Energy (BLE) commercial devices feature a sleep current near 1 µA [23,24]. Therefore, in order to achieve attractive node lifetime ﬁgures (e.g., in the order of years), current LoRaWAN nodes need batteries with greater capacity than typical button cell batteries, e.g., of AA type, which however have bigger size and are more expensive. We attribute the sleep current in LoRaWAN devices to suboptimal hardware integration of device components, e.g., the microcontroller and the transceiver.
Based on the characterization of sleep, transmit and receive states of a LoRa/LoRaWAN device, a few analytical models of LoRa/LoRaWAN energy consumption, node lifetime or energy cost of data delivery have been published [13,22,25,26]. However, these models are too simple, since there exist several other states for a LoRa/LoRaWAN device involved in a communication that need to be considered (see Section 4). Next, we briefly present the main results and other limitations of these works. An accurate calculation of message transmission time is only provided in [25], however the study only focuses on LoRa, and therefore it does not model the MAC layer mechanisms defined in LoRaWAN, such as use of acknowledgments, receive windows, and retransmissions (see Section 3). In [13], which focuses only on optimizing downlink communications, fixed LoRaWAN settings (i.e., a single DR and acknowledged transmission) are considered. Energy consumption of 0.05–0.44 mJ and a battery lifetime between 13 and 1 year, respectively, are obtained for a device running on two AA batteries, when transferring data from 1 to 10 times per hour. However, one of the most important values used in the model, the sleep current (of 2 µA), is without explanation significantly lower than the corresponding

Sensors 2017, 17, 2364

3 of 30

value in the datasheet published by the manufacturer (i.e., 30.9 µA). In [26], only the energy related to the activation of a LoRaWAN node by using the On-The-Air Activation (OTAA) mode is modeled. In [22], the battery capacity consumed during a day by a device is calculated assuming 100 events detected and 10 frame transmissions performed by the device. The result is 222.66 µAh, which corresponds to a lifetime of 21.5 months for a 150 mAh button cell battery. Neither the impact of using acknowledgments, nor the influence of the DR configured are considered. Finally, the impact of errors due to corruption on LoRaWAN energy performance has not been modeled in publicly available works.
Based on the literature review, we conclude that, to the best of our knowledge, this paper is the ﬁrst one that provides a detailed analytical model of node energy consumption, node lifetime and energy cost of data delivery, considering real LoRaWAN device hardware behavior and physical and MAC layer parameters and mechanisms.

Table 1. Current consumption of LoRa/LoRaWAN nodes considered in the literature. When available, transmit power is shown between parentheses next to each corresponding current consumption value in transmit state. Notes: (a) The transmit power consumption setting is not detailed in these papers; we have included datasheet values. (b) A datasheet with power consumption details for this product appears not to be available. (c) The paper does not explicitly indicate the transmit power. We have deduced it based on the current consumption measured (see Table 2). (d) Data are derived from a ﬁgure related to power consumption.

Transceiver Included
Semtech SX1272
Semtech SX1272 Microchip RN2483 Microchip RN2483 Microchip RN2483 Semtech SX1276 Semtech SX1276 HopeRF HM-TRLR-LF/HFS

Device Name
LoRaWAN Multitech mDot (a) [29]
NetBlocks XRange [30] Microchip RN2483 LoRa Mote (b) [31] Custom 1 (d) Custom 2 Custom 3 LoRaBug [32] iLoad (custom)

Current Consumption

Sleep

Transmit

2 µA 30.9 µA 30.9 µA 40 µA

36 mA 26–41 mA Min.: 26 mA (2 dBm) Max.: 31/41 mA (20 dBm)

70 µA

109 mA (18.5 dBm)

3.4 mA

38.9 mA (14 dBm) 47.5–47.9 mA (14.1 dBm)

-

Min.: 23.9 mA (2 dBm)

Max.: 38.5 mA (14 dBm)

34 mA

14 dBm: 70 Ma

0.17 mA

Min.: 46 mA (0 dBm) Max.: 103 mA (14 dBm)

3.7 mA

120.7 mA (20 dBm) (c)

7.66 µA 133.3 mA (20 dBm) (c)

Receive 11 mA 12 mA -
20 mA 14.2 mA 17.2 mA -
46 mA 14 mA
16.6 mA 16.3 mA

References
[13] [14] [15]
[16] [17] [18] [12] [19] [20] [21] [22]

Table 2. Main current consumption details on LoRa/LoRaWAN transceivers used by devices in Table 1.

Transceiver Semtech SX1272 [33]

Current Consumption Sleep
0.1 µA (max. 1 µA)

Semtech SX1276 [34]

0.2 µA (max. 1 µA)

HopeRF HM-TRLR-LF/HFS [35] 2 µA (min. 1.2 µA, max. 3 µA)

Microchip RN2483 [36,37]

Up to 100-150 µA

Transmit
Min.: 18 mA (7 dBm) Max.: 125 mA (20 dBm)
Min.: 20 mA (7 dBm) Max.: 120 mA (20 dBm)
Min.: 35 mA (13 dBm) Max.: 120 mA (20 dBm)
Min.: 17.3 mA (−4.0 dBm) Max.: 38.9 mA (14.1 dBm)

Receive 10.5 or 11.2 mA 10.8, 11.5 or 12.0 mA 16 mA (min. 15 mA, max. 18 mA) 14.2 mA

3. LoRaWAN Overview
In this section, we present fundamental LoRaWAN characteristics. We describe the protocol architecture as well as the physical and MAC layers, highlighting the mechanisms, procedures and key parameters that are relevant in the scope of this paper. This section is organized in three subsections. The ﬁrst one provides a general LoRaWAN overview, whereas the remaining two subsections focus on physical and link layer functionality.

Sensors 2017, 17, 2364

4 of 30

3.1. LoRaWAN General Overview

LoRaWAN is a wireless communication technology designed to achieve long range while

consuming low power, based on a one-hop radio system. This approach allows overcoming some

important issues related with deployment complexity and low energy routing protocols, among

others [18]. On the other hand, LoRaWAN exhibits communication constraints, which may limit the

suitability oSfentsohrsi2s01t7e, c17h, 2n36o4logy for present and future IoT applications.

4 of 30

A LoRoatWherAs [N18]n. Oentwthoe orktheirshbanads,eLdoRoaWnAaNsetxahri-boitsf-csotmamrsuntiocaptioolnocgonystcraoinmtsp, wohsiechdmoafy tlihmriet tehebasic elements: end-devicessu, igtaabitleitwy oafythsisatencdhnoalocgeynfotrr aplrenseenttwanodrfkutusreerIvoTerap(psleiceatiFoings.ure 1a) [27]. End-devices, which may
A LoRaWAN network is based on a star-of-stars topology composed of three basic elements:
correspondetnod-ed.egv.ic,esse, ngastoewrsayos ranadctaucaentotrrasl ,ncetowmormk suernviecr a(steee wFigituhret1hae) [n27e]t. wEnodr-dkevsiecersv, ewrhtichhrmouaygh one or more
gateways, wcorhreilseponthdeto ne.eg.t,wseonsrokrs soer racvtueartosres,ncodmsmmuneicsasteagweitsh tthoe neentwdo-rdk esevrviceretshrtohurgohuongehoramosrpeeciﬁc gateway. End-devicegsautesweayths,ewLhioleRtahepnheytwsoicrkalselravyerersetnodsexmcehssaagnegsetomeneds-sdaegviecesswthirtohugthhea gspaetceifwic agyat,ewwahyi. le the gateway
End-devices use the LoRa physical layer to exchange messages with the gateway, while the gateway
and the netwanodrthkesneertwvoerrkcseormvermcoumnmicuanticeatoevoeverraann IIPP-b-absaedsepdrotpocrooltsotaccokl(Fsitgaucrek1(bF).igure 1b).

(a)
(b) Figure 1. LoRaWAN (a) system and (b) protocol architecture.
Figure 1. LoRaWAN (a) system and (b) protocol architecture.
LoRAWAN provides end-to-end encryption and data integrity. Upper layer payloads are encrypted by means of an Application Session Key, which provides confidentiality. On the other
LoRAWhaAndN, a pNreotwvoirdkeSsesseionndK-teoy-ies nudsedetno cprryovpidtieodnataainndtegrditaytoaveirnttheegcripithye.rtexUt ppapyleoardlaanydear payloads are encrypted bsuybsmet eofahnesadoerffaienldsA[2p7]p. lication Session Key, which provides conﬁdentiality. On the other hand, a NetwA moruLksotRSbaeeWsismAipoNlnesmpKeecneitfyeicdiastbiyounasldeledLfiontRoeasWpthrAroeNevfidudenvecitcdieosan,taaalnitdiynictsleaasglssreoist:kyCnoloawsvsneAar,stCbhlaaessiscciBLpoahRneadWrCtAelaxNsst. CpC.laaCyslsalosAsad and a subset of header ﬁaellldowss[2b7id]i.rectional communication between an end-device and the network server, which is
LoRaWscAheNduslepdebcyiftihceaetniodn-dedveicfeinbaessedthorneietsfnuenedcst.ioInntahlisitfyunccltaiosnsaelisty: Cclalasss,sdoAw,nClinlakstsraBnsmanisdsioCn lass C. Class A must be imp(fril.oeem.m, ftrheoenmetnethdde-dbneeyvtiwcaeolltrokLtshoeeRrvnaeerWtwtooArtkNhesedernvedevr-)di.ceveisc,e)acnadn oisnlayloscocukrnaoftwer nanauspblianksitcraLnosmRiassWionA(Ni.e.., Class A allows bidirectional communication between an end-device and the network server, which is scheduled by the end-device based on its needs. In this functionality class, downlink transmission (i.e., from the network server to the end-device) can only occur after an uplink transmission (i.e., from the end-device to the network server).
Class B is based on class A; however, it supports additional downlink transmission opportunities at prescheduled times. On the other hand, Class C allows downlink transmission at any time, except

Sensors 2017, 17, 2364

5 of 30

when the end-device is transmitting. Class C end-devices consume greater power to operate, but offer the lowest latency, compared with Class A and Class B end-devices. Both Class B and Class C are optional, and are in consequence not typically supported by LoRaWAN devices.
The study presented in this paper focuses on Class A LoRaWAN operation. The next two subsections present physical layer and MAC layer details for this LoRaWAN mode.

3.2. LoRaWAN Physical Layer

3.2.1. Physical Layer Main Features
LoRa modulation and Gaussian Frequency Shift Keying (GFSK) provide the physical transmission support for communication between the end-device and the gateway. LoRa modulation is based on chirp spread spectrum mechanism [38]. Each LoRa symbol is composed of 2SF chirps, where SF represents the corresponding spreading factor [7]. The use of six orthogonal SFs in the range of 7 to 12, which provide different Data Rates (DRs), results in a better spectral efﬁciency and an increased network capacity. LoRa modems also use forward error correction, adding a small overhead to the transmitted message, which provides recovery features against bit corruption. This is implemented through different Coding Rates (CRs), from 4/5 to 4/8 (denoted CR = 1 to CR = 4, respectively). On the other hand, to avoid issues regarding drift of the crystal reference oscillator, a low data rate optimization mechanism is applied, which adds a small overhead to increase robustness to frequency variation over the timescale of the LoRa message [38]. This is done for SF = 11 and SF = 12.
The Radio Frequency (RF) band to be used depends on the country where LoRaWAN is deployed. Our study considers operation in the European region, in the EU863–870 Industrial Scientiﬁc Medical (ISM) band, where three default channels are deﬁned: 868.10, 868.30, 868.50 MHz. Each one of these channels has a bandwidth of 125 kHz, uses the LoRa modulation, and must allow data rates from 0.3 kbps to 5 kbps (DR0 to DR5, see Table 3). These channels must be implemented in every end-device within the European region. LoRaWAN also enforces duty-cycle limitations stated by ETSI regulations. For the sub-band comprising between 868.0 MHz to 868.6 MHz, the duty-cycle must be <1%. Then, this duty cycle has to be distributed in the three channels of this sub-band [18]. Note, however, that ETSI regulations limit the duty-cycle over one-hour intervals, whereas LoRaWAN enforces compliance with such limitation over the interval between transmission of a message and the next one. The reference indices for each data rate (DR), and the corresponding spreading factor (SF), bandwidth and modulation conﬁguration, and resulting physical bit rate are shown in Table 3, which also includes the details for optional DR6 and DR7.
As mentioned earlier, Class A LoRaWAN functionality focuses on the end-device, which has the main role in message exchanges: all transactions are started by the end-device, whereas the network server can only transmit in one of two downlink slots, called receive windows (RX1 and RX2, in Figure 2), opened by the end-device, following a previous uplink transmission. Therefore, any message the network server has to transmit after RX2 must wait until the next receive window to be sent.
Table 3. Data rates and related conﬁguration for EU863-870 band channels.

Data Rate (DR)
0 1 2 3 4 5 6 7 8–15

Conﬁguration

Modulation

Spreading Factor (SF)

LoRa

SF12

LoRa

SF11

LoRa

SF10

LoRa

SF9

LoRa

SF8

LoRa

SF7

LoRa

SF7

FSK

50 kbit/s

Reserved for Future Use

Bandwidth
125 kHz 125 kHz 125 kHz 125 kHz 125 kHz 125 kHz 250 kHz

Physical Bit Rate (bit/s)
250 440 980 1760 3125 5470 11,000 50,000

SSSeeennnsssooorrrsss222000111777,,,111777,,,222333666444

666 ooofff 333000

Figure 2. Basic transmission scheduling in LoRaWAN Class A functionality. Figure 2. Basic transmission scheduling in LoRaWAANN CCllaassss AA ffuunnccttiioonnaalliittyy..
An end-device uses a different frequency channel for each message transmission, by following a psAAeunndeeonn-ddra--dndedevvoiimcceeuucssheeassnaandedilfiffefserereqenuntetfnrferceqeq.uueTennhcycisychcpharnaonncneldelfuofrroereaemcahcahkmemessesscasogamegetmrtaurnansnimcsamitsisiosionsino,nrbo,ybbuyfosfltloolawlogiwaniignnsagt painsetepursdfeeour-edrnaonc-erdaonmrdooctmhaerncnrhaeadlnisoneqeplureosnpecaqegu.aeTtnihocines.pimrTophcaiesidrmuprerenomctsead(keue.grse.c, ommmuamlktiuepsnaitchcao,temiotcnm.)ru.onbiucasttiaognainrostbiunstterfaegraeinncset oinrtoetrhfeerrernacdeioorporothpeargraatdioino pimroppaairgmateinontsi(me.pga.,imrmueltnitpsa(teh.,ge.,tcm.)u. ltipath, etc.). 3.2.2. Physical Layer Message Format 33..22..22.. Physical Layer Messagee FFoorrmmaatt
LoRaWAN specification defines a physical layer message that comprises a preamble, a physical headLLeoroRR(aPaWHWADANRN),ssppaeecpciihﬁfyiccasaittciioaonlnhddeeeaﬁfdinneeerssCaayppchhlyiycssiiRccaealdllluaaynyederarmnmceyessssCaaghgeeecttkhhaa(tPtccHoomDmRpp_rriCisseRessCaa),pparreeapammhybbsllieec,,aaal ppphhayyysslioiccaaadll hh(PeeaHaddYeerrP(aP(PyHHloDDaRdR)),),,aaanpdhpyhasynicsaeiclrarhloerhaddeaeedrteeCcryticColniycctRlaiceildR(uCendRduCann)dc[y2a7nC]c.hyFeicCgkhu(erPceHk3D(sPRhH_oCDwRRsC_tC)h,eRaCpph)h,yyassiiccpaahllylpasaiycyealrol ampdaey(sPlsoHaagYde P(sPtarHyulcYotauPdra)e,y.alPonHaddDa),nRaeanrndrdoarPndHeetDrercRot_rioCdnRettCaeiclfti(ieColdnRsCtah)ial[v2(7eC]Ra. FCcio)gmu[2rb7ei]n3. eFsdhigotuowrtaeslt3shisezhepohowfys2i0tchabelitlpas.yhAeyrsdimdcaietlsioslanygaellrysmt,r2uecsbtsyuatrgeees. PsotHfrCuDcRRtCuaraner.dePpPHrHeDsDeRnRat_noCdnRlyPCHinﬁDeulRpd_lsiCnhkRavCmeefaisescladogsmeshb,aitnvheudsattchooetamdl obswinzneldoinftko2t0iasbloisptistzi.emAoidzfed2di0tfiboorintlaso.llwAy,dt2rdabintysiotmensiasosllifyoC,n2RtiCbmyaetr.ees porfeCseRnCt aornelyprienseunptlionnklyminesuspagliensk, mtheusssathgesd, othwunsltihnekdisowopntlimnkizisedopfotirmloizwedtrfaonr slomwistsriaonnsmtimisesi.on time.
Figure 3. LoRaWAN physical layer message format. (*) Cyclic Redundancy Check (CRC) ﬁeld is only pppFpsFrrtiirrueeggeesaduussemeeyrrnnnee,btttp33lienr.i.inneLLluaeoouunpmRRpgplibaatlnllihiWWenknikklAAtsernnaNtNtrrngaa=spptnnhm8hhssmymyiissssyssiiinimssiccossaa=binilloo8osllnna.alssssyyTy...eehmTTrrehhbmmpoeeerelesssppa.ssrramaeeggaabeemmleffbboolllrreeemmngllaaeetttnnh.. gg((i**tts))hhcCCoiiyyssnccﬁcclliiogoccnunRRfrfiiaeeggbdduuluuerrnana; bbfddollaaeernn;;tcchffyyooerrCCdtthhehhveeeecicckkdde((eeuCCvvsRRiieccCdCee))iuunffisiseeteehllddddisiiiisssnntoouttnnhdhlliyiyyss, study, preamble length is n = 8 symbols. 3.2.3. Receive Window Parameters
3.2.3. Receive Window Parameters 3.2.3.TRhecDeiRve, tWheinfdreoqwuePnacryamchetaenrnsel and the time between the end of an uplink transmission and wptrsotSscisdrtrprcdddrwwosorsoprcdddrwwtosorsonhhheeehauoheeaeeifahuthurtoftfftfreooreooinmfcsaaemeeeiiiihsmfonhsmtfpteleosteosswfftntnwpwe0se0serlrcpcphtnawtnaheehecﬁcpsDwweaeteitedodedoeaaebenueeertuevrtonTTTonititnigotTTTTtTTTTdmsmiciacocRnweonwnoecsotcsdtodRlReltlntnllhhhrduhitihhhhohhhhoriivttttwiwiRsRtnmimitittnniisissisXniXinitaeeea5awfh5r-nnneeeeneeeevzihztnhtvsvseuauXoXsdgcak,h,.khr.kt1eeefeegfe1egeaDeaerereucDdfDDiiDedrppdftdfiiae1u1ttedSedS,n,merlDeuctclglirgrppmhhpcpumymvnRpwpyfeuuityfuuoRtiRRtsiRcctwetedspusuvhoihanoi,rnheheRpiprirqeerie,eo,noqrpnqrpnaaa,,vevoaaacareelserrtrraececiedaitaaitaussOrcriiumeumeltoalftaleaaieecvirevawoaoeett(ntneitteittruhlrhoonnnDﬁenDtetmhhitmebteentnimiimefeaaeekhbhdoe,iesisrinonenoebnbfuRbuRdndnebreykvokobmpRbmRsuFueteenebwonwstnﬁeFbeFbectnotnocaecfX-fX-hnentahahiltihctrcdrdyrdletiytlhiyltlgefuasenfnetgtsueifsiueiafoagahe1gehe1reoroosoerisiiennttenteihrtiueiiesuealnalrrcqeDqsfDsuth(ercu(er,fffcrccrrcfv[vde[ddc[dﬁcnaabrbnoensesrchslraaru2Ruuhuhaettr2pr2atoitadoRiaaRpapsetttowd,moywhod,eyrhrssued7echcahn7ea7easesXhbrsnnsmhmihmwOwOteeeear]n2aeaenR]linineeR]rne,ravta2t2iiiiyf.f1eotn.y.ayesddennd)dunlncwnrcirfcnifn),,)ddXeui,dXiaffsriDcrscfgufgcsecIseIsIesyydiaetdiestesftesieetetnaeaopfieoffittiitreires1ypiws1ruuchrsehfeRhferonnclichpcchpltlirsrsfideacii.ecialeDaDaetvaeatatvhrraseeasoenaeoveeveittOleleihuthsisnuquuudlatnataeeaenplopehlhuhnRn,sdReerrphhppﬁaadadsrsrubsflbsltcfltcfknnelendletawtaefl,a,tiftasfeaiecOeiOnerenrearwoaroeiiesiitwewnc,ocrs,ocorossteyoleoﬁedlodedwstwddeoyynfnnfsnhssneoiaeililvrfrfrttaitatiiaeiwngntaitafintifeitafftafeemmieitevdanidn,nnchnsayhnsoyohmrmrirmuvuvrilseisncrraellrrneyineenedenedeelei.ddi.ddttoeo,ofeewspesetdtiulatlaturprurpsbdqbdqbccoﬁ,,eeeeotfureofure8cwncteeatnrsmnwwetotseshalulaulaihaawiefhefc6wehwhcpctpeiedirieileeadatntdtmitararinnenfnuefneieoalieci9aeiihevhhhedetdlalavvununsinndisniehsiiibfimrd.tstctphceeleeesmtmtshshtsnvtn5veecdﬁcledhlhahiifcifceht,hoeohzhyittlanvn2aieaieekaekwcedytsysocsdeesoerdeopwwee.eremcremeestiD5seisveevetesoetsnstetwteuwtrveveotHsteitwLtwehicthceiceiacLtaLtnorprtpntrwilMil8Rt.t8ittvenerrnsoooomaeoormaargealeeoleomo,rodoisr6il6dwlsrrwrriueusd0sdncntntnninecnneeRcnse,tHeiweR9sR9s,nt,toebe.teaeebtbahtbtortocddindsdidwstdaecteci.a.eeeeaeaealealdwuesufn5Ren5zlmeemweweeberbnrltlooqW dododinynscWWi2ir2rdvo,ddrdirciXeebbdmmwcnaa,vwufefDvevaediadie5ie5i(aaweyyt,Atd(,(sosdedgetsitsecdRacA1tAtececzwzwRRnnvrtshesRse.s.ppntteueeulueD,hesDNleDoeXiMishMlHsthleHdNeXeNweXe.iwieoweoosoiietore((rrrreswsfvv(qvqevReoR1aRcRuReeiIo1wiso1aisoanmnoRaotaiDHiHrnienfiieniuue)userrnrshn.sn)sO),ms0,0neErgrnwEgrw.o.EeiettgigigtirRtacazez.dg.dwwncItctbedhbedrCwCwtctdtdggfrCeapehfhllt,rR,Rahahhfi.0t.tedrolalieoaoalhieEivesEvionihhysyeitEenionaeof)eopeeXnXntntweoIIwnfwnafiaeeeaIn.Ire,oes,ocrfrifIaotnanlbdVtdwVDnDntreﬁree1bds1bdusVeeoaTattuurnc,ta,aetntnctoDtohDdchidEeEeccroioidtolliomRaRthhahoEioisllll,sestmoufsedwedhwememwts_wt_rpnroRnRsotstieifpip_tiivnpsetahshDsDfvtfvDoetvDenvsavsre.mo.moDOhOeeaeraoholhtlasntueetmtmereaarueueeeeeIfEIfsEiairRrRuerlrerearrEaffisfitsflalsarsrucaaastskfpfasacLcwLeueuiamssw0w0mehspesspststLesesemasmauesrsrnenqrddAhAahe)cee)eqqaeil(stslsﬁoAoaiasi.tpic.tttaevaeurtteshsoenocettvuieunemnYhuYhu.mcmccxhhDarYrot.att.rcatc.henitnetdaToTidfoeidgfeeepaipae11ftfrmaaaaeenrroeo1oiReeeaeilsirmowefmdnf.hnhouoplnnelrnnerruruu,rrisnisiiiadaeswsaissdwaessxdwexmpmnnanafosRseipfppspt,ttnnttmtmndusssneetrtudsudsakahlfk,set,lN,uluhfhesepsdedinttdddlrordikiokcrocoottantioiolitqtnttnetetetete(o(hhssschyccn2eeohhcthrhcererkeeRccRfuRpfkpskrseueeteea4uaeueerrcwrre.ese.eeievDiviDiatfgseEgsaaEEnDmne8fneoofdaoummDhDiufiecascasnfofr.r.evqevoCRq3eoRCnCsdncsn,,peeiefhfhenptRlalaencRnRnsecm,emeneuuenuuuhRuRtcEcEEpmimidlynbotinreine[rddptpetioeeleoeeblemNNsiIsIwI3wmomaiitnilitl-ecftvtVn-nsa-VsesVfesfvyyavydﬁu6nrtduktdnutn[22tissn[eti[ticcciieieiethEihEE,3niresne3gnte3ti4;nndi4noesn3oesnlyuyimiddllhsoho9etava_y_r_9rnu9n8eo8edeyvdyv7ututehtssn]dsnettettpDDD]3di]3datad]seiiwofot.hshswdocde..dhc)c,td,tadseonsnaawEawEeETtheheTdufTfueeceect[etu[euffiurddimeheddtonn3h3htaoLaoLatnLteeir0pautpaarrrptptlhoeeroeer6r6dedwbneneriAriaAetaaeAdbbilrladadvcpscpts,i,rdfcfziilcncnd3nD3itltolnodDidYtYDiiatYnttntteiaatnoeoeehhttrsr7be7behhchhgbgobiwtoitkitRk22sd2sre5rgoRRa]a4dee]edeyoyoaa4aa4eeeeeeeettt)ftt);,,;,,,. the device will be in an active state, with a significant current consumption, for a certain period of

SSeennssoorrss 22001177,, 1177,, 22336644

77 ooff 3300

tthime ewdinudroinwg. Tthheiswtiimndeoiswa.nTihmispotirmtaentisfaactnorimfoprotrhteanetndfa-dcteovricfeorliftehteimeenadn-ddeivtiicsestlrifoentigmlye raenladtedit tios tshtreosnpgelcyiﬁreclatrtaendstcoeitvheershpaercdifwicatrreaunssecdeiv(seerehSaercdtwioanr4e)u. sed (see Section 4).
IInn tthhee hhaarrddwwaarree ppllaattffoorrmm wwee hhaavvee uusseedd iinn tthhiiss ppaappeerr,, tthhee ttiimmee ssppeenntt iinn pprreeaammbbllee ddeetteeccttiioonn iinn aa ﬁfirrsstt rreecceeiivvee wwiinnddooww iiss ddeetteerrmmiinneeddaasstthheessyymmbboolltitmimeeoouuttppaararammeeteterr(S(SymymbTbTimimeoeuout)t,)w, whhicihchisissestettoto8 8sysmymbobloslsfoforrDDRR00((SSFF1122))aanndd DDRR11 ((SSFF1111)),,aanndd1122sysymmbboolslsfofrotrhtehreerset sotfoDfRDsR. Os.nOthnethoethoetrhhearnhda,nfodr, tfhoer stheceonsedcorencdeivreecweiivnedowwi,nadofewat,uarefceaaltluedreCchaalnlendelCAhcatinvniteyl DAectteivctiitoynD(CeAteDct)ioins u(sCeAd.DT)hiiss muesechda. nTishmis rmedecuhcaens icshmanrneedlulcisetsenchinagnntieml eli.sItfennoinignctiommei.nIgf nsiogninacloismdientgecstiegdn,atlhies ednedte-dcteevdic, ethdeeecnidde-sdeeavrilcieerdteocsidtoeps pearerlaimerbtloe sdteotpecptrioeanm, tbhluesdseatveicntgiorna,dthiouosnsatviminegarnaddicouorrnentitmceonasnudmcputriroenn.t consumption.

TTaabbllee 44.. BBaassiicc pphhyyssiiccaall llaayyeerr ppaarraammeetteerrss aanndd tthheeiirr ddeeffaauulltt vvaalluueess..

Parameters

PNaraammeeters

Description

Name
RX1DROffset RRXE1CDERIVOEff_sDetELAY1 RREECCEEIVIVEE__DDEELLAAYY12 RECEIVE_DELAY2

DDeoswcrniplitnikondata rate, 1st receive window Downlink data rate, 2nd receive window DDDDDooaaetwwaltaannryrllaiiaftnnrteoekkomoddfffaafsesttenaaetdtrrffaaooottrfreeut,,thhp12eesnlit1dn1rsskerttectrrcereeaeiccvnieevesiievmvweewiiswwnisndiiiodnnonddowwootowwstart of 1st receive window DDeelalayyffrroommeennddooffuupplliinnkk ttrraannssmmiissssiioonn ttoo ssttaarrtt ooff 21nstdrreecceeiivveewwiinnddooww
Delay from end of uplink transmission to start of 2nd receive window

3.3. LoRaWAN MAC Layer

Default Value
DDRe(fuapullitnVka) lmueinus RX1DROffset DR0, SF12 10DD0 sRR(0u, pSFli1n2k) minus RX1DROffset 21 ss (must be RECEIVE_DELAY1 + 1 s) 2 s (must be RECEIVE_DELAY1 + 1 s)

3.3. LoRaWAN MAC Layer 3.3.1. MAC Message Format 3.3.1. MAC Message Format
LoRaWAN defines a set of MAC message types that are transmitted as payload of a physical layerLmoResasWagAeN(i.dee.,ﬁanreescaarsreiet dofinMtAheCPmHeYssPagayeltoyapdesfiethlda)t. aTrhertereanbsamsicittteydpeass opfaMyloAaCd mofeasspahgeyssiacrael ldaeyfeinremd:es(si)agtehe(i.Jeo.,inarme ceassrarigeed; i(nii)thtehePHCYonPfiarymloeaddDﬁaetlad)m. Tehssraegeebaasnidc t(yiipi)esthoef MUAncConmfiersmsaegdesDaartea dmeeﬁsnseadg:e.(iT) htheefoJorimnamt efossraageM; (AiiC) tmheeCssoangﬁerims esdhoDwantainmFesigsaugree a4n. dTh(ieiiM) tAheCUmnceossnaﬁgremceodmDpartiasems:e(sis)atghee. TMhAeCfoHrmeaadt efror(Ma HMDARC), mwehsiscahgiendisicsahtoeswtnheintyFpieguorfeM4A. CThme eMssAagCe;m(iei)ssthageeMcAomCppraiyselos:ad(i,)wthheicMh AcaCn Hcaerarydearp(pMliHcaDtioRn),dwahtaicohriandJoicinatmesetshseagtye;paenodf (MiiiA) CthemMesessasgaeg;e(iIin) ttehgerMityACCopdaey(lMoaIdC,),wwhhicichhcaalnlocwarsrya arepcpeliivcaetrioton cdhaetackorthaeJoinintemgreistsyagoef;aanMdA(iCii)mtheessMageessraegceeiIvnetedg.rOityn Cthoedeot(hMeIrCh),awndh,icdhaatallomwesssaargeecseicvaenr tcoarcrhyeMckAtChecoinmtemgarnitdysoifnathMe AfrCamme epsasyalgoeadre(cFeRivMedP. ayOlnoatdh)e, wothhiecrh hcaannda,lsdoabtae mcaerrsiseadgeins tchaenfcraamrrye MheAadCecro(FmHmDaRn)d,sdienptehnedfirnagmoenptahyeloFaPdor(tFvRaMluPe.aMylAoaCd)c,owmhmicahncdasnaarelsoinbteencdaerdrietod cinonthfiegufrraemraedhioeaadnedr (MFHADCRla),ydereppeanrdaminegteorns.thAenFiPmoprtovrtaalnute.suMbAfieCldcoinmtmheanFdHsDaRre iisnatebnidtetdhattoaclolonwﬁgsuarcekrnaodwioleadngdinMg AthCe llaaysteCr opnafriarmmeetderDs.atAa nmiemsspaogretarenctesivuebdﬁ.eld in the FHDR is a bit that allows acknowledging the last Conﬁrmed Data message received.

Figure 4. LoRaWAN Medium Access Control (MAC) message format. The (*) FPort ﬁeld is present wFihgeunreth4e. fLroaRmaeWpAayNloMaded(FiRumM APacycelossadC)oﬁnetlrdolco(MntAaiCns) mdaetsasa(ig.ee.,fiotrhmaasta. Tnhoen-(z*e)rFoPloerntgftihe)l.dMisdperneosetenst twhheemnatxhiemfruammesipzeayolfotahde(MFRAMCPPaayyllooaadd) ﬁfieelldd. cTohnetafirnasmdeahtaea(id.ee.r, i(tFhHaDs aR)nﬁonel-dzehraosleansgizthe)o. Mf 7dbeynteosteisf itthde omeasxnimotucmonstiazienoofptthioenMs,AaCndPauyplotaod2f2ieblydt.eTshwe hfreanmoephtieoandserar(eFHusDeRd)(fwieiltdh haansoapstiizoenosfiz7eboyfteuspiftiot 1d5oebsytneost).cIonntthaiisnpoapptieor,nws,eaansdsuump etoth2a2t boyptteiosnwshaerne noopttipornesseanrteiunsdedata(wmitehssaangeosp.tion size of up to 15 bytes). In this paper, we assume that options are not present in data messages.
3.3.2. Transmission and Retransmission Procedure 3.3.2. Transmission and Retransmission Procedure
When an end-device transmits an uplink Conﬁrmed Data message, it expects to receive a downlink acknoWwhleendgamneenntdm-deesvsaicgee tirnanosnme iotsf tahne nuepxlitntkwoCorencfeirimveedwiDndatoawms.esIfsathgee,aictkenxopwelcetds gtmo ernecteiisvneoat rdeocweinvelidn,kthacekennodw-dleedvigcme reenttramnessmsaitgsethine osanme oefmtheessnaegxetutwntoilraenceaicvkenwowinldedowgms.eInftthiseraecckenivoewdloerdgumnteilnat is not received, the end-device retransmits the same message until an acknowledgment is received or until a maximum number of MAC layer transmission attempts for the message (the

Sensors 2017, 17, 2364

8 of 30

maximum number of MAC layer transmission attempts for the message (the recommended default number being 8) is reached. Each transmission attempt is done in a different channel, which is randomly selected from the channels available in the subband used. The DR to be used is recommended to follow the next rules. The 1st and 2nd transmission attempts of a conﬁrmed message are done by using the same DR, the 3rd and 4th attempts use the next lower data rate (or DR0 if it was the DR previously used), and so on, until the 8th transmission attempt. After 8 transmission attempts of the same conﬁrmed message without an acknowledgment, the MAC layer should return an error code to the upper layer (i.e., the application layer). Each retransmission is started after an acknowledgment timeout (ACK_TIMEOUT) period, which is initiated at the start time of the last 2nd receive window, and is deﬁned as a random delay between 1 and 3 seconds, by default [39].
4. Modeling LoRaWAN End-Device Current Consumption
In this section, we present models of crucial LoRaWAN energy performance parameters such as end-device current consumption, end device lifetime, and energy efﬁciency of data delivery. We assume a class A end-device that periodically transmits an uplink data message (e.g., a notiﬁcation that carries a sensor reading). In the models, we consider the impact of bit errors. For the sake of tractability and clarity, we assume a uniform BER that refers to the residual BER after application of physical layer error correcting techniques, equivalent to the residual BER that corresponds to message loss rate due to non-ideal link quality. The section is divided in two subsections, which offer the aforementioned models for unacknowledged and acknowledged transmission, i.e., the transmission of unconﬁrmed and conﬁrmed data messages, respectively. We develop the models for all DRs that are mandatory (i.e., from DR0 to DR5), as well as for DR6.
4.1. Unacknowledged Transmission
Our ﬁrst goal is modeling the average current consumption of an end-device in the unacknowledged approach, denoted Iavg_unACK. In order to determine this parameter, we ﬁrst derive a proﬁle of the different states traversed by the end-device, as well as the duration and the current consumed in each state. In order to realistically model the end-device behavior, and without loss of generality, we develop the model based on measurements from a real LoRaWAN testbed. The measurement setup is shown in Figure 5. We use the MultiConnect mDot platform from Multitech [29] as our reference end-device platform for the model, since it is a popular platform, and it is based on the also widely used SX1272 transceiver [33] (see Table 1). While other LoRaWAN end-device platforms might exhibit differences with the mDot platform (e.g., due to their internal architecture), we understand that our model captures the main states of a LoRaWAN end-device. On the other hand, it must be noted that the mDot platform offers low current consumption decrease (of ~3%, and only in the transmit state) when the voltage applied is reduced from 5 V to 3.3 V, the latter being the lowest voltage that allows the device to operate [29]. However, other platforms may not offer the same current consumption stability as battery voltage decreases over time.
In the measurements, the transmit power of the end-device is set to 11 dBm, which is the default value for this parameter. The gateway is a Kerlink LoRa IoT Station platform [40]. Both the end-device and the gateway are located in an indoor scenario, where the distance between the end-device and the gateway is 2 m. In the measurements, data messages carry a frame payload of the maximum size allowed for each DR in the EU band.
We assume a periodic behavior for the LoRaWAN end-device, therefore we model its current consumption during one period. Each period comprises a data message transmission by the end-device (including the related procedures required to enable such transmission), otherwise the device is in sleep mode. Note that, for an end-device in unacknowledged transmission, current consumption is independent of the BER; that is, regardless of whether channel errors take place in the communication, the end-device will consume the same amount of energy for any transmission, since there will not be retransmissions in unacknowledged transmission. Time and current consumption measurement

Sensors 2017, 17, 2364

9 of 30

results provided in this section are obtained from several measurements for each tested conﬁguration

within a notiﬁcation period. We found negligible differences within each set of measurements for

eSeancshorsco20n1ﬁ7,g1u7,r2a3t6io4 n.

9 of 30

FFiigguurree 55.. EExxppeerriimmeennttaall sseettuupp ffoorr ccuurrrreenntt mmeeaassuurreemmeennttss ooff tthhee MMuullttiiCCoonnnneecctt mmDDoott LLooRRaaWWAANN eenndd--ddeevviiccee mmoodduullee ((oonn tthhee lleefftt)) uussiinngg aann AAggiilleenntt NN66770055AA ppoowweerr aannaallyyzzeerr..
ptstcedctrhhoooneeaeemnnrdvnfssi-csosecuudFWotmreammieimmngtvieiespptumseisesacttdrireiisuieotoovnsrnnb(nnuaa6ii,yslnmvcsilaadcsee)itleltl.eruohluiispunoTanredeindsagndipmtMb,enrgwepltagaoeruhteinidoeeltot5ntdhhensdided.CeetinbetcheNohrndeﬁpeenbehto-nlednevaatoreheceeatvifseuovcarittditodvriahhacrrni.mbaeeepodtnlorErBw,DeobtadsfEfocisocoelctReetlhrhrsodr;ccLatvnuaothrptoehsinrneebrudReaseremsLteauipsaonoWirmrprsdtedRee,htAqes-iaredoetuceWNthnonehidgrevmteAaieefiptrdsfcpnshNderaeardeorltmmieoee-ﬁsidsdnnneeeluseeestdnrfauvos-oaamoadniftrtcbafaeiweootldavceeuankhlaicslncnsnoetaeiuatDtonnn,hucowﬁvRdthemnfhgorslaceeeet,ulccuvrnrdsrehkaesreegexnfnraadrdeoecgnsgodrenmieynwetnptoetiftlwctsrlaeoroasunfedareionnsrongauressrmnsenomunmt)dDorymh,aisdsicReotsptsetkrtrs0aidthalnaoiikoneuiono(ntennrsnrssw,wmaompccoltbtilieuuiefisasyosderrcsesntrrgieaiheetotoechhonniandnhneefttt, ((psotrSscfebadssroetioaniryeetatanncrdcnaradftnectichfteetsneheoiseee.urbvaFeemsrsnI6emc2esiemtnMgh)hoi)othasimup,aufotenustitarivtnhnrfieamodielnoieotcteslmodii6ldnotanCdlryete,wegm,iretotdmloahanattshlniiuhhbscnenlineecnlurtessesndaoguiseetrmbsretnnceredatapeurnvtnfmhoieerstirrdsemedttgemeesdetbs-oua-hmidDnedeabotmfreanhetlioeneeatsornvdedbhntvt,ewsifi-lieLtciricoofedctteueifronrhsenteetﬁierRehirserevrssrdwcaetaaeaudisohsnniincWtctinlsaeneetsthttoawmthsmdAssectbfsciltopraceaneNaliortatneskremhetnenfsosescaepeodefiusseevsoinrr,mnmgirmiainuvdsdtenoaudhtsieop-spevltatrdleitdisdtaowtof(ieieDoeﬁitolsntvciivi,hatfnrnonRfaiaewcsocesndtsutdpttteitre,hh.idooanrrvciiitoeew1ntanacsoihexcf)ttch.nise,yaescpalk.DfeeeinnienivdusacpgeWouroetnunutciuxfirowohdirnwthrifatdanenoaatnleivtwde.ghrrcnniaaidkuoeWdaatttrcnngnthhoeirtohtoteeaeeeahswuooewdcrdlfesbidkf(aoezielistnuoettrsneutatthDodarradeidnciaadewngntrRld-tneb,oeeidtiﬁl0otosyedsde4henrmenrd(i)vaseefnftdngtarriiguooc,estaceocrleuftsnnanedemieeirgrndtssocfsitritimodae-srnlteshbdmaacien.alipivtneerestvhtteretsvsTes(seectidmishroeiiwopcnmtietatneneifhaanstlsif,estenrseserdmetaeurtiardhaov-pldemd3eadootneanrea)ninefwlopo.scssoprdvgcteu)aArteiii.e(srsdowcrrsadafTcefentittwvcoiuumouaeatwterthrbrtririmhreitrevenlanhsteerntiheieehe5ttntittdddnooyee5es)st. ovnarifaobrlepsotshsaibt rleepinrecsoemntinthge ddautraatuionnitasn, duncutirlrtehnet csoencsounmdprteicoenivoef ewacinhdsotawte.iIsncitlioaslleyd, tdhueeentod-adbesveicnecies oinf isnleceopmminogded,awtah(iscthaties c7h).arNacotteeritzheadt bthyeashcuorrrteenrtdcuornastuiomnpotifotnhethsreeceoonrdderresceoifvme awginnidtuodwe ibseldouwe tthoaut soef othfethreesCt oAfDstamteesc. hWahneisnmth(eseeendS-edcetivoicne3s.t2a.r3t)s, twheheprreobcyedtuhreeetnodp-edrefovrimcetshteoptrsanpsrmeaimssibolne,diteftiercsttiwonakmesuuchp e(satraltieer1t)h, nanexitnththeerﬁadrsitoriencteeirvfaecwe iinsdporwepaifrendo fionrcoamctiivnigtysi(gsntaatlei2s)d, eatnedcttehde.nAtfhteeretnhda-td, ethveiceratdraionsinmteitrsfathcee viotmctdaoshhlniffaoafDeatdttsuathsSeeoewrewdenutnqrd,fapneeuiiai-aridltedhtsnaslntetadovP(fcrvvsifoeeeatftiehrracc((miteetensspheittovre.heaa4anteTtet)dreedirhwaudia-o81dindelis0)intnei,Io)iisdnvl,satiiottiipnﬁcctpuewroetersroiefnendowsra(tserstfscaapiatdetsatncirothtteoo(yeseeSrnnc((e5sPsersttp)fattsIu.oawa)dseS,trrticieiennibotipnﬁhieg36noict))cnestwig.uthnssAonitetnetbooaeefrtlstrtienetieluevcnhrtiebtadchenhitlmovuehcesfmoeeleoismelmtimlltteanliroaoipsrgaoneitwtnndgschpostesofemramdne(attaisaheidinnctstmeada(strlseiotasbourterectalennneceo9tm,noiaen)titnl,cssat1h,yarcdid1enooun)eorslmn.detlefeientOcnpmitcrdelhtnaita-etuvehyedhndeneleeead,oivnwsdtcashatidaedcdihmenct-eieidotdtfoeidrineroornasaivdswnsnt,dtiaaawscr.ritblmeeoeeDlhccceefiiueoiesonsxciirnsrvhtveriiesnaecteoirhtdugdnafwweiatketoefichidrernnseaeaousddtacomrlipootaaoftiwlwttvunatttiihhoerctiiinrnyeeesss, mcloicsreodcodnuterotlolearbtosetnhceeroafdiinocionmteirnfagced,aftoar(tshtaetrea7n)g. eNooftpeatyhlaotatdhesizshesorinterLodRuaraWtiAonN,otfhtahteissetycopnicdalroecfeSiPveI. window is due to use of the CAD mechanism (see Section 3.2.3), whereby the end-device stops preamble detection much earlier than in the first receive window if no incoming signal is detected. After that, the radio interface is turned off (state 8), a postprocessing interval follows (state 9), and the end-device executes a turn off sequence (state 10), prior to returning to the sleep state (state 11). One additional consideration is that we have not identified any specific state due to the internal communication, which takes place via Serial Peripheral Interface (SPI), between the main microcontroller and the radio interface of the mDot platform. This is consistent with the submillisecond latency of payload transmission from

Sensors 2017, 17, 2364

10 of 30

Sthenesomrsi2c0r1o7c, o17n,t2r3o6l4ler to the radio interface, for the range of payload sizes in LoRaWAN, that is t1y0poifc3a0l of SPI.

Figure 66.. CCuurrrreennttccoonnssuummppttioionnpproroﬁflieleofofa aMMulutilCtioCnonnencetcmt mDoDtoLtoLRoaRWaAWNAeNnden-dde-vdiecveipceerpfoermfoirnmginang uannaucnkancokwnolewdlgeeddgetrdantrsamnsismsiossniownitwhiDthRD0.RT0h. Te hdeatdaamtaemsseasgseagtreatnrsamnsimtteitdtehdashasFaRFMRMPayPlaoyaldoasdizseizoef 5o1f 5b1ytbeyst(eis.e(.i,.em.,amxiamxuimmupmospsoibssleibsliezseizfoerfDorRD0)R. 0).

TTable 5. States, variables and their values for LoRaWAANN uunnaacckknnoowwlleeddggeedd ttrraannssmmiissssiioonn..

State Number State Number 1
12 23 34 45 56 67878 99 1100 1111

Description Description wake up
wraadkioe uppreparation rTardainosmpriespsiaornation Twraints1mstiswsiionndow w1satirte1csetivweinwdionwdow 1wsat irte2cneidvewwinidnodwow w2r2raannaddddiiitoorr2eeoonccffedeffiivvweeinwwdiinonwddooww PPoossttpprroocceessssiinngg ttuurrnn ooffff sseeqquueennccee SSlleeeepp

Duration DVuraartiiaobnle VaTrwiuable
TwTupre TpTretx TtTx w1w TwT1rwx1w TrTx 1ww2w TTTTTwropsTTTTxefofq2s2ropswxetfowfq2stw TsTleselpeep

Value (ms) 1V6a8l.2ue (ms)
8136.8 .2
(8se3e.8Table 6) 9(8s3e.e3Table 6) (9se8e3.T3able 6) E(qseueatTiaobnle(46)) 13E134343q7.07.u.04.4ation (4) 226688.0.0 3388.6.6 EEqquuaattioionn((22))

Current Consumption CVuarrrieanbtleConsVuamlupeti(omnA) VIwauriable 22V.1alue (mA)

IIwprue
IIptxre
IItwx1w IIw1w1w II1ww2w IIIIIIIIIwops22opsefoewfwofqf2qsstwt IIsslleeeepp

132.32.1
831.03.3 278.03.0 382.17.0 273.18.1 3153213..02735...120 212.01.0 131.33.3 454×51×0−13 0−3

Let TNotif be the time between two consecutive periodic message transmissions performed by the end-dLeevt iTcNe,otii.feb.,eththeentoimtifeicbaettiwoneepnertiwodo.cLoentsTeci uatnidveIipdeernioodteictmheesdsuargaetitornanasnmdiscsuiorrnesnpt ecrofnosrummedptbioynthoef estnadte-dieivnicTea,bi.lee.,5t.hIaevgn_uonAtiCﬁKccaatniotnhpuesrbioedc.aLlceutlTatieadndasIsi hdoewnonteinthEeqduuartiaotnio(n1)a:nd current consumption of state i in Table 5. Iavg_unACK can thus be calculated as shown in Equation (1):

∑ Iavg__unACK ==

11 TNoti f

Nstates Ti··Ii
i=1

(1(1) )

where Nsstaatteessisis1111ininuunnaacckknnoowwlleeddggeeddttrraannssmmiissssiioonn..NNootteetthhaattTTslseleepepcacnanbebeobotbatianiendedasa:s:

Tsleep == TNoti f −− Tact

(2(2) )

wsswttaahhtteeeerrsseeeeTTxxaacccceett ppddtteenttnhhooeetteesssllseetteehhppeeiisnsnuuttememrrvvooaaffll::tthhee dduurraattiioonnss ooff aallll ssttaatteess rreellaatteedd wwiitthh ttrraannssmmiissssiioonn aaccttiivviittiieess,, ii..ee..,, aallll

= + ++

+

+

+

++

+

(3)

Tact = Twu + Tpre + Ttx + Tw1w + Trx1w + Tw2w + Trx2w + To f f + Tpost + Tseq

(3)

The durations Ttx, Trx1w, and Tw2w are variable and depend on the DR in use. Tw2w actually depends

on Trx1w, and can be obtained as:

=

_

_2 −

_

_1 −

(4)

Sensors 2017, 17, 2364

11 of 30

The durations Ttx, Trx1w, and Tw2w are variable and depend on the DR in use. Tw2w actually depends on Trx1w, and can be obtained as:

Tw2w = RECEIVE_DELAY_2 − RECEIVE_DELAY_1 − Trx1w

(4)

Although Trx2w also depends on the DR, the end-device platform in our experiments uses a ﬁxed setting for the second receive window (which corresponds to DR0), and thus the measured value for Trx2w is also constant. We next provide the models to derive Ttx, Trx1w and Trx2w.
In order to determine the time needed to transmit a data message via the radio interface, Ttx, we take into acount LoRaWAN procedures, LoRa modulation details and the corresponding regional parameters. Ttx can be expressed in terms of the time required to transmit both the preamble and the physical message, denoted Tpreamble and TPHYMessage, respectively, as follows [38]:

Ttx = Tpreamble + TPHYMessage

(5)

Tpreamble can be obtained as shown next [33]:

Tpreamble = Tsym· Npre + 4.25

(6)

where Npre is the programmed number of symbols to be used by the radio transceiver, the actual physical length of the preamble is (Npre + 4.25) [7], and Tsym is the time of a symbol (in seconds), which depends on the SF and the channel bandwidth (BW, in Hz), as follows [38]:

Tsym

=

2SF BW

(7)

On the other hand, TPHYMessage (in seconds) can be evaluated similarly:

TPHYMessage = Tsym ∗ NPHY

(8)

where NPHY indicates the number of symbols transmitted as the physical message (excluding the preamble), and it can be determined as follows [38]:

NPHY = 8 + max

ceil

28 + 8·PL + 16·CRC − 4·SF 4·(SF − 2·DE)

·(CR + 4), 0

(9)

In (9), SF corresponds to the spreading factor and can take values from 7 to 12 (which correspond to data rates from DR5 to DR0, respectively); CR denotes the coding rate and can take values from 1 to 4, for 4/5 to 4/8 coding rate, respectively; PL indicates the physical payload length, in bytes. CRC indicates the presence or not of the CRC ﬁeld in the physical message (CRC is set to 0 if the CRC ﬁeld is not present; otherwise, CRC is equal to 1); ﬁnally, DE, which indicates whether the mechanism to avoid issues regarding drift of the crystal reference oscillator is used or not, takes value 1 for SF12 and SF11 (i.e., it is used for the lowest data rates), and value 0 for the rest of SFs. Equations (5)–(9) can be used to model the duration of both uplink and downlink transmissions (e.g., the latter may correspond to acknowledgments sent in response to uplink data messages, see Table 6).
After modeling Ttx, we proceed to determine the duration of a receive window when no preamble is detected, which occurs in both receive windows in unacknowledged transmission. We next model the behavior of the hardware module used in our experiments in each receive window.
For the ﬁrst receive window, Trx1w can be determined as follows:

Trx1w = Ndsym·Tsym

(10)

Sensors 2017, 17, 2364

12 of 30

The end-device stays in receive mode for the duration of Ndsym symbols Ndsym is 8 symbols for SF = 12 and SF = 11, and 12 symbols for the rest of SFs.
For the second receive window, the receiver is active during a fraction of a CAD state (see Section 3.2.3). This fraction has a duration, denoted Trx2w, that can be calculated as shown next:

Trx2w

=

2SF + 32 BW

(11)

After providing the models for determining Ttx, Trx1w and Trx2w, Table 6 summarizes their main values, along with relevant parameter settings used in our end-device platform. For Trx2w, we include the corresponding values for the different DR settings possible. However, in our experiments, only the Trx2w value corresponding to DR0 was used.

Table 6. Summary of values for Ttx, Trx1w and Trx2w, along with relevant parameter settings. We have assumed an 8-symbol preamble length, a CR of 4/5 (except for the 20-bit physical header, for which a CR of 4/8 is used), and a bandwidth BW = 125 kHz (except for DR6, with a bandwidth BW = 250 kHz, and for DR7, which is based on FSK). Ttx max is obtained by considering the maximum frame payload (FRM Payload) size for each Data Rate (DR), while Ttx min corresponds to the time to transmit a data message that carries no data (e.g., an acknowledgment). In the latter case, the physical frame length is the contribution of the physical header (PHDR) and PHDR_CRC ﬁelds, the MAC Header (MHDR), the FHDR and the MIC ﬁelds (see Section 3.3.1), leading to a total length of 14.5 bytes plus 8 preamble symbols. Note that the CRC is only present in uplink transmissions (see Section 3.2.2). For DR7, an additional margin should be added to the Trx1w and Trx2w values to account for possible drifts of the oscillator used for the timer that controls a receive window start.

DR SF

0

12

1

11

2

10

3

9

4

8

5

7

6

7

7

-

Tsym Tpreamble Trx1w

T rx2w

DE

(ms) (ms) (ms) (ms)

32.77 401.41 262.14 33.02 1

16.38 200.70 131.07 16.64 1

8.19 100.35 98.30 8.45

0

4.10 50.18 49.15 4.35

0

2.05 25.09 24.58 2.30

0

1.02 12.54 12.29 1.28

0

0.51 6.27

6.14

0.64

0

0.02 0.48

1.28

1.28

-

FRM Payload

Max

Min

(bytes)

(bytes)

51

0

51

0

51

0

115

0

242

0

242

0

242

0

242

0

Ttx Max
Uplink
(ms)
2793.5 1560.6 698.4 676.9 707.1 399.6 199.8 42.4

Ttx Min
Downlink
(ms)
991.8 577.5 288.7 144.4 72.2 41.2 20.6 3.2

Once all variables required to compute Iavg_unACK are determined, we can calculate the theoretical

lifetime of a battery-operated end-device that performs unacknowledged transmissions, denoted

Tlifetime_unACK, can be obtained on the basis of the battery capacity, Cbattery (expressed in mA·h), as

shown next:

Tli f etime_unACK =

Cbattery Iavg_unACK

(12)

Note that the above theoretical end-device lifetime calculation assumes an ideal battery with a linear behavior, whereas the characteristics of a real battery degrade over time. Therefore, the calculated end-device lifetime results provided in this paper provide an upper bound on the actual end-device lifetime that can be expected.
Finally, another important performance parameter is the energy cost of data delivery, ECdelivery_unACK, which provides the energy consumed by the end-device per each delivered bit of data payload in unacknowledged mode, as shown below:

ECdelivery_unACK = Iavg_unACK ·V·Tnoti f E ldelivery_unACK

(13)

Sensors 2017, 17, 2364

13 of 30

where V denotes the voltage and E[ldelivery_unACK] indicates the expected amount of data successfully delivered by the end-device per data frame transmitted. Note that in the previous equation, the

numerator computes the energy consumed by the device during Tnotif. Let lpay be the FRM Payload ﬁeld size (i.e., the amount of data carried in the payload of the data

message sent by the end-device), and let lData be the total size of the data message, including all headers.

Let b denote the BER as introduced in the ﬁrst paragraph of Section 4. Since in unacknowledged

transmission there is a single transmission attempt, which may suffer bit errrors, E[ldelivery_unACK] is

determined as:

E ldelivery_unACK = lPay·(1 − b)lData

(14)

Finally, let us assume that collisions may occur, i.e., an end-device message transmission may overlap with messages transmitted by other end-devices connected to the same gateway. Let pcoll be the probability that a data message transmitted by an end-device collides with at least another message transmission. In order to capture impact of collisions on E[ldelivery_unACK], Equation (14) can be extended as follows:

E ldelivery_unACK = lPay·(1 − b)lData ·(1 − pcoll )

(15)

Note that, as already introduced, b corresponds to the residual BER after application of physical layer error correcting techniques, equivalent to the residual BER that corresponds to message loss rate due to non-ideal link quality. In this paper, we assume that CR = 4/5, since it is the default CR in LoRaWAN, except for the 20-bit physical header, where CR = 4/8 is used. For CR = 4/5, a parity bit is added to each group of 4 bits from the physical layer message to be transmitted. Assuming that an error-correcting code is used for CR = 4/8 (e.g., a Hamming code [41]) and the range of BER values for reasonably useful links, and given the short size of the physical header, we approximate the relationship between b and the physical layer BER, denoted bphy, as shown in the next two equations. Let ploss be the probability that a transmitted message is affected by at least one bit error, and therefore the message is lost, and let lphy_header be the 20-bit header size. Therefore:

ploss = 1 − (1 − b)lData = 1 −

1 − bphy

5 4

·(lData

−l

phy_header

)

(16)

(1 − b)lData =

1 − bphy

5 4

·(lData

−l

phy_header

)

(17)

4.2. Acknowledged Transmission
We next model end-device average current consumption in the acknowledged transmission approach, based on the corresponding current consumption proﬁle of the same hardware platform as in the previous subsection.
In this approach, the end-device may behave in two different ways, since the acknowledgment may be transmitted in the ﬁrst receive window or in the second one. In our model, we consider both options. We initially assume BER = 0, and we subsequently extend the model in order to consider a non-zero BER. Therefore, the average current consumption of an end-device in acknowledged mode, denoted Iavg_ACK, can be obtained as shown in the next equation:

Iavg_ACK = p1win·Iavg_ACK_1 + p2win·Iavg_ACK_2

(18)

where Iavg_ACK_1 and Iavg_ACK_2 denote the average current consumption of the end-device when the acknowledgment is received in the ﬁrst and in the second receive window, respectively, and p1win and p2win represent their corresponding probabilities. The LoRaWAN speciﬁcation offers freedom for network managers and implementers to apply the policy that best suits the requirements of a speciﬁc
deployment. Therefore, since there is no speciﬁc priority by default for the two receive windows, we

Sensors 2017, 17, 2364

14 of 30

assume that an acknowledgment may be received by an end-device in the ﬁrst or in the second receive

window with the same probability (i.e., p1win = 0.5 and p2win = 0.5). We next derive the models for obtaining Iavg_ACK_1 and Iavg_ACK_2. Figure 7 depicts the current

consumption proﬁle of an end-device that performs an acknowledged transmission in two different

situations: in Figure 7a), the acknowledgment is received in the second window, while in Figure 7b),

the acknowledgment is received in the ﬁrst window. (Note: in our speciﬁc scenario, we observed

that for DR0-DR3, all ACKs were received in the second window, while for DR4-DR5 all ACKs were

rSeencseoirvs e2d017in, 1t7h, 2e3ﬁ64rst window.)

14 of 30

(a)

(b)

FFiigguurree 77.. CCuurrrreenntt ccoonnssuummppttiioonn pprrooﬁfillee ooff aa MMuullttiiCCoonnnneecctt mmDDoott LLooRRaaWWAANN eenndd--ddeevviiccee ppeerrffoorrmmiinngg aann aacckknnoowwlleeddggeedd ttrraannssmmiissssiioonn:: ((aa)) wwiitthh DDRR00 ((lleefftt)),, ((bb)) wwiitthh DDRR55 ((rriigghhtt)).. IInn tthhee ffoorrmmeerr,, tthhee aacckknnoowwlleeddggmmeenntt iiss rreecceeiivveedd bbyy tthhee eenndd--ddeevviiccee iinn tthhee sseeccoonndd wwiinnddooww,, wwhheerreeaass iinn tthhee llaatttteerr tthhee
aacckknnoowwlleeddggmmeenntt iissrreecceeiviveeddininththe eﬁrfsirtswt winidnodwo.wT.hTehdeadtaamtaemsseasgseagtreantrsamnistmteidttbedy tbhye tehned-ednedv-idceevhiaces
ahaFsRaMFRPaMylPoaaydlosiazde soifze51obf y51tebsy(lteefst)(laenftd) a2n42d b2y4t2ebsy(rteigsh(tr)i,grhets)p, erecstipveecltyi.vely.

When the acknowledgment is received by the end-device in the first window, the number of statesWihnevnoltvheedaicnknaocwknleodwglmedegnetdistrraencesmiviesdsiobny tdheecreenadse-ds eivnicceoimnptahreisﬁonrstwwitihnduonwa,ckthneownluemdgbeedr otrfasntsamteisssiinovno, lsviendceinthaeckennodw-dleevdigceeddtoreasnsnmotisnsieoend dtoecwreaaistefsoirnacosemcopnadrisroencewiviethwuinnadcokwno(wTalebdlege7d). tOranntshmeisostihoenr, shiannced,thdeuernatdi-odnevoifcethdeofeisrsntortenceeievdetwo winadiot wfor(Tarsx1ewc)oannddrercaedivioe owfifnidnotewrv(aTlab(Tleoff7))i.nOcrneathsee ositnhceer thhaenadc,kdnuowralteiodngmofenthteneﬁerdsts rteocbeievreecweiinvdedowan(dTrsxu1bws)eaqnudenrtaldyiporoofcfeisnsteedr.vTahl e(Treofffo)rien,cIravega_AsCeK_s1incacne tbhee daecrkinveodwlbeydgumsienngt tnheeedssamtoebeeqrueacteioivnesduasnedd stuobcsoemqupeunttelyIapvgr_uoncAeCKss(eid.e.., TEhqeureaftoiorne,s I(a1vg)_–A(1C1K)_)1, cbaunt bcoendseidrievreindgboynluysitnhge sthtaetessamtheateeqxuisattiwonhsenustehde atockcnoomwpleudtegmIavegn_tuniAsCsKen(ti.ein., tEhqeufairtsiot nresc(e1iv)–e(1w1i)n),dbouwt c(wonhsiicdheirsinegquoinvlayletnhtetsotasteetstinthgabt oetxhisTt ww2whaenndthTe2watcok0noinwtlheedgeqmueantitoinsss)e,natnidntthheevﬁarlsuterseicneiTvaebwlein7.dow (which is equivalent to setting both Tw2w and T2w to 0 in the equations), and the values in Table 7.

Table 7. States, variables and their values for LoRaWAN acknowledged transmission when the Taackbnleow7.ledStgamteesn, tviasrsieanbtleisn athnedfitrhsetirrecveailvueews finodr oLwoR. aWAN acknowledged transmission when the acknowledgment is sent in the ﬁrst receive window.

State Number Description

1 State Number wakDeeuspcription

2

radio preparation

Duration
VarDiaubrlaetion Twu TpreVariable

Value (ms) 169.2 80V.4alue (ms)

Current Consumption

CVuarrrieabnlteConsuVmaplutieo(nmA)

Iwu VIapreriable

22.1 V13a.l7ue (mA)

31

tranwsmakisesiuopn

Ttx Twu

(se1e6T9a.2ble 6)

IwItxu

282.81

42

wairta1dsitowpinredpowaration Tw1Tw pre

988.04.4

IpIwre1w

1237.17

53

1st trreacneisvme iwssiniodnow

Trx1Tw tx

(Tt(xsmeeinTianbTleab6le) 6)

ItIx1w

8321..88

84

radwioaoiftf1st window Toff Tw1w

3397.888.4

IwIof1f w

2173..41

95

pos1tpstrorceecsesiivneg window TposTt rx1w

27(2T.5tx min in Table 6) I1Ipwost

3210..98

108

turnraodffioseoqfufence

TseqToff

373.537.8

IoIsfefq

1133..44

119

sleeppostprocessing

TsleeTp post

Eq2u7a2ti.o5n (2)

IpIsolesetp

2405.×9 10−3

10

turn off sequence Tseq

37.5

Iseq

13.4

11In order to comslpeuepte Iavg_ACK_2, we taTkseleeipnto accouEnqtutahtaiotnb(e2h) avior of tIhsleeepend-devic4e5i×s s1i0m−i3lar to

that in unacknowledged transmission, since states involved in the corresponding transmission

operations are the same, and only two differences can be observed: duration of the second window

(T2w) and of the subsequent radio off interval (Toff) are both larger than in the unacknowledged

transmission. In fact, the end-device needs to stay in the second receive window for the time needed

to receive the acknowledgment, and subsequent operations involve processing of the ACK.

Therefore, Iavg_ACK_2 can be obtained by means of the same equations used to compute Iavg_unACK

Sensors 2017, 17, 2364

15 of 30

In order to compute Iavg_ACK_2, we take into account that behavior of the end-device is similar to that in unacknowledged transmission, since states involved in the corresponding transmission operations are the same, and only two differences can be observed: duration of the second window (T2w) and of the subsequent radio off interval (Toff) are both larger than in the unacknowledged transmission. In fact, the end-device needs to stay in the second receive window for the time needed to receive the acknowledgment, and subsequent operations involve processing of the ACK. Therefore, Iavg_ACK_2 can be obtained by means of the same equations used to compute Iavg_unACK (i.e., Equations (1)–(11)), but using the T2w and Toff values that correspond to acknowledged transmission when an acknowledgment is sent in the second receive window (Table 8).

Table 8. States, variables and their values for LoRaWAN acknowledged transmission when the acknowledgment is sent in the second receive window.

State Number
7 8

Description
2nd receive window radio off

Duration
Variable
Trx2w Toff

Value (ms)
(Ttx min in Table 6) 337.8

Current Consumption

Variable

Value (mA)

I2w

38.0

Ioff

13.4

We next extend the model to compute Iavg_ACK for non-zero BER. We assume that bit errors are uncorrelated.
Let Ik denote the average current consumed by the end-device when it performs k retransmissions (the last one being successfully acknowledged), since the start of the procedures for the ﬁrst transmission attempt, until the end of the procedures for the k-th retransmission. Let Iact be the average current consumption due to activities related with transmitting a data message (including retransmissions), i.e., all states except the sleep interval. Iact can be computed as:

MAX_RETR

Iact = ∑ E[Ik]·pk

(19)

k=0

where E[Ik] denotes the expected current consumption of an end-device when it has performed k data message retransmissions, pk indicates the probability that the end-device performs k retransmissions of a message, and MAX_RETR denotes the maximum number of message retransmissions by an end-device. The latter is recommended as per the LoRaWAN speciﬁcation to be set to 7.
E[Ik] can be obtained by using the next equation:

E[ Ik ]

=

k
IOk K·TOk K + ∑
i=0
TOk K

IACK_TO·(TACK_TO − Trix2w) +

IAi ·TAi ·pA+IBi ·TBi ·pB+ICi ·TCi ·pC p A + pB + pC

k
+∑
i=1

TACK_TO − Trix2w

+

TAi ·pA+TBi ·pB+TCi ·pC p A + pB + pC

(20)

In the previous equation, IOi K and TOi K denote the average current consumption and average duration of the activities related with an i-th acknowledged data transmission attempt which is
error-free, and can be computed by using (15) and Tables 6–8. On the other hand, IACK_TO and TACK_TO correspond to the current consumption and the average duration of the ACK_TIMEOUT interval,
respectively. As per our measurements, IACK_TO has the same value as Iw1w, whereas ACK_TIMEOUT is a random variable uniformly distributed between 1 and 3 s. Variables Ixi , Txi and px, where x can be equal to A, B or C, correspond respectively to the average current consumption, duration, and
probability of unsuccessful acknowledged data message transmission events deﬁned as follows: A is
the event whereby the data message suffers a collision, or it does not suffer a collision but it suffers
at least one bit error, and it is equivalent in terms of current consumption and duration to the active
part (i.e., all states minus sleep) in unacknowledged transmission; B is the event whereby the data

Sensors 2017, 17, 2364

16 of 30

message is successfully received, but the acknowledgment, sent in the ﬁrst receive window, suffers at least one bit error; and C is the event whereby the data message is successfully received, but the acknowledgment sent in the second receive window, suffers at least one bit error (note that errors in downlink messages can be detected by means of the MIC ﬁeld). Events B and C are equivalent in terms of current consumption and duration to the active part of successful acknowledged transmission with the acknowledgment in the ﬁrst and in the second window, respectively. Probabilities pA, pB and pC are determined in Equations (20)–(22). Let lData and lAck denote the total size of the data and acknowledgment messages, respectively. Probabilities pA, pB and pC can then be obtained as follows:

pA = pcoll + (1 − pcoll)·(1 − (1 − b)lData )

(21)

pB = p1win·(1 − pA)·(1 − (1 − b)lAck ) = 0.5·(1 − pA)· 1 − (1 − b)lAck )

(22)

pC = p2win·(1 − pA)·(1 − (1 − b)lAck ) = 0.5·(1 − pA)·(1 − (1 − b)lAck )

(23)

We next determine pk. To this end, we ﬁrst derive the probability that an end-device will send an acknowledged message without performing any retransmissions, p0. Then, p0 can be computed as the probability that the data message will not suffer collisions, and neither the data message nor the
acknowledgment will suffer errors:

p0 = (1 − b)lData ·(1 − b)lAck ·(1 − pcoll)

(24)

Based on p0, pk can be found as the probability that only both message and acknowledgment transmissions that correspond to the k-th message retransmission are successful, as follows:

pk = (1 − p0)k·p0

(25)

Note that as per Equation (24), when the end-device reaches the maximum number of retransmissions, if the last data message retransmission is not successful, the corresponding current consumption is not added to Iact computation in Equation (19). Nevertheless, impact of this inaccuracy is negligible for MAX_RETR = 7 and for practical BER values (e.g., up to 10−3). Therefore, we opt to favor simplicity in our model.
On the other hand, for non-zero BER, Tact can be calculated as shown next:

MAX_RETR

Tact =

∑

E[Tact_k ]· pk

(26)

k=0

where E[Tact_k] can be determined by using the next equation:

k
∑ E[Tact_k] = TOk K + i=1

TACK_TO − Trix2w

+ TAi ·pA + TBi ·pB + TCi ·pC pA + pB + pC

(27)

Based on Equations (18)–(23), Iavg_ACK can be obtained by considering the active interval and the sleep interval over the notiﬁcation period, TNotif, as:

Iact·Tact + Isleep· Tnoti f − Tact

Iavg_ACK =

Tnoti f

(28)

Sensors 2017, 17, 2364

17 of 30

The previous equation can be used to calculate the theoretical lifetime (i.e., an upper bound on the actual lifetime) of a battery-operated end-device that performs acknowledged transmissions, denoted Tlifetime_ACK, on the basis of the battery capacity, Cbattery (expressed in mA·h), and Iavg_ACK, as shown next:

Tli f etime_ACK =

Cbattery Iavg_ACK

(29)

Finally, we model the energy cost of data delivery in acknowledged transmission, ECdelivery_ACK, which provides the energy consumed by the end-device per each delivered bit of data payload in acknowledged transmission, as shown next:

ECdelivery_ACK = Iavg_ACK ·V·Tnoti f E ldelivery_ACK

(30)

where E[ldelivery_unACK] indicates the expected amount of data successfully delivered by the end-device per data frame transmitted in acknowledged transmission.
In acknowledged transmission, the end-device will perform frame transmission retries, upon unsuccessful data frame transmission (either due to collisions or, if no collisions take place, due to bit errors). Therefore, E[ldelivery_ACK] is determined as the probability that the data message is successfully delivered in either the ﬁrst transmission attempt, or one of the retransmissions for the data message:

∑ E ldelivery_ACK

=

lPay·

MAX_RETR

((1

−

pcoll )·(1

−

(1

−

b)lData

)

+

k
pcoll) ·(1

−

pcoll )·(1

−

b)lData

(31)

k=0

It is worth adding that event A, as deﬁned above, captures the reasons that lead to absence of an acknowledgment in response to the data message sent by the end-device (i.e., collisions or bit errors). However, there is a further possible reason for absence of an acknowledgment requested by an uplink data message, which is duty-cycle limitations, since the gateway also needs to comply with regulations on this subject. Lack of an acknowledgment for this reason is likely when there is a sufﬁciently high amount of downlink trafﬁc (which may comprise acknowledgments to uplink trafﬁc from end-devices and actual downlink data messages to be sent to end-devices). Let pNoAckDutyCycle denote the probability of absence of an acknowledgment due to duty-cycle limitations. Impact of pNoAckDutyCycle on the end-device energy performance parameters considered in this paper can be modeled by replacing pcoll by pNoAckDutyCycle in Equations (21), (24) and (31). Therefore, the evaluation results on the impact of pcoll on performance that are presented in the next section can serve to understand how energy performance of the end-device depends on pNoAckDutyCycle as well.

5. Evaluation
In this section, we use the models derived in Section 4 in order to evaluate LoRaWAN end-device current consumption and lifetime, as well as the energy cost of data delivery. As an additional validation of the evaluation results, we have performed average current consumption measurements of up to 4-min duration (i.e., close to the maximum duration allowed by the power analyzer used), comprising several message transmissions from the end-device, for different conﬁgurations in terms of DR, notiﬁcation period, and acknowledged or unacknowledged transmission. We have found an almost exact match between the average measured current consumption and the one computed by using the analytical models. Note that this is an expected result, since the analytical models have been derived on the basis of measurement results.
The section is divided into three subsections, which focus on each one of the performance parameters mentioned, respectively. Unless explicitly mentioned otherwise, we assume the maximum-sized frame payload for each DR. As it will be shown, this is the most energy-efﬁcient approach per delivered bit, under the assumption that the network comprises a single end-device,

Sensors 2017, 17, 2364

18 of 30

and therefore the probability of collision is zero. Nevertheless, the approach of a single-byte payload, which is the least efﬁcient under the same conditions, is also evaluated in the section.

5.1. End-Device Current Consumption

5.1.1. Unacknowledged Transmission
We calculate the average current consumption of the end-device in unacknowledged transmission by using the values shown in Tables 5 and 6 and Equations (1)–(11). Figure 8 illustrates the obtained results, as a function of Tnotif and the DR selected. Note that the minimum value for Tnotif is given by the 1% duty-cycle limitation that applies for the mandatory, three-channel sub-band, and it depends on the DR.
As expected, the average current consumption decreases as TNotif increases, since then the sleep intervals have a greater duration, while the duration of the intervals related with communication remains constant. The average current consumption tends asymptotically to the sleep current as TNotif grows.
On the other hand, the average current consumption decreases with the DR, since the duration of transmit and receive intervals is inversely proportional to the bit rate of the DR used. For example, the highest relative difference in terms of current consumption between using DR0 and DR5 is a factor of 2.76, for a noSetnisﬁorcs 2a0t1i7o, 1n7, p23e64riod of 5 min. However, differences due to the DR used decreas18eowf 30ith TNotif.
Finally, noFtinealtlyh,ant,oteinthuatn, ainckunnoawcklneodwgleeddgedtratrnasnmsmisisssioonn,, enedn-de-dvieceviccuerrecnutrrceonnstumcoptniosnumisption is independenint doefptehndeeBntEoRf ,thaesBtEhRe, aesntdhe-deenvd-idceevwiceilwl iplleprefroforrmm aa ssiinnggleletratnrasmnsismsioinssaitotenmaptttoefmeapcth odfateaach data unit, regardulensits, roefgawrdhleestshoefrwiht eitshceroirtriescctolryrercetlcyerievceeidvebdybyththeenneettwwoorrkksesrevrevr.er.

3

DR0, No ACK

DR1, No ACK

2.5

DR2, No ACK

DR3, No ACK

DR4, No ACK

2

DR5, No ACK

DR6, No ACK

1.5

Average current consumption (mA)

1

0.5

0

0.1

1

10

100

1000

Notification period (min)

Figure 8. AFviegurarege8. cAuvrerreagnet ccuornresnut mcopnstuiomnptoiofntohfetheenedn-dd-deevviicee iinnuunancakcnkownolewdgleeddtgreandsmtrisasniosnm, aisssaion, as a function of TfuNnocttiifo, nanofdTNfootifr, adnidfffeorredniftfeDreRntsDeRttisnetgtisn.gs.
5.1.2. Acknowledged Transmission
5.1.2. Acknowledged Transmission
We next use the values shown in Tables 6–8 and Equations (18)–(28) to compute the average
We nexctururesnet cthonesuvmaplutieons osfhtohwe enndi-ndeTvaicbeliensa6ck–n8owanleddgEedqutraantisomnisssi(o1n8. )In–(o2r8d)ertoto ccoommpparuetreestuhlets average current consouf munpactkionnowolfedthgeedeanndd-adcekvnoicweleidngaedcktrnaonwsmliesdsigone,dFitgruarnes9mdiespsiicotsnt.hIenreosrudltes,ratsoacfoumncptioanreorfesults of
TNotif, for various DR settings, and for BER = 0. Since some of the curves of DR2 and DR3 overlap with
unacknowlethdogseedofaDnRd4,arceksunltoswfolreDdRg2eadndtrDanRs3mariesesxicolnud, eFdigfruormeF9igduerep9ic. ts the results, as a function of TNotif, for various DR sOevtteirnalgl,sw, ahenndBfEoRr=B0E, tRhe=av0e.raSgine ccuersreonmt ceonosfutmhpeticounrovfeasckonfoDwlRed2gaedndtraDnsRm3isosivoenrfloallpowwsith those of DR4, resualttesnfdoerncDyRw2ithanTNdotifDthRa3t isarsiemeilxacrltuodtheedunfraockmnoFwigleudgreed9t.ransmission one: it decreases with TNotif,
Overalilt, twenhdesnasBymERpto=tic0a,lltyhteo athveesrlaeegpeccuurrrernetn, atncdoint dsuecmreapsteisownitohftahcekDnRouwselde.dged transmission follows
A remarkable result, which is apparently counterintuitive when considering typical behavior of
a tendency waciktnhowTNleodtgifetdhaltiniks sliamyeirlaprrtoototchoelsuontahcerkntohawnleLdogReadWtArNan, sims itshseionfacotnteh:aitt dacekcnroewasleedsgwedith TNotif, it tends asymtrapntsomtiiscsaiolnlyytioeldths eloswleerepcucrruernrtecnotn,suamndptiiotndtehcarneathsaetsowf uitnhactkhneowDlRedguesdedtr.ansmission. Note
that in acknowledged transmission, the acknowledgment may be received by the end-device in the first or in the second received window. The latter leads to greater average current consumption than in unacknowledged transmission (since the acknowledgment has to be completely received, as opposed to the duration of the second window where no message is received by the end-device). However, the former involves significantly lower current consumption compared to unacknowledged transmission, since then neither a second receive window nor its previous wait time exist. This leads to an overall average current consumption in acknowledged transmission that

Sensors 2017, 17, 2364

19 of 30

A remarkable result, which is apparently counterintuitive when considering typical behavior of
acknowledged link layer protocols other than LoRaWAN, is the fact that acknowledged transmission
yields lower current consumption than that of unacknowledged transmission. Note that in
acknowledged transmission, the acknowledgment may be received by the end-device in the ﬁrst
or in the second received window. The latter leads to greater average current consumption than
in unacknowledged transmission (since the acknowledgment has to be completely received, as
opposed to the duration of the second window where no message is received by the end-device).
However, the former involves signiﬁcantly lower current consumption compared to unacknowledged
transmission, since then neither a second receive window nor its previous wait time exist. This leads
to an overall average current consumption in acknowledged transmission that is lower than the one in
unacknowledged transmission.
The maximum current consumption difference between unacknowledged and acknowledged
transmission is ~16%, which is found for DR6 and a notiﬁcation period of 0.5 min. For other DRs,
such maximum difference tends to decrease, down to ~3% for DR0, although such decrease is not
monotonical (e.g., the maximum difference for DR4 is lower than that for DR1). Recall that we are
consideringSaensforras 2m01e7, 1p7a, 2y36l4oad of the highest possible size for each DR, and the maximum f1r9aomf 3e0 payload size does not decrease proportionally to the bit rate as the DR decreases.
It is alscooninsitdeerreinsgtinagfrtaomceopnasyildoaedr tohfethceasheigohfesatcpkonsosiwblelesdizgemfoernetascbheDinRg, aanldwathyesmtraaxnimsmumittferadmien the ﬁrst
payload size does not decrease proportionally to the bit rate as the DR decreases.
receive windowIt (iis.eal.s,opi1nwtienre=sti1ngantodcopn2swidiner=th0e).caSsue cohf accoknnodwitlieodngms elenatsdbetiongthaelwlaoyws tersatnspmoisttseidbline tLhoe RaWAN end-device fciursrtrerencteicvoenwsuinmdopwtio(in.e.,Ipn1wtinha=t1caasned, tph2wein c=ur0r).enSut cchoncosnudmitipotnisonleaidn atockthneowlowleedsgt epdostsribalnesmission decreases byLouRpaWtoA4N5.e1n%d-d(feovricDe cRu5rraenntdcoannsuomtipﬁtcioant.ioInnthpaetrciaosde, othfe1cumrrienn)t,ccoonmsupmaprteiodntion tahckenuownalecdkgnedowledged one. Howevtrearn,ssmuicsshiodnedcercereaasseesisbyounplytos4ig5.n1%iﬁ(cfoarnDt Rfo5ranlodwa nnootitfiicﬁactiaotniopneripoedroifo1dms.in), compared to the
unacknowledged one. However, such decrease is only significant for low notification periods.
We also evWaleuaaltseo eimvapluaactetiomfptahcteoffrtahme ferapmaeyplaoyalodadsiszizeeoonn ccuurrrernetnctoncosunmsputmionp.tFioignu.reF1i0giullruest1ra0teisllustrates the averagetchue rarveenratgceocnusruremntpctoinosnumopf taionneonfda-ndeenvdi-cdeeviinceaicnkancoknwolweldedggeeddttrrannssmmisissisoino,nfo, rfoarsiangslien-gbylete-byte and also for a maanxdimalsuomfo-rsiazmedaxfirmaumme-spizaedylforaamde, wpahyilocahdp, wrohvicihdpertohveidleotwheelrowanerdatnhdethuepuppeprebr obouunndd oonn average current consauvemrapgteiocunrrfeonrt acognisvuemnpDtioRn, froersapegicvteivneDlyR., Trehsepedctiifvfeelrye.nTchee bdeiftfwereenecne tbheetwleoewn ethrealnodweurpapnedr bounds
upper bounds is significant for a low notification period (e.g., ~49% for a notification period of 1 min,
is signiﬁcanatnfdor~5a9%lowfornaotnioﬁtcifaictaitoionnppeerriioodd o(ef .g5 .,m~in4,9f%or fDoRr 5a annodtiDﬁRca0,tiroensppecetirvieoldy).oSfu1chmdiniff,earenndce~59% for a notiﬁcatiodnecpreearsieosdwiothf 5TNmotif,insi,ncfoe rsleDepR5cuarrnednt DthRen0b, erceosmpeescdtiovmeilnya)n.t,SauncdhitdailsfofedreecnrecaesedsewcirtehatshesDwR,ith TNotif, since sleep sciuncrerehnigthtehrebnitbreacteosmreedsudceomtheinraenletv,aanncedoift aacltsivoedceocmrmeausneicsawtiointhsttahtees DonR,asvienracgeehciugrhreenrt bit rates reduce the rceolnesvuamnpctieono.f active communication states on average current consumption.

3

DR6, No ACK

DR6, ACK

2.5

DR4, No ACK

DR4, ACK

DR1, No ACK

2

DR1, ACK

DR0, No ACK

DR0, ACK 1.5

Average current consumption (mA)

1

0.5

0

0.1

1

10

100

1000

Notification period (min)

Figure 9. CoFimguprear9i.sCoonmopfartihsoenaovf ethreagaveercaugrerceunrrtecnot ncosnusmumppttiionnooffthtehenedn-dde-vdiceevinicaeckinoawclkedngoewd alendd ged and unacknowleudnagcekdnotwralendsgmedistrsainosnm,isassioan,fausnacftuioncntioonf oTfNToNtoitfif,, aannddfofor rdidffiefrfeenrteDnRt DsetRtinsgest,tfionrgBsE,Rfo=r0BaEndR = 0 and pcoll = 0. DRp2co,llD= 0R. 3DRan2,dDRD3Ra5ndarDeRn5 oartesnhoot wshnowinn itnhteheﬁfgiguurree ffoorrththe esaskaekoef ilolufsitlrlautisotnracltairoitny.clarity.

Sensors 2017, 17, 2364 SensSoernss2o0rs172,01177,, 21376, 42364 100100
10 10

20 of 30 20 o2f030of 30
DDDDRRRR0505DDDDAAAARRRRCCCC0505KKKKAAAA,,,, CCCC11mmKKKK--aabb,,,,xxyy11mmttpp--eeaabbaaxxyyppyyttaapplleeooyyaaaappllyyooddaallaaooyyddaallooddaadd

Average current consumption (mA) Average current consumption (mA)

11

0.1 0.1

0.0100.0.0110.01

0.1 0.1

No1tNifo1ictaiftiicoantipoenrpioedr1i(o0md1i(0nm) in)

100100

10010000

FmDililmFdoRaugfiixagfusifsixtlumFdoremleriefuirriamtagfeeutistfxluniietul1mnoirurtrmm01agneesD-.0tnsstu-i.crRios,tmz1alinaDfze0tsCo-irCeed.cRosirodtltiontamzfysCBirmre.necfaiEpodrtltgmptaamyaRsirmran.,feipirr=tgfseayaoipossmr.r0,anoipfysBenoaaolErynoonpRlafdBooadEf=ayoptRdilhf0cntooeh=alailatendnh0c=edekaneai0npnndcn.coedko-dlnwdlanOp-=dceodclnkov-e0wledlnldi.v=ycleoOgeeiv0wcdeDni.edcgllaOReeyevtd0ndarDegalvarayRenavetndrgs0DreadmaeranRatgnDrisg0esamcdesRanuiiDnscor5smrcudsnReuair,oin5DrrrsanetresaRse,inrson5aecthantoasfso,nruhcwecsonaoaoussnwcnnhmtfssinuoaiuoupnnwinmmtnfcitnutoophptinnohfiettncinieTtooﬁtiNwfnnohigoogneiftutuiwfhwfr,riToegeaiifNttun1fohfhtoorT-idfbe,rrNy1f1oftatotot-hi-hfneb,rbreedyydtasthastniaeeffeankdfokdeseraraaefneknoondedrft

WWeenWneexextnteeevxvataleulvuaaatlteueaeetnnedde--ndddee-vvdiiecceveiaacveveearrvaaeggreaegccueurcrrureenrnrtetcncotoncnsousnumsmupmtpioptintoionfonfrofnorornnno-oznne--rzzoeerBrooEBRBEEiRnR aiinckancokwnolewwdlgleeedddggeedd trtarnanstrmsamnisisssmsioiiosnns,i,offonor,rBfBoEErRRBEvvRaalluvuaeelssuuuepsp uttoop 11to00−−31,30a,−3na,ndadnfodfrofrDorDRD0RR0an0adnandDdRDD5R.R5S5.i.nSSciniencfceoerffoDorrRDD5R,Rr55e,trrraeentrsamnissmmsiiiossnssisioonmnssamymaayy rerdeudrcueecdetuhtceheeDthDReR(Ds(esReeeS(seSeceetciSotienocn3ti.o33n..32.)32,.)3a,.n2ad)n,dfaonfrodtrhftoehrseathskaeeksoeafkoaef baoefbttaeetrbteecrottcmeorpmcaoprmaisrpoisanor,nifs,oofrnoD,rfRDo5rRwD5 Rew5ceowcnoesnicdsoeidnrsetirhdetehrseathmee pasaymlosaeamdpeasiypzleaoyaaldsotashdizaetsioazfseDtahRsa0tth.oaAftsDosfRhD0o.RwA0n.s AisnhsoFswihgonuwrienn1Fi1ni,gfFuoirgreua1rg1ei,v1fe1on,rfDaorgRai,vageinnvoeDnnR-zD,eaRro,naoBnEn-Roznei-rnzocerBreoEaRsBeEisnRecnirnedca-rsdeeeasvseicse ascftdroiuveecscrenareioorecnmnncrlrrDnndaesececscreeapsst-emieoonnmRagheiutdnldnnhsdteda5ascmeipesseset-lcesvcheeiiusdrsoipdsiuw,ezedeaismecntoepdesnlrlseviieosroirdnipt)diwnezeuaehc,wnctpd-eavuncaeimsidodfeset)inerttoanhc,nerrrprBdctavurecsavahottEfsieenrgnDhiitronenrorRcrtBeesrtanecaRaesnhmcEcenncgdnuD5eetopuRtetisehmtptRnhsirhemechcsecsdtrs5errnpeoiuiaeuileefnnoodnsotinrtoecamsinnusrsw-tornbrswideulmemopencderoeneamahsoentcw-rtvbs,si(nddneooupeticsedenesrmchunasiotrpreunev,inacnDotoetmtcisnretdprschhnsieofeRsauneepaetcrltnhomrtc0cnnreeethphfeeisuanpstoeoeipetmcbrtssrtetnhrrnneitiherwmfeoisaupioeocteo(ssibnthhtonrsusnrgnsiedwdememeoptinrctod(nerenenhchiouseetnrcﬁ.toeoumeDspdrrrsoFcnnrameenu.oRlaeetfonsaetoucnDsndTbr0umrssseameetusmoehRlmsiDn.earsscnoib0ssisNgseRporuesiacesmgsidnsfuter5ssosoiniseieirf,rootortuwsicfierdregutdnfsefnustehi.oinerdsectecrn.roFeifhl.ietradreetlTnfotemTa.niils.orshcfnnorthtFcif.odaa.eitwcDofiomTsrngessoNrnrRnchetectprdaes.hroDoraii5ghufeeatsNtensf,udRncaemeeeesgtrordsuinc5hsufettaiepttef,huroveaemsneatatiamdsefichnlsgatotoeptontehiecsenrseTowtfirafiBnwo.nltoaneNotoehroEcasfnroerwTfeorstnRaBwol.itehdelffehrr.aE,siigeaudrTiessscnRalnirahedeluvreat.gsscigapuevermtserniTirrnhraaeovevaogpsNelapnenuBtafoenhsiTnthitEoelBoofeaosNesncRdfmsBEsfonrot,ceiii,REBoofenzenosccRdflmEnetrivsnaueneeid,oRuatnserrcacneclivrnmtrasveududeeeaoesaenrrepaslisnwlvrsssBrtls,uteeeaeiEienoedlistsssRthnp,),

100100 10 10 11

DDDDDDRRRRRR000555DDDDDD,,,,,, RRRRRRBBBBBB000555EEEEEE,,,,,,RRRRRRBBBBBB======EEEEEE111111RRRRRR000000======⁻⁻⁻⁻⁻⁻³⁴⁵³⁴⁵111111000000⁻⁻⁻⁻⁻⁻³⁴⁵³⁴⁵

Current consumption (mA) Current consumption (mA)

0.1 0.1

0.010.01 11

10 10NotNifoictaiftiicoantipoenrpioedri(omdi(n1m)00in1)00

10010000

FiFgiguuFreirge1u11r1.e.I1Imm1.ppIamacctpt oaocfftBBoiiftt BEEirrtrrooErrrRRoarattReea((tBBeEE(RBR)E)oRon)ntohtnheetahaveveareavrgeaergaecguecrurcreurnrertnectnotcnocsonunsmusupmmtipoptntiiooonfntoohffetthehneedee-nddev-diceevviiicnceeiinn acakcknanocowkwnleloedwdggleeedddgttreradanntsrsmamniissmssiiooisnns,,ioaanss,aaafsfuuannfccuttinioocnntiooofnfToTNfNotTiof,tNiffoo,tifrf,ofdorirfdfdeifriffeefneretrenDntRtDDsReRtstsienettgttisinnaggnsdanfodr fpocorllpp=cco0olll.l==0.0.

Sensors 2017, 17, 2364 Sensors 2017, 17, 2364

21 of 30 21 of 30

FinaFlliyn, awlley,ewvaeluevataeluimatepaimctpoafcctoolflicsoiollnissionnstohne athveeraavgeeracguerrceunrtrecnotncsounmspumtiopntiofnaonf eande-ndde-vdiecev,icfeo,r DR0faonr dDDR0R5a,nadndDRfo5r, pacnoldl vfaolrupecsolluvpatluoe0s.3u(pFitgou0r.e31(2F)i.gAursee1x2p)e. cAtesde, xcpoellcitseido,nscoinllicsrieoansseitnhcereaavserathgee curreanvtercaognesucumrrpetniot ncoinnsuacmkpntoiownleindgaecdkntorawnlsemdgiesdsiotrna.nIsnmcirsesaiosnin. gInpccroellahsiansgapscolllighhatslya gslriegahttelyr rgerleaattievre imparcetlaotnivceuirmrepnatcctoonnsucmurpretinotncfoonrsuDmRp5ttihoannfoforrDDRR50t.hIannfafcotr, tDhRe0c.oInntrfiabcut,titohne tcooenntreirbguytioconntsoumenpetrigoyn of stactoenssruemlaptetdionwiothf sptraotecsesrseilnagteadndwwithaipt rtiomceesssinsgrealantdivwelyaitgrteimatesr fios rrDelaRt5iv(ewlyithgrsemataelrlefrotrraDnRsm5 i(twainthd receisvmeasltlaetretrdaunrsamtiiot nan) dthraencefiovre DstRat0e.dIunrﬂautieonnc)ethoafncofollrisDioRn0s. Idneflcureenacseesowf ciothlliTsiNoontsif,dseicnrceeasselesewpitchuTrrNeotnif,t becosminecsedsolemepincaunrtr.ent becomes dominant.

10

DR0, Pcoll=0.3

DR0, Pcoll=0.2

DR0, Pcoll=0.1

1

DR0, Pcoll=0 DR5, Pcoll=0.3

DR5, Pcoll=0.2

DR5, Pcoll=0.1

DR5, Pcoll=0

0.1

Average current consumption (mA)

0.01 1

10

100

1000

Notification period (min)

FigurFeig1u2r.e I1m2.pIamctpoafctpocofllpoconll othnethaevearvaegreagceurcruernretnctocnosnusmumptpiotinonofofthteheenendd-d-deevviciceeininaacckknnoowwlleeddggeedd transtmrainsssmioins,siaosna, afus nacftuionnctioofnToNfoTtifN,otfifo, rfodridffiefrfeernetnDt DRRsestettitninggssaannddfoforrBBEERR== 00..
5.2. E5n.2d.-EDnedv-iDceevLiicfeetLimifeetime
Leveraging the average current consumption results obtained in the previous section, we next cLaelcvuelraategitnhge tthheeoarveteircaalgleifceutirmreenotfcaobnastutemryp-toiponeraretesduletns do-bdteaviniceedbiynutshiengp(r1e2v)ioanuds s(2e9c)t.ioWne, wasesunmexet calcualabtaetttehreytchaepoarceittiycaolfl2if4e0t0immeAohf.a battery-operated end-device by using (12) and (29). We assume a battery caFpigaucirtey1o3f i2l4lu0s0trmatAesht.he end-device lifetime for BER = 0 as a function of TNotif, and the DR, in uFnigauckrneo1w3lieldlugsetdrattreasntshmeisesniodn-d. eLvoigciecalillfye,timthee feonrdB-dEeRvi=ce0liafsetaimfue nbcethioanvioofr TisNotthife, ainndvetrhsee DofRt,hien unacckunrorewnltedcognesdutmrapntsiomnisosnioenp. rLeosgenictaeldlyi,nthSeecetniodn-d5e.v1i.cAe ligfreetaimteer benehda-dveiovricies tlihfeetiinmveerisseoobftathineecduwrrietnht consuhimghpetiroTnNootnif eanpdreDseRn.teAd minaSxeimctuiomn 5v.a1l.uAe ogfre5a.9te6ryeenadrs-diesvoicbetaliinfeetdimweitihs oDbRta6inaendd wTNitohtif h=ig1h44e0r TmNiont.if and DInR.aAddmitiaoxnim, iutmcavnalube osfh5o.w96nyethaarst irseogbatradilneessd wofiththDe RD6RanedmTpNlootyife=d,14e4n0dm-dienv.icIne aldifedtiitmioen,tietncdasn be shaoswymnptthoatticraelglyartdole6s.s19ofytehaersD, Rwehmicphlocyaendb, enadc-hdieviecde liiffetthiementedn-ddesvaicseymispatolwticaaylslyslteoe6p.i1n9gy(eia.er.s, , whicThNoctiaf =n∞b)e. NacohteieavlseodthifathloeweenrdD-dResvliecaeditsoalolwwaeyrsensdle-edpeivnicge(li.fee.t,imTNe,otaifn=d t∞hi)s. eNffeoctteinaclsroeatsheas tasloTwNoetifr DRsdleeacrdeatoselso.wFoer enxadm-dpelve,icfeorlifTeNtoitmif =e,5amndint,heins de-fdfeecvticineclrifeeatsimeseavsaTluNeostiffdalelcbrealoswes.oFnoeryeexaar,mrpanleg,infogr TNotiffr=om5 m0.i2n6,teon0d.8-d3eyveiacresl(iffoertiDmRe0vaanludeDs Rfa5l,lrbeeslpoewctiovneelyy).eIafrT, Nraotinf ignicnrgeafsroesm, a0l.i2fe6ttimo 0e.o8f3syeevaerrsal(fyoeraDrsRis0 and pDoRss5i,brle.spFoercteivxaemlyp).leI,ffoTrNTotNifotiifn=cr6e0amseisn, anldifeTtNimotife= o3f60semveinr,almyuelatir-syeiasrploifsestimbles. bFeotrweexeanm2.p1l3e,anfodr TNotif3=.7660yemarisn, aanndd bTeNtwotief e=n346.505manind, 5m.5u2lytie-ayresa, rcalinfebteimacehsiebveetdw,ereensp2e.c1t3ivaenlyd. 3.76 years, and between 4.55 and 5W.5e2nyeexatrcso,mcapnarbeeeancdh-dieevveicde, lriefestpimecetirveesulyl.ts of unacknowledged and acknowledged transmission (Wseee nFeigxut rceom14p).arAesenexdp-dlaeinveicde ilnifeSteimctieonres5u.1l.t2s.,oafcuknnaocwklneodwgeldedtgraendsamnidssiaocnknfoolwlolwedsgaedtetnrdaennscmyisvseioryn (see Fsiimguilarer 1to4)t.hAe sunexacpklnaoinweldedigneSdecotnieo.nT5h.e1.2lo.,waecrkcnuorwrelnetdcgoendsutrmapntsimonisosfioanckfnoollwowledsgaedtentrdaennsmcyisvsieorny similyaireltdosthhieghuenraecnkdn-doewvliecedglifeedtimonee. S. iTmhielalrolywtoerSceuctriroenn5t.1c.o2n, tshuemmpatxioimnuomf aecnkdn-doewvliecde gliefedtimtraendsimffeirsesniocen yieldbsehtwigeheenruennadc-kdneovwicleedligfeetdimaned. SaicmkniloawrllyedtogeSdecttriaonnsm5.i1s.s2i,otnhiesm~1a6x%im, fuormDeRn5da-nddevaicneoltiiffiectaimtioendpifefreiorednocfe betw0e.e5nmuOinnn.aFtchokernooottwhheelrerdDhgRaensd,ds,auFncidhgumarcaekx1ni5mowsuhmloewddgsifetfedhreetrnimacnepstamecntidsossfitotohnediefsrc~arem1a6se%ep,,adfyoolwroaDndRtos5i~za3en%odnfoaernnDdoRt-id0fe.icvaitcieonlifpeteirmioed. of 0.5Inmoirnd.eFrotroootbhtearinDtRhse,rsauncghemofapxiomssuibmledeinffde-rdeenvciecetelnifdetsimtoedveaclrueeass,e1,-dboywtenantod~a3ls%o fmoarxDimRu0.m-sized pOanyltohaedotahreerchoannsdid,eFriegdurfeor15dsahtaowmsetshseagimespainct aocfktnhoewfrleadmgeedpatyrlaonasdmsisizseioonn. eTnhde-dcoevrriecseploifnedtiimnge. In orednedr-tdoevoibctealiinfetthimeersanargeedoefppicotesdsibinleFeignudr-ed1e5v,iacsealiffuenticmtieonvaolfuTeNso,tif1, f-obrydteifafenrdenatlDsoRmseatxtiinmgus,man-sdizfoedr payloBaEdR =ar0e. OconnlysiDdRer0eadndfoDr Rd5aataremsheoswsangiens thine faigckunreofworletdhgeesdakteroanf islmluisstsraiotino.n cTlahreityc.oIrmrepsapcot nofdtihneg end-device lifetimes are depicted in Figure 15, as a function of TNotif, for different DR settings, and

Sensors 2017, 17, 2364

22 of 30

for BER = 0. Only DR0 and DR5 are shown in the ﬁgure for the sake of illustration clarity. Impact of the paySelnoSseaonrdsso2rs0si12z70,e1177i,s,127n3,62o43t6i4ceable only when TNotif is low. For DR0 and TNotif = 5 min, end-devic2e2l2oi2ffe3o0fti3m0 e ranges from 0.27 up to 0.41 years (i.e., a ~52% relative difference), for the payload sizes considered. Foanford~D4t9hR%oprFua5foas)noprFyr~a.afogai4lDnnHtoyre~9sgdaRs4l%Dooed9c5fTwaRs)%ru.adosN5frHe)nirmorz.avosdteoeHniimefzn0wTdrioe=.ts,N2e0wToi7icv1.tnmsN2iecfeuoo7m=vortnpitpf,eni1uo=iacirnttpmsem,cio1u,caitptmiembe0monoaanl.p,4ifecb0pnde1atlf.o,4netc-royied1ntadofonemloe-yfnyanddvfrer,lae-efisyawdmbcrvrpa(eehieswiemcva.celee(hyiiponie.cf.,lelaeeemiopanTfy.t,elaaiNile~tmaTfodyois5etmaNil~ft2eosddoi5%tiemaiisrfo2zsdar%ieimelrasznosenrediwglilrazgaoneedene.tewlacsiegasFvdrnc.teffeoeierrstrFvearco.odfoearsmrmFDierseofdoaefsRmDi0ess0rf0wer.f.Rw1ee10es8a0nhr.x8hw1encteae8antodehnmnonc)te0,odeTTT0n.pf)2N0.No,NlT26To.oerft2to6NiNioyf,ft6tooiriet=hyftfiniyffoaetieci5e=hnrrnarspaecercma5ra(rasrspiyee.siTmea((nlaaeiioN.y,s.si.s,eeanleoeaebo.d.t,s,s,niaerfaebaedcsdb=nliear-eazreddcsue6ctelia-esiazlas0dvuevateuecesitimssvcoeivsdlveeceneiisicoeensfdllsenefpiidiledfeasfelersfipeiineetefdtfrifaenprdsmeeeetttcdrieransDeemee,.ttcdenaRee,.tc0ee,, end-deavnaidcnedthlutihfsueitstismitcsuecruvreranrletuncetcsoccnroasnunsmguepmtfpirotoniom,nb,e2bc.eo1cm7oemtoseds2o.d9mo0imnyaiennaat.rnsFt.o(Fri.oer.x,eax3ma3pm.4lep%,lefo,drfiofafreTarNeTontNifco=teif )6=,06am0nidmnifanrnoadmndD3RD.09R,00,to 4.44 yeeanredsn-dd(i-e.deve.i,cvaeicl1eif3el.it7fie8mt%iemvdeaivlfuafelurseernsacnraegn)egffoerorfrmDomR2.512.7.1t7ot2o.920.9y0eyaersar(si.e(i..,e3.,33.43%.4%difdfiefrfeenrecnec),ea),nadnfdrofrmom3.930.9t0ot4o.444.44
Nyeexyaterswar(sei.e(ei..v,eaa.,l1au3a1.73t8e.7%i8m%dpifdafiecfrfteeonrefcneBc)Eefo)RrfooDrnRDe5Rn. 5d. -device lifetime (Figure 16). Similarly to the observations made in SeNcetNixoetnxtw5ew.1e.e2v,eaevlnuaadlut-eadteimviipmcaepclaticftoeftoimfBEeBREmRoanyondeenecdnr-edda-edsveicvbeicyeliuflepitfiemttoiemoen(Fei(gFouigrrdueerer16o1)f.6)mS. iamSgiimnlairtllauyrdlyetoftotrhetDheR5 and foorbostbherseverarvtaiaontnigosensmofamdBaeEdeRinivnSaelScuetiecotsniocn5o.n15.s.21i,d.2ee, nreednd-dd.-edvIeimcveipcealicfeltitfioemtfiemBeEmRamyaoyndedecernecdare-sdaeseebvyibcyeupluipfteottiomonoeenieosrodloredwreerorfoffor DasilgRwn0ai,yﬁFasicsmltnnio-iafgsdaesmltantilonigthlfegtialeiinlmeteFyftngtyhiipi,iclidtnemenFifuraifwiieanieicelntdensicluadtgfteleairielnydlmusyeolte,talefiacwlylonermlyowese,srfdeoweoderoeewrf-eDsruenoddfaaesrRcwofDdneutlersfa5uav-RciooaendltDedirsl5ahncweoasRyenDedvtlanTad0uw-sRiantddy,Nctdhsad0u-safeeoydoye,-vntdTsilrsafefidylitNoi,-cvnefhmstreesoeiidhlettctietphlieptneifiedihiiemftnacmpieleernidecgtiaicfepinmceternrmeeregta(acgpionneeacrnemeeea.adftsdggn(aecse-ee-oop.dtsdsed,.(ffceg-seewooobesd..vlpB.ff,lygveiwciEbto.cvipoBlh,olycReicinEbtoencoTlhoalyRenvesNnleoTioaaoentfTntvelsNinhefu,dNtnaoetThtieoeslidir-tfu,Niitnimsdfdr-nhoesidddtenciiicseffr-neevocoifddvncctornireeeeioeccrfscnvnoaTrenieeTdiedsrdsNcnNae-leileTdsdioodssirtftfNi.e-eefeiealefdos=idvrtttsfi.=eeifiie.3ymcm=dvt0emI3ii.3emmce0ml0eIpip(emfmi(mFtelnaFioipt(fciigiFieatnnamtguiitnccgiuaoraedmtauenfrnltorpeedledB1efcynot7pE1lelpB1d)tc7=Rno.oc7Esll)od)0C=R.la.tol.sh3os0n=CCay)ole.,l3osmni0eoay)lsln.,ilnlipm3ifeoladsdeit)nnnipso-,toddhsdiittanomio-aecndmhsntvvaideaeiesclamcvvlaoyyaheimelacflayyaeaavnye a greatgerrgeariemteartpeiarmcitpmoapcnat ceotnoden-ndedne-vddi-ecdveeicvleiicfleeitfeliimtfiemetiemfofeorrfDoDrRRD55,R,a5as,saeesxxpepxepceteecdtdedffrroformmomththetheaeavavevreaergraaeggceeuccruurerrnrreetnnctotcncosonunsmusupmmtpiotpniotinon analysaisnaainnlyaSslyiessciitsnioiSnneSc5eti.co1tn.i2o5.n.15..21..2.

66

DRD0R, N0,oNAoCAKCK

55

DRD1R, N1,oNAoCAKCK DRD2R, N2,oNAoCAKCK

44

DRD3R, N3,oNAoCAKCK DRD4R, N4,oNAoCAKCK

DRD5R, N5,oNAoCAKCK

33

DRD6R, N6,oNAoCAKCK

Lifetime (years) Lifetime (years)

22

11

00 0.10.1

11

NoNtiofitcifaitciao1tn0io1pn0eprieordio(dm(imn)in) 100100

10010000

FigureF1ig3Fu.igrEeunrd1e3-d.13eE.vniEdcn-eddle-idfveeitcviemicleeifeilnitfiemutinemaiecnkinnuonuwanclkaencdkognweodlwedtlregadengdsemdtriastnrsasimonsnims, saiissosnaio,fnua,snacastiofaunnfuocntficoTtnNioonotiff ,oTaf NnTodtiNf,oftoiaf,rnaddnidfffoerfroernt DR setdtiinfdfgeifsrfe.enret nDtRDsRetsteinttgins.gs.

66

DRD6R, N6,oNAoCAKCK

55

DRD6R, A6,CAKCK

DRD4R, N4,oNAoCAKCK

44

DRD4R, A4,CAKCK DRD1R, N1,oNAoCAKCK

33

DRD1R, A1,CAKCK DRD0R, N0,oNAoCAKCK

22

DRD0R, A0,CAKCK

Lifetime (years) Lifetime (years)

11

00 0.10.1

11

NoNtiofitcifaitciao1tn0io1pn0eprieordio(dm(imn)in) 100100

10010000

FigureF1ig4Fu.igrEeunr1de4-.1dE4e.nvEdin-cddee-dvlieifcveeticilmeifeleitfiemintiemaicenkiancokawnckolnweodlwegdleegddegdaenaddnadunundnauacnckkanncokonwwollweeddleggdeegddetdrtartanrnasmnssmimssiisisossniioo, nas, aaassfauanffucuntincoctnitoioonfnofof TNotif, aTnNTodtiNf,oftaoif,nraddnfdioffrfeodrreifdnfeitfrfDeenrRet nDsteRDttRsinetsgteisnt,tgiBns,gEsBR,EB=RE0R= a0=na0dnadpncpdoclolpll =c=oll00=.. 0DD. RRD22R,,2DD, RDR3R3a3naadnndDdDRD5RRa5rearneonnt oostht osshwhoonwwinnnitnhinethtehe ﬁgure ffiogfruigtrheuerfeosrfaotkhreethoseafksiaellkuoefsotilrflauitlsliutorsnattricaoltnaiorcinltaycr.liatyri.ty.

SeSnesnosrosr2s 021071,71, 71,72, 3263464 Sensors 2017, 17, 2364

6

6

DR0 ACK, 1-byte payload

DR50 ACK, 1-byte payload

5

DR50 ACK, 1m-abxytpeapyaloyalodad

5

DR50 ACK, max payload

DR5 ACK, max payload

4

4

2323ofo3f 030 23 of 30

LifeLitfiemtie (myee(ayres)ars)

3 3

2 2

1 1

LifeLitfiemtie (myee(ayres)ars)

0

00.01

0.1

1

10

100

1000

0.01

0.1

N1otification period1(0min)

100

1000

Notification period (min)

Figure 15. Comparison of the end-device lifetime with 1-byte and maximum-sized payload data FmDiDmDFmRegiRRsueegssssureassssetreegaatettie1ggttn5iiee1ignn.n5iisggnn..aCssCcO..aaokOOccomnnkkmnnloynnpllwpyyooaDawwrlDDirResilldRR0seeoogdd00naneggnaadoeenndofddtddfrDtttahDDtrrRnheaaRR5sennem55ssanemmraaindesrrdsii-eesssdi-osshssdeiinohhoovew,oonnviacww,,inescaanneiasslniiilffaannieutfhteffnttiuuehhtmcinneemtﬁieccogffettiinuiiwggoowruuonnietrrfiheeftooThoffff1NrooTT-1otrrbtNN-hiybttfooehh,ttytiiffef,,eestoaeffssarookaanarrBekkdnEBBeeodREEfmooRRiffm=laliiux==lla0llisxuu,m00tipssr,,mttucapporrtumlccaailooomllttll=-iinoos==-0innscz00,ilez,,ccaadellaarnaadinndtrrpyddiiptta.fyyoyffa..oorlyorrdlaoddidafiifdffeffdreeedarrnteeaannttatt

6

6

DR0, BER=10⁻³

5

DDRR00,, BBEERR==1100⁻⁻⁴³

5

DDRR00,, BBEERR==1100⁻⁻⁵⁴

4

DDRR50,, BBEERR==1100⁻⁻³⁵

4

DDRR55,, BBEERR==1100⁻⁻⁴³

3

DDRR55,, BBEERR==1100⁻⁻⁵⁴

3

DR5, BER=10⁻⁵

2 2

1 1

0

01

10

100

1000

1

10 Notification period (min10) 0

1000

Notification period (min)

FiFgiugurere161.6I.mImppacatctofofBBEERRononenendd-d-deveivciecelifleifteimtime eininacakcnkonwowleldegdegdedtratrnasnmsmissisiosino,na,saas faufnucnticotnioonfoTfNToNtioft,if, fofFroirgdudifriffefre1er6ne.tnIDmt DRpRascesttetotintfigBnsgE,sRa,naodnndfeonfrodpr-cdpolcelolvl=i=c0e0..lifetime in acknowledged transmission, as a function of TNotif,
for different DR settings, and for pcoll = 0.

SSenensosrosrs2021071,71, 71,72, 3263464

2424oof f3030

Lifetime (years)

6

DR0, Pcoll=0.3

5

DR0, Pcoll=0.2

DR0, Pcoll=0.1

4

DR0, Pcoll=0 DR5, Pcoll=0.3

DR5, Pcoll=0.2

3

DR5, Pcoll=0.1

DR5, Pcoll=0

2

1

0

1

10

100

1000

Notification period (min)

FFigiguurere171.7.ImImppaactctoof fpcpoclollloonneenndd-d-deevviciceelilfiefetitmimeeininaackcknnoowwleldedggededtrtarnansmsmisissisoino,na, sasa afufnucntciotinonofoTf NToNtiofti,f, foforrddififfefreernent tDDRRsestettitninggs,sa, nanddfofrorBBEERR==00. .

55.3.3. .EEnneergrgyyCCooststoof fDDaatataDDeleilvivereyry
InInththisissusubbsescetcitoino,nw, we eveavlaulautaettehtehleaslat sctocnosnidseidreedrepdeprfeorrfmoramnacencpearpaamraemteer,tei.re,.,i.teh.,etehneeerngyercgoystcosft doaftaddaetlaivedreylifvoerrbyothfournbacokthnowunleadcgkendowanleddagcekdnoawnldedgaecdkntroawnlsemdigsesidont.rWanesmneixstsiaopnp.lyWEequnateixotnsa(p1p3)ly, (1E4q)u, (a3t0io)nasnd(1(33)1,) (t1o4d),et(e3r0m) iannedEC(3d1el)ivetroy_udneAtCerKmainnde EECCddeelliivveerryy__uAnACCKK, arensdpeEcCtivdeelivleyry._AWCKe, arsessupmecetiaveblayt.teWrye vaoslstaugmeeoaf 3b.a6tVte.ry voltage of 3.6 V.
FFigiguurree1188pprorovvidideessththeeeenneergrgyycocoststoof fddaatataddeleilviveeryryfoforrththeeuunnaackcknnoowwleleddggeeddaapppproroaacchh, ,aassaa fufunncctitoionnoof fTTNNoottiiff and the DR used, foor BBEERR == 0.
FFoorraaggiviveennDDRR, ,aannddfoforrBBEERR==00, ,ththeererelalatitviveeddififefererenncceeinineenneergrgyycocoststoof fddaatataddeelilviveeryrybbeetwtweeenn aacckknnoowwleleddggeeddaanndduunnaacckknnoowwleleddggeeddttrraannssmmiissssiioonn iisstthheessaammeeaassththeeddififeferreenncceeinintetermrmssoof fcucurrerennt t ccoonnsusummpptitoinonanaanlyazlyedzeidn SienctSioenct5io.1n.2.5H.1o.2w. eHveorw, seuvcehr,disffuecrhencdeififseorennlycesigisniﬁoncalynt sfoigrnloifwicannottiﬁfocratiloonw pneoritoifdicsa, taionndpthereiroedfos,reanitditshneoretfgoraepithiiscanlolyt gvriaspibhliecainllyFivgiusirbele16in, tFhigeruerfeo1re6,tthheerﬁegfuore tsheervfiegsufroersbeorvthes ufnoarcbkontohwulneadcgkendoawnldedagckednoawndledacgkendoawplperdogaecdheasp. proaches.
AAssshshoowwnnininFFigiguurere1188, ,foforrBBEERR==00, ,ththeeeenneerrggyyccoossttooffddaatataddeelilviveerryyfofollolowwssaalilnineeaarrtrtreennddaassaa fufunncctitoionnooffTTNNoottiiff. As it has bbeen pprreevviioouussllyy sshhoowwnn iinnFFiigguurreess88aanndd99,,aavveerraaggeeccuurrrreennttccoonnssuummppttioionn,, aannddththereerfeofroereneenregrygcyocnosnusmupmtpiotniobnebcoemcoems easyamsypmtoptitcoatlilcyalcloyncsotannstaanstaafsuancftuionnctoiofnTNooftiTf.NTotihf.eTrhefeorreef,oarse, TaNsotiTf Ninoticf rienacsreesa,stehse, etnhergeynecrognysucmonesdubmyetdhebeyntdh-edeevnidce-dinecvriecaesiensclrineaesaerslylwinietahrtlyimwe,itwhhtiilme teh,ewnhuimlebtehre onf udmelbiveerroefddbeiltivs erreemdabiints rceomnsatiannstc.oBnesctanuts.eBweceauasre wcoenasride ecroinsgidthereinmgatxhiemmuamxifmraummefpraamyleopadaysliozaed aslliozwe aeldlobwyeedacbhy DeaRc,hnDotRe,tnhoateththeastlothpeesolfoptheeocfutrhveecsuforvreDsRfo0r-DDRR20-iDs tRh2e issatmhe,ssaimncee, tshinecse therese DthRrese aDlloRws atlhloewsatmhe smamaxeimmuamximfruamefrpaamyelopaadysloizaed(si.iez.e, 5(i1.eb.,y5te1sb),ytthese),sltohpeeslfopr eDfRo3r DisRlo3wiselro, wsinerc,estinhcee mthaeximmauxmimfruammferapmayelopaadylsoizaedisizgereiastgere(ai.tee.r, 1(1i.5e.b, y11te5sb),yatnesd),ﬁannadllyfinthaellyslothpee sfloorpDeRfo4r, DDRR54,aDndR5DaRn6d isDtRh6e itshtehleowtheslto, wsienscte, sfoinrctehfeosretDheRsse tDhRe smtahxeimuaxmimfruammferapmayelopaadylsoiazde issizteheisltahregelastrgseusptpsourptpedorbteyd LboyRaLWoRAaNW(A24N2 (b2y4t2esb).yDteRs)0. DexRh0ibeitxshsilbiigthstslyligghretlaytegrrenateerrgyenceorsgtyofcodsattaofdedlaivtaerdyetlhivaenryDtRh1a,nduDeRt1o, tdhuee lotowtehrebliot wraetre boiftDraRt0e, owfhDicRh0l,ewadhsictho laeagdresatoeradgarteaamteersdsaagtae manedssaacgkenaonwdleadcgkmnoewntletrdagnmsmenit ttirmanes,masit wtiemllea,sarsecweievlel wasinrdeocewivdeuwraitniodno.wThdeusramtioenr.eaTshoenisnagmaepprelaiessotnointhgeacpopmlipeasrtisootnhoefctohme epnaerrisgoyncoosft tohfe deantaerdgeylicvoesrtyoof fdDatRa1daenlidveDryR2o.f TDhRe1eannedrgDyRc2o.stTohfedeanteargdyelcivoesrtyofodraDtaRd4eilsiv~e1ry9%foarnDdR~44i0s%~1g9r%eaatenrd th~a4n0%thgeroenaetefrotrhDanR5thaendonfeorfoDrRD6R, r5esapnedctfiovrelDy,Rf6o,rrtehsepleocwtivesetlyn,oftoiﬁr ctahteiolnowpersitondo, tainfidcadtieocnrepaeserisoddo, wannd tode~c1r%eafsoersbdoothwDnRto5 a~n1d%DfoRr6bforththDeRh5igahnedst DnoRt6iﬁfcoartiothnepheirgiohdesctonnositdifeicraedtio(nopteertihoadt tchoensseideifrfedren(ncoeste atrheantotthvesiseibdlieffienreFnigceusrear1e8)n.ot visible in Figure 18).
WWeenneexxtt eevvaaluate tthhee uuppppeerrbboouunnddononthteheenerngeyrgcyosctoosft doaftadadtealivdeerlyivbeyrycobnysicdoenrisnidgearifnrgamae frpaamyleoapdaysloizaed osfize1 obfy1teb. yRtee.suRltessualrtse asrheoswhnowin iFnigFuigreur1e91, 9a, laolnogngwwitihthtthhee oonneess obtained ffoorr aa mmaaxximimuumm-s-sizizeeddfrfarammeeppaayyloloaadd. .AAssititccaannbbeesseeeenn, ,foforraaggiviveennnnootitﬁifcicaatitoionnppeerrioioddaannddDDRR, ,ththeeeenneerrggyy cost per delivered payload bit for a 1-byte frame payload is roughly two orders of magnitude greater than the one obtained for a maximum-sized frame payload.

Sensors 2017, 17, 2364

25 of 30

Sensors 2017, 17, 2364 Sensors 2017, 17, 2364

25 of 30 25 of 30

costWpeer tdheelnivesrtueddypatyhleoaimd pbaitcftoorfan1o-bny-zteerforaBmEeRpoaynlothade iesnreoruggyhcloysttwoof odradtearsdoelfivmeargyn, iatsusduemgirnegataer mthaaxnimtWhuemeo-tnshiezeonedbsttapuinadyeydlotfahoder aifmomrpaaDxcitRmo0u,fmnan-osndiz-zetedhreofrasBamEmeRepoapnyaltyohlaoeda.ednesrigzye cfoosrt DofR5d,ataanddelciovnersyid, earsisnugmainlsgo a unmaacxkWinmoeuwtmhlee-dsnigzesedtdudapnyadythlaoecakdinmofpwoarlcetDdogRfe0dn, oadnna-dtzaetrmhoeeBsssEaaRmgeoentrpatanhyselmoeainsdesirosginyze(csofeosetr FoDifgRud5ra,etaa2nd0d)e.licAvoecnrksyni,doaewsrsilneudgmgieandlsgo trauanmnsaamcxkiinsmsoiuwomnlel-desaigzdeedsdtoapnaadyglraoecaakdtneorfowernleeDdrRggy0e,dcoadsntad,tbatyhmeatesslaesmaasgeteoptnraeaynolosrmdadeirsssoiifozenmfa(osgerneiDtuFRidg5eu,, radenud2e0tc)o.otnAhsceikdanedrodiwnitglieodanglaselod euntnrearangcyskmncooiswnssilouendmglpeetadidoasnntoodfaraegctkrrenaanotswemrleeisdnsgeioregndys,dciaontsatc,ombmyepsaastarligeseaosnttrwoanniteshmotrihsdeseiruonnoaf(cmskeanegoFnwiigtlueuddrgeee,2dd0u)a.epptAorcotkhanecohaw.dOdlenidtitgohenedal ottrehanenersrmghyaisncsdoio,nnBsuElemRapdhtsaiotsonaaogfgrrreeeaatrtteaernr siemmnepisrasgciyot ncoson,sitDn, bRcyo5matthplaeanarissotononnDweRoit0rh,dtsehirneocufenmtahacegknnfoiotrwumdleeerd, dgtreuadensatompptihtrseoa(aacdnhdd.iOtmionantyahle reeontrteharnegrsymhciaotn)ndsdu,amBtaEpmRtioehsnassaogfaersegtrareatanateshmr iigimshspeiorancbsti,toirnnactDeo,Rml5epaatdhriiansnognotonwliDothwRt0eh,reseiunnnecaregctkyhnecoofwnoslreumdmegrpedttiroaannp,spmwrohiatiscchh(a. mnOdankmtehsaey roertterhtaernarsnhmsaminssidti),ondBsaE,tRaanhmdaestshsaeaiggrreresealataettreadihmoigpvhearechrt eobanidt ,DreaRnte5e,rtlgehyaa-dneixnopgnentDosiRlvo0ew,. seirnecenetrhgeyfocormnseurmtrpatniosnm, iwtsh(iacnhdmmakaeys rreetrtraWannsesmmnietis)xstdioafnotacsu,masneodsnsathgheeoiswr aretcloaalthleiisdgiohonevsrerbihniteflarudaet,nee,cneleeratghdyein-eegxnpteoergnloyswivceeor.stenoefrgdyatcaodnesulivmeprytio(nse,ewFhiigcuhrme a2k1)e.s ArestreaxnpWsemcetiesndsei,oxcntosfl,oliacsnuiodsntoshneinihrcorreewlaastceeodtllhiosevioeenrnhseeriagndyf,lureeenqneucrgeiryet-hdeexppeeenrnesdrigevyleiv. ceorsetdopf adyalotaaddebliitv.eIrny a(cskeenoFwigluedrege2d1). trAanssmeWxipessenicoetxnetd,ft,ohcciuossleloifsfnieohcntoswisinceomclrlpeisahisoaensistzhienedfl,eusneinenrccgeeytrheretereqanuneisrrgmeydiscsopiseotrnosdf dealarietvaendreeeedldivepedray.yF(lsooearedeFxibgaimut.rpeInl2e1,a)f.cokArnsDoewRxp5lee, dctthgeeedd, ecntorelarlingsysiomcnoissssitnioocnfre,datahsteiasthdefeefleeicvnteeirrsygeyimnrepaqchukainsrieozdwedple,edsrgindecedelivtrreeatrnreasdmnpsimassyiilsoosnaiodfnobsriatT.rneIontinf a=ece1kdnmeodiw.nFlieondrcgreeexdaasmtersapnblesy,mf6oi0sr%siDowRn,5ht,ehtnihse peceoflflneiecnrtcgiryseeacmsoespsthofarfosdimzaetda0,.d1seintloicvee0rr.3ey,triwannhasicmlkeinsiosniwounlensdaagcrkeednnotewreadlneesddmg.eiFsdsoirmoenoxdfaomer, pTtlhneoet,iffe=onr1eDrmgRyi5n,citonhscetreepnaeserergsdybeylciov6se0tr%oedfwdbahitetan indpcecrloiellvaiesnreycsriebnayase1cks2n.8for%owm.led0g.1edtotra0n.3sm, wishsiiolen fionr uTnnoaticfk=n1owmliendignecrdeamseosdbey, 6t0h%e ewnheerngypcoclol isntcrpeearsedseflriovmere0d.1 tboit 0i.n3,crwehasileesinbyu1n2a.c8k%n.owledged mode, the energy cost per delivered bit increases by 12.8%.

6

6

DR0

5

DRD1R0

5

DRD2R1

4

DRD3R2

4

DRD4R-3DR6

3

DR4-DR6

3

EnEenrgerygcyocstos(tµ(J/µJbi/tb)it)

2 2

1 1

0 00 0

200 200

400 400

600

800

1000

Notif6ic0a0tion period80(0min) 1000

Notification period (min)

1200 1200

1400 1400

Figure 18. Energy cost of data delivery as a function of TNotif, for different DR settings, and for BFEFiRgigu=urer0e1a8n1.8dE. pnEceonlrl eg=ry0g.cyoRscetososutfltdosafftoadradDteaRliv4de,erDlyivRae5sryaanfadusnDcatRifo6unonovcfteirTolNnapotoiiff,nfTothNreodtiff,iifgffeourrreend.tifDfeRresnettiDngRs,saenttdinfgosr,BaEnRd=fo0r aBnEdRpc=ol0l =an0d. Rpecosllu=lt0s. fRoersDuRlts4,foDrRD5Ra4n,dDDRR56aonvdeDrlRap6 ionvtehrleaﬁpgiunrteh.e figure.

EnEenrgerygcyocstos(tµ(J/µJbi/tb)it)

1000 1000 100 100 10 10 1 1 0.1 0.1
0.01 0.001.01 0.01

0.1 0.1

1

10

100

Not1ification p1e0riod (mi1n0)0

Notification period (min)

1000 1000

10000 10000

DR0, 1-byte payload DRD1R,01,-1b-ybteytpeapyaloyalodad DRD2R,11,-1b-ybteytpeapyaloyalodad DRD3R,21,-1b-ybteytpeapyaloyalodad DRD5R,31,-1b-ybteytpeapyaloyalodad DRD6R,51,-1b-ybteytpeapyaloyalodad DRD0R,6m, 1ax-bpyateylopaadyload DRD1R,0m, maxapxapyaloyalodad DRD2R,1m, maxapxapyaloyalodad DRD3R,2m, maxapxapyaloyalodad DRD5R,3m, maxapxapyaloyalodad DRD6R,5m, maxapxapyaloyalodad
DR6, max payload

Figure 19. Energy cost of data delivery as a function of TNotif, for different DR settings, BER = 0, pcoll = 0, Faignudrfeor119-.bEynteerpgayylcooasdt aonf ddmataxdimeluivmer-syizaesdapafuynlocatidonthaotf cToNrorteif,spfoornddsiftfoereeancthDDRR.settings, BER = 0, pcoFlli=gu0r, ean1d9.foErn1e-rbgyytecposatyloofaddaatnaddmelaivxeimryuams-saizfeudncptaioynloaodf TthNaottif,coforrredspifofenrdesnttoDeRachseDttiRn.gs, BER = 0,
pcoll = 0, and for 1-byte payload and maximum-sized payload that corresponds to each DR.

SeSnesnosrosrs2021071,71, 71,72, 3263464 Sensors 2017, 17, 2364

2626ofo3f 030 26 of 30

EnEenregrygcyocsots(tµ(Jµ/Jb/itbi)t)

100 100
10 10
1 1 0.1 0.1 1
1

10

100

1000

NN1o0ottiiffiiccaattiioonn ppeerriioodd1(0(mm0 iinn))

1000

NNoo AACCKK,, DDRR00,, BBEERR==1100⁻⁻³³ NNoo AACCKK,, DDRR00,, BBEERR==1100⁻⁻⁴⁴ NNoo AACCKK,, DDRR55,, BBEERR==1100⁻⁻³³ No ACK, DR5, BER=10⁻⁴ No ACK, DR5, BER=10⁻⁴ ACK, DR0, BER=10⁻³ ACK, DR0, BER=10⁻³ ACK, DR0, BER=10⁻⁴ ACK, DR0, BER=10⁻⁴ AACCKK,, DDRR55,, BBEERR==1100⁻⁻³³ AACCKK,, DDRR55,, BBEERR==1100⁻⁻⁴⁴

uFuFinFuinggianauguccaurkrkceernkneono22wow020w.0.lle.eIlIddemmdgIgmppegeadadepccdaatatcnanotodndffdoaaBfBcacEkEkBcnRknREnooRwoowownnolleenldtedthhdggteehegedeedeednntetrretenaarrrenanggrnssyygmmsymcciiososcissssosiisttosoitonnoon,f,off,ffododfordraartpatpaacptcooaclllldod=l=dlee0le=0lii,l,vvi0aavee,nnreraydydrny,,fdf,oaoaarfsrsosDDraaaRRDff00fuRuuanan0nnnccactdtdnitioioDdoDnnnRRDoo55Rof.f.f5T.TTNNNoottoiiftf,,if,ffoofrrorbbobotothhth

EnEenregrygcyocsots(tµ(Jµ/Jb/itbi)t)

100 100
1100 11
0.1 0.1 1
1

10

100

10

100

NNoottiiffiiccaattiioonn ppeerriioodd ((mmiinn))

1000 1000

AAACCCKKK,,, DDDRRR000,,, PPPcccooollllll===000...332 AACCKK,, DDRR00,, PPccoollll==00..21 ANCoKA, CDKR,0D, RP0co, lPl=c0o.l1l=0.3 NNNAANNAAACCoooCCCooKKKKKAAAAA,,,,,CCCCCDDDDDKKKKKRRRRR,,,,,55555DDDDD,,,,,RRRRRPPPPP00000ccccc,,,oo,,oooPPPllPPllllllllccc==cc===ooo00oo000lll..ll...lll32ll321=====00000.....32121 ANCoKA, CDKR,5D, RP5co, lPl=c0o.l1l=0.3 NNoo AACCKK,, DDRR55,, PPccoollll==00..32 NNoo AACCKK,, DDRR55,, PPccoollll==00..21 No ACK, DR5, Pcoll=0.1

FuFiFuingginaugucaurrkceerkneno22ow121w.1.l.elIIdemmdIgmppgeadaepcdcaattcanotondffdoafppaccckcpoollklncl onoololownnwolnettlhedhdteeghgeeeeednndeteerntrraregganryyngsmsyccmoiocsissosttissoitooonffno, ,ffddofadaorttraaBatBEadEdRdeRel=leii=vlv0ieve,0rrea,yyrna,,ynd,adafsasofsoraaraDDffRufuuR0nnn0ccacttnaitionoidonndnDDooRofRf5f5.TTT.NNNoottoiifft,,if,ffoofrrorbbobotothhth unacknowledged and acknowledged transmission, for BER = 0, and for DR0 and DR5.
ceacrceacreaoencaoceabincttcntsocnncdsidsrrettetcsad-a-bsbsertdcpdnFpnF-seseseadepFeiseeistsnnpnpvmrcvrmerceinaaoraipovrribdcdioclinoalmmisrlseeldeetceyltossyssolsoleplepmic,ity,iiocosclovpouvp,uwwioonincevmepewtestllseoerseerr,esr,e)e)dpfeedlfiraraao,aooddeufsbsnabnrarnaoadtmnymabysaabsasrselaminbl)indtyttytatlhatihabyzhzhtaniaaciecaeneynzeepepksikcnearrpnapnkaatateepnnhnhroanronassupoduodnedwuedwuoxdmrexmedlwlrolndiltnditeneemembbxdunisloisdsodseesieeeuaifsmafmgcgcdrsrettluduLedcLeigtibaooduosLodisoioeeotvsvnsfnsfRiodRrftiotistdrtRdra[pa[pdhnohtaa7t7WiWiaraeahifnnenn]]avW[y.y.esgsgp7AinAiilUmlmUmmd]oAoasitNt.NmnmihaynhaipipNnssddedldeUapasignosnesceicieaneaeneosobrtbtrtncntdetihdnniiwototwotettetehsehsswfsnrfobr,o,roegegepsfipnronsrcstcyn,ytkapkaseareeaheney,ky,rctarcteccrcewrwlor,wloywgsoaooiotisweselweorynoanahohttdrdrdrdddehacoeicoko.k.eroidrioerf(ft(tedeTkbnarTibsaiaao(eo.tnehdnechcabnnhmohdomoediceneTstsalofalidh,le,hltetvoevileiahhsatssltseninntihishusivouiohmsoeasoeaeeerisirsur,ngroongn,e,gegcecsestrnessmemnayh,nayssrcmtnmtenmeeaegrearrmcrcagsasynabagbeegoosnsenyyeansyeaynanbcsssytgegsmomosemmorcacrueueancoogcogmio)io)mcnmcssscsesydudsutussstsco)eieiiemrieurmpzcdpozsdod.l.loreieeeneeeniA.zeAssrdlrdioedioets(nA(snsdndiindibsbsonponieseuyuynnatcanetbcsllhmhimliulryavauvuta(ememmnhniiedidedannneemerreeeinAiiAgcengennnnssleldediesleAgsluggtnvtosoararhhdbseelgbhigghigtaotaatrriihyiaeyasestntehtgtgadgyaet dwotaitdwotaitnhrnhrtAttatasotutuaatihcrhteihcietcftetrnenarnlltflheetheouimteuimetnsucsnrnoromhrdmedmetsatgptegphthhnahmeaelapdtitait,aetseletsrslstssthnhinrtarstsslslhDtoaDgteoideonpidpshhoponeayai,Rstea,Reaeneoenhsdmdricericcrmnnnetsextseo(o(uoimmuimniinpnisiAnnAnf(nfnasasefieeefeecsescclnlecillertrcssoeuiosoellwgrtgrctostusushrnehmreelyatayntaadoauddardadrgggntenaria,dis,ciceenkentdsntmnstntotoi.o.oa.mg,hmghnsusnnIotaemeItmegIntesmisinnhrvnhrssud,ueeeeifideseersbsrsxamtexmtfierfiesrsroenacptocnaptaigahieAtrercnreocneeoen,naedautdttcntoCcnt,sr,sawsnswsthtfdmtmKtseoeotsttatetaootehldihdivmh_vterimtimrsraeeseeseTeasek,knnims,s,rsenresI,ea,iuaiuarMrsosooxoanAaemdAemmdimmnpnfnugondgEeCeCsoseodtbnandbacicO)hK)wcKsuurertrsertstedted_rUen)i_rnioehihissaTaltoTlmtdfotuoieTuhesssInrIfersfessoesMe)eoMoonstsstrsntfsafhtiutrur,oe,sshEohEoetaaegerageutaafreOfenOmgnenhgngnhlngttsmyoesUeeeUhlyedhlhdumymxyarxrecepTslccTgpgdpwoywiiiohpt)mpy)mszyesensnosirseicrpcilistetioesiosfptac,stchouhrofseusepopwroeoensmnmsdmdgmntorntorapaihheearsetagrusegmuoeeerhtdeuttdutnendceircittometomhetleaheletishsoitosnomnnrmnroioiesaeagzalagzlandaatedanpdadepdyleylhgraarc,t,etgtetgctlscoicescoiwwlohonnheouieoffntpvpiefrifrnoirnstreteteeeteeeahhsehehstrtrtrrearatcuhtwuheenee2hcrayacmamGdamdameahhenonnnnm,ntrneerehtegutuwansasroksrodedtaytmesmcmescuhs.hhtactatcttsttmecrOebhiruebhgoiugoasaonaereeeregesrbnenednencdraraienenirnosinssecetcsGseromeiomenuheyleylsairiferftetemvoviigs(2witga2wtssGwshteGfehte·yoyser,sre,orstoraataithai2dhwworhtrorctawGcnanikeakoncoenidih,shsmn.nimn.hnrnmtwtmeuecoOsc(hOs(shreirewrrmwrhuitnuieesniesasnetasenmschhmssahnsiaGlGralsagitiseitsiuedloehosgcehgceoeididiDnh,tdanheesseessoahieiRdnness iissthaa·e·ee22tGGo,,twwalhhaeemrreeoauaniisst ttohhfeeetntooettraagllyaammcooonuusnuntmt ooeffdeennineerreggayychccootrnnassnuusmmmeeidsdsiiionnneeaaactcthhemttrrapannt.ssmNmoiisstsseiioothnnaaatttGtteemims ppptrt..oNNpooorttteeiotthhnaaatlt GtGoiitsshe phaphapmepereronaopapepdepdrrsrooeooesgxrrxrrayststiigim.im.oocenoTnaTassatahtihetezlleeddeortrt,foeoebbiffd.yyooettahhr.r((,tee3e3eal,,22pmdma))tty::ehheel+eesisvsslaeheaeegrngnaydeeeeE,rruCswgsgniidyyzzhdeeeleei,c,vcrreooeiir.t.ssyeehltth..≈e,e,aoo··lddlpfpfaaeadlyy·spdedec+a+2naayrG==tiotllbahahtee=eaeaddddsd,,··aetewcwh·lloieihehvv·nk· ·eeeetd(rorrllripepeyyttaaayiyol+llhuhuneselaahnndisdezadddcdde)eeaeeorrn==n=nfobottthhthteαeeeee·sas··epmdldkttpph·heelea··preesyssaocycsxtrtraooiiigbmbttaeaeeallddhtsseeiicdaczzoodeebnneyodordsffi(i.tt3ititT2ohoh)nhnee:sesmmreccefeaaossnnsrs((a3ea3,gb2gb2(t)3ee)eeh2e)

Sensors 2017, 17, 2364 Sensors 2017, 17, 2364

27 of 30 27 of 30

where α is a constant expressed in Joules, that can be computed by using (33), and k is a constant

expressed in bit−1, which depends on the transmission bit rate and on the total message rate offered

wetxohpterhreeessnαeeditswinaobrckiot.n−s1t,awnht iecxhpdreepsseenddsinonJotuhleestr,atnhsamt icsasniobnebcitormatpeuatnedd

by using (33), and k is a constant on the total message rate offered to

the network.

=· ·

(33)

Note

that

the

model

presented

cannot α

=acac·uekr·alhteeadly

capture

the

DR

decrease

mechanism(3f3o)r

retransmissions (see Section 3.3.2), when used, since Aloha assumes all packet transmissions have

the sNamoteedtuhraattitohne. Nmeovdeerlthperlesse,niteadllocwansntotqaucacluitraatitveelylyccaappttuurree btheehaDvRiordoefctrheeaseenemrgeychcaonstisomf dfaotra

rdeetrlaivnesrmyisasioanfsu(nsceteioSnecotifopna3c.k3e.2t)s, iwzeh.eAnsushedo,wsninicne AFilgouhraea2s2s,uimmepsaacltl opfacpkaeytltoraadnssmiziessoionntshheaevneetrhgey

scaomstepdeurrdateiloivne. rNedevbeirttdhelpeesns,dist oalnlotwhes tvoalquueaoliftakt.ivAellyccuarpvteusrefoblleohwavaio“rUo”f tshheaepneewrgiythcoasnt opf tdimatal

dpealyivloeraydassizaefuthnactimoninoifmpiazceksethseizeen. eArsgyshcoowstnpienrFdigeulirvee2re2d, imbipt.aTcthoef“pUa”ylsohaadpseizoefotnhethceuervnersgcyancobste

peexrpdlaeilniveder,eodnbtiht edeopneenhdasnodn, tbhyetvhaelufaecotfthk.aAt vllecruyrlvaersgefomlloewssaag“eUs ”wsihllalpeeadwtiothhainghopentiemrgayl pcaoysltopaedr

sdizeelivthearetdmbinitimdiuzesttohea ehniegrhgynucomstbpererodf ecloivlleisreiodnbs.it.OTnheth“eUo”thsherapheaonfdt,hme ceussravgeesscawnitbhe vexerpylasinmeadl,l

opnaythloeaodnwe hilal nalds,oblyeatdhetofahctigthaetnveerrgyylcaorgstepmeresdsealgiveesrwedillbliet,abdetcoauhsigehwehnielergtyheconsutmpebrerdoelfivcoerlleidsiobnits

dwuielltobea rheilgahtivneulmy bloewr o, ftchoelleisnieorngsy. Oconsthwe iollthbeer hrealnadti,vme etsosaageloswwiatmh vouernyt somf adllelpivayerloedadbwitsil.l Aalssok

lienacdretoasheisg,himenpearcgtyocfocsot lpliesriodneslivbeerceodmbeist, dbeocmauinsaenwt hainledththeenpuamybloeardofscizoellitshioant smwinililmbeizreeslatthiveeelynelorgwy,

tchoestenpeerrgydecloivstewreidll biet rdeelactrievaesetos.aNloowteatmhaotufnotrosfudfefilcivieenrteldy bloitws.,Aosr ksuinfcfirceiaesnetsly, imhipgahc,tkofvcaolulleisi,otnhse

boepctoimaelspdaoymloiandanstizaenfdaltlhseopuat yolfotahde sriezgeiothnaotfmvianlimd ipzaeyslothaedesnizeergs.yFcoorsetxpaemr pdleel,ivfoereadhbigithdeencroeuagshesk.

N(eo.gte., tkha=t0f.o1r),stuhfeﬁccioernrtelsyploonwd,ionrgseunfﬁercgieynctloysthpigehr,dkevliavleureesd, tbhiet ocuprtivme ainl pFaiygluoraed2s2izies faalflusnocutitoonf tthhaet

rgergoiownsosftevaadliidlypwayitlhoapdasyilzoeasd. Fsoizree.xample, for a high enough k (e.g., k = 0.1), the corresponding energy

cost per delivered bit curve in Figure 22 is a function that grows steadily with payload size.

1

Energy cost (J/bit)

0.1

0.01

0.001 1

k=0.1

k=0.05

k=0.01

10
Payload size (bytes)

k=0.003 100

FFiigguurree2222.. IImmppaacctt ooff mmeessssaaggee ppaayyllooaadd,, llppaayy,, oonn tthhee eenneerrggyy ccoosstt ooff ddaattaa ddeelliivveerryy,, aassssuummiinngg aaddeennssee LLooRRaaWWAANNnneetwtwoorrkk, ,fofor,r,αα==00.4.4JJaannddDDRR==55..
66.. CCoonncclluussiioonnss IInn tthhiissppaappeerr,,wweehhaavveemmooddeelleeddtthheeeenneerrggyyccoonnssuummppttiioonn ooff aaCCllaassss AALLooRRaaWWAANNeenndd--ddeevviiccee
ttrraannssmmiittttiinnggddaattaammeessssaaggeessppeerriiooddiiccaallllyy,,ccoonnssiiddeerriinnggiimmppaaccttooffuunnaacckknnoowwlleeddggeeddaannddaacckknnoowwlleeddggeedd ttrraannssmmiissssiioonn,, DDRRss,, ffrraammee ppaayyllooaadd ssiizzee aanndd BBEERR.. PPeerrffoorrmmaannccee ppaarraammeetteerrss hhaavvee bbeeeenn eenndd--ddeevviiccee aavveerraaggeeccuurrrreennttccoonnssuummppttiioonn aanndd lliiffeettiimmee,, aanndd eenneerrggyy ccoosstt ooffddaattaaddeelliivveerryy..TThheemmooddeellsshhaavveebbeeeenn ddeevveellooppeeddbbaasseeddoonnmmeeaassuurreemmeennttssppeerrffoorrmmeeddoonnpprreevvaalelennttLLooRRaaWWAANNhhaardrdwwaarer.e.
FFoorr BBEERR == 00,, aacckknnoowwlleeddggeedd ttrraannssmmiissssiioonn rreedduucceess LLooRRaaWWAANN eenndd--ddeevviiccee aavveerraaggee ccuurrrreenntt ccoonnssuummppttiioonn.. TThhiiss hhaappppeennss bbeeccaauussee aann aacckknnoowwlleeddggmmeenntt mmaayy bbee sseenntt iinn tthhee ﬁfirrsstt rreecceeiivvee wwiinnddooww,, wwhheerreeaass uunnaacckknnoowwlleeddggeeddtrtarnansmsmisissisoinoninvinovlvoelvsetswotwreocerievceeiwviendwoiwnds oawnds aalnadrgear alavregreargeavcuerrraegnet ccuornrseunmt cpotniosnumthpatniona tthraannsamtirsasniosnmiascskionnowaclkedngomwleendtgimnetnhteinfitrhste ﬁrercsetirveecewiviendwoiwnd. oNwo.teNothteatththate tqhueaqnutiatanttiivtaetivdeiffdeirfefenrceencbeetbweteweneeneneenregrygycocnosnusmumptpiotinoninin aacckknnoowwlleeddggeedd aanndd uunnaacckknnoowwlleeddggeedd

Sensors 2017, 17, 2364

28 of 30

transmission for BER = 0 may be platform-speciﬁc. In fact, in contrast with the behavior observed with the platform used in this work, the end-device hardware platform might stay in a low consumption mode (e.g., such as the sleep state) during the interval between the ﬁrst and the second receive windows. On the other hand, for a non-negligible BER, acknowledged transmission leads to greater current consumption than unacknowledged transmission, due to message retries.
For a notiﬁcation period of 5 min, DR5 leads to a current consumption lower than that of DR0 by a maximum factor of 2.8, whereas a 1-byte frame payload size reduces current consumption by up to a maximum factor of 1.59. For the same notiﬁcation period, using DR6 (which is not mandatory as per the LoRaWAN speciﬁcation), current consumption decreases by a factor of 3.18, compared to using DR0. Non-zero BER up to 10−3 may increase current consumption by up to one order of magnitude in acknowledged transmission. Current consumption differences due to the settings considered tend to decrease with the notiﬁcation period, since sleep current consumption then becomes dominant.
An end-device running on a 2400 mAh battery and sending one message every 5 min can achieve a 1-year lifetime. As the notiﬁcation period increases, the theoretical end-device lifetime tends asymptotically to roughly 6 years under the conditions considered. However, from our state of the art analysis, we conclude that current LoRaWAN hardware is not as well optimized as that of other low-power technologies. In the latter, sleep current in the order of (or even below) 1 µA is common, which allows multiyear device lifetimes with a button cell battery, of 1 order of magnitude less capacity than the one considered in this study. In contrast, current batteries used for LoRaWAN hardware have a larger size and weight, which in turn has an impact on the physical dimensions and weight of current LoRaWAN devices and limits applicability of current LoRaWAN devices for domains where such dimensions are relevant, such as wearables.
Finally, the energy cost per delivered bit of maximum-sized frame payload transmission is roughly two orders of magnitude lower than the one obtained for the short payload of 1 byte per frame. An end-device operating as a sensor will thus beneﬁt signiﬁcantly from accumulating readings and sending them at the highest notiﬁcation period possible. For non-zero BER up to 10−3, acknowledged transmission increases the energy cost of data delivery by up to roughly one and two orders of magnitude, for DR0 and DR5, respectively.
Acknowledgments: This work was supported in part by the European Regional Development Fund (ERDF) and the Spanish Government through project TEC2016-79988-P, AEI/FEDER, UE.
Author Contributions: L.C. developed the analytical models and studied conﬁguration of the hardware used. B.M. performed current consumption measurements and contributed to producing evaluation results. All authors contributed to the design and writing of the paper, and the analysis of results.
Conﬂicts of Interest: The authors declare no conﬂict of interest.
References
1. Raza, U.; Kulkarni, P.; Sooriyabandara, M. Low Power Wide Area Networks: An Overview. IEEE Commun. Surv. Tutor. 2017, 19, 855–873. [CrossRef]
2. Minaburo, A.; Toutain, L.; Gomez, C. LPWAN Static Context Header Compression (SCHC) and fragmentation for IPv6 and UDP. IETF Internet Draft 2017, work in progress.
3. Mikhaylov, K.; Petajajarvi, J.; Hanninen, T. Analysis of capacity and scalability of the LoRa low power wide area network technology. In Proceedings of the 22th European Wireless Conference, Oulu, Finland, 18–20 May 2016; pp. 1–6.
4. Farrell, S. LPWAN Overview. IETF Internet Draft 2017, work in progress. 5. Petajajarvi, J.; Mikhaylov, K.; Roivainen, A.; Hanninen, T.; Pettissalo, M. On the coverage of LPWANs:
Range evaluation and channel attenuation model for LoRa technology. In Proceedings of the 14th International Conference on ITS Telecommunications (ITST), Copenhagen, Denmark, 2–4 December 2015; pp. 55–59. 6. Adelantado, F.; Vilajosana, X.; Tuset-Peiro, P.; Martinez, B.; Melia, J. Understanding the limits of lorawan. Available online: https://arxiv.org/pdf/1607.08011 (accessed on 18 July 2017).

Sensors 2017, 17, 2364

29 of 30

7. Augustin, A.; Yi, J.; Clausen, T. A study of LoRa: Long range & low power networks for the Internet of Things. Sensors 2016, 16, 1466.
8. Nolan, K.E.; Guibene, W.; Kelly, M.Y. An evaluation of low power wide area network technologies for the Internet of Things. In Proceedings of the IEEE International of Wireless Communications and Mobile Computing Conference (IWCMC), Paphos, Cyprus, 5–9 September 2016; pp. 439–444.
9. Petajajarvi, J.; Mikhaylov, K.; Pettissalo, M.; Janhunen, J.; Iinatti, J. Performance of a low-power wide-area network based on LoRa technology: Doppler robustness, scalability, and coverage. Int. J. Distrib. Sens. Netw. 2017, 13, 1–16. [CrossRef]
10. Mikhaylov, K.; Petajajarvi, J.; Janhunen, J. On LoRaWAN Scalability: Empirical Evaluation of Susceptibility to Inter-Network Interference. Available online: https://arxiv.org/pdf/1704.04257 (accessed on 18 July 2017).
11. Haxhibeqiri, J.; Van den Abeele, F.; Moerman, I.; Hoebeke, J. LoRa Scalability: A Simulation Model Based on Interference Measurements. Sensors 2017, 17, 1193. [CrossRef] [PubMed]
12. Petajajarvi, J.; Mikhaylov, K.; Yasmin, R.; Hämäläinen, M.; Iinatti, J. Evaluation of LoRa LPWAN Technology for Indoor Remote Health and Wellbeing Monitoring. Int. J. Wirel. Inf. Netw. 2017, 24, 153–165.
13. Kim, B.; Hwang, K. Cooperative Downlink Listening for Low-Power Long-Range Wide-Area Network. Sustainability 2017, 9, 627. [CrossRef]
14. Mahmoud, M.S.; Mohamad, A.A.H. A Study of Efﬁcient Power Consumption Wireless Communication Techniques/ Modules for Internet of Things (IoT) Applications. Adv. Intern. Things 2016, 6, 19–29. [CrossRef]
15. Bjelcevic, S.; Jemson, J.; Karusala, N.; Purcell, D. LAMBS: Light and Motion Based Safety. Available online: https://andyhub.com/wordpress/wp-content/uploads/LAMBSFinalReport.pdf (accessed on 18 July 2017).
16. Bor, M.; Roedig, U. LoRa Transmission Parameter Selection. In Proceedings of the 13th IEEE International Conference on Distributed Computing in Sensor Systems (DCOSS), Ottawa, ON, Canada, 5–7 June 2017.
17. Mendívil, L.J. Comparación de Soluciones Basadas en LPWAN e IEEE 802.15.4 Para Aplicaciones de Salud Móvil (“m-Health”). Master’s Thesis, Centro de Investigación Cientíﬁca y de Educación Superior de Ensenada, Ensenada, Mexico, 2017.
18. Neumann, P.; Montavont, J.; Noël, T. Indoor deployment of low-power wide area networks (LPWAN): A LoRaWAN case study. In Proceedings of the IEEE 12th International Conference on Wireless and Mobile Computing, Networking and Communications (WiMob), New York, NY, USA, 17–19 December 2016; pp. 1–8.
19. Mikhaylov, K.; Petäjäjärvi, J. Design and implementation of the plug&play enabled ﬂexible modular wireless sensor and actuator network platform. Asian J. Control 2017, 19, 1392–1412.
20. Magno, M.; Aoudia, F.A.; Gautier, M.; Berder, O.; Benini, L. WULoRa: An energy efﬁcient IoT end-node for energy harvesting and heterogeneous communication. In Proceedings of the IEEE Design, Automation & Test in Europe Conference & Exhibition, Lausanne, Switzerland, 27–31 March 2017; pp. 1528–1533.
21. Dongare, A.; Hesling, C.; Bhatia, K.; Balanuta, A.; Pereira, R.L.; Iannucci, B.; Rowe, A. OpenChirp: A Low-Power Wide-Area Networking architecture. In Proceedings of the IEEE International Conference on Pervasive Computing and Communications Workshops (PerCom Workshops), Kona, HI, USA, 13–17 March 2017; pp. 569–574.
22. Conus, G.; Lilis, G.; Zanjani, N.A.; Kayal, M. An event-driven low power electronics for loads metering and control in smart buildings. In Proceedings of the Second International Conference on IEEE Event-Based Control, Communication, and Signal Processing (EBCCSP), Krakow, Poland, 13–15 October 2016; pp. 1–7.
23. Kim, C. AN079-Measuring Power Consumption of CC2530 with Z-Stack. Texas Instruments. Available online: http://www.ti.com/lit/an/swra292/swra292.pdf (accessed on 18 July 2017).
24. Aguilar, S.; Vidal, R.; Gomez, C. Opportunistic Sensor Data Collection with Bluetooth Low Energy. Sensors 2017, 17, 159. [CrossRef] [PubMed]
25. Sartori, D.; Brunelli, D. A smart sensor for precision agriculture powered by microbial fuel cells. In Proceedings of the IEEE Sensors Applications Symposium (SAS), Catania, Italy, 20–22 May 2016; pp. 1–6.
26. Toussaint, J.; El Rachkidy, N.; Guitton, A. Performance analysis of the on-the-air activation in LoRaWAN. In Proceedings of the IEEE 7th Annual Information Technology, Electronics and Mobile Communication Conference (IEMCON), Vancouver, BC, Canada, 13–15 November 2016; pp. 1–7.
27. Sornin, N.; Luis, M.; Eirich, T.; Kramp, T.; Hersent, O. LoRaWAN Speciﬁcation; Version V1.0.2; LoRa Alliance: Beaverton, OR, USA, 2016.
28. LoRaWAN™ Certiﬁed Products. Available online: https://www.lora-alliance.org/certiﬁed-products (accessed on 18 July 2017).

Sensors 2017, 17, 2364

30 of 30

29. LoRaWAN Multitech mDot. Available online: http://www.multitech.com/documents/publications/datasheets/86002171.pdf (accessed on 18 July 2017).
30. NetBlocks XRange. Available online: https://www.netblocks.eu/xrange-sx1272-lora-datasheet/ (accessed on 18 July 2017).
31. Microchip RN2483 LoRa Mote. Available online: http://www.microchip.com/DevelopmentTools/ ProductDetails.aspx?PartNO=dm164138 (accessed on 18 July 2017).
32. LoRaBug. Available online: https://github.com/OpenChirp/LoRaBug (accessed on 18 July 2017). 33. Semtech SX1272. Available online: http://www.semtech.com/images/datasheet/sx1272.pdf (accessed on
18 July 2017). 34. Semtech SX1276. Available online: http://www.semtech.com/images/datasheet/sx1276_77_78_79.pdf
(accessed on 18 July 2017). 35. HopeRF HM-TRLR-LF/HFS Series 100 mW. Available online: http://www.hoperf.com/upload/rf/HM-
TRLR-S_Series_english_.pdf (accessed on 18 July 2017). 36. Microchip RN2483. Available online: http://ww1.microchip.com/downloads/en/DeviceDoc/50002346A.pdf
(accessed on 18 July 2017). 37. Errata Microchip RN2483. Available online: http://ww1.microchip.com/downloads/en/DeviceDoc/
80000689A.pdf (accessed on 18 July 2017). 38. Semtech Corporation. SX1272/3/6/7/8: LoRa Modem. Designer’s Guide. AN1200.13; Semtech Corporation:
Camarillo, CA, USA, 2013. 39. LoRa Alliance Technical committee. LoRaWAN™ 1.0.2 Regional Parameters; LoRa Alliance Technical
Committee: San Ramon, CA, USA, 2017. 40. Kerlink LoRa IoT Station. Available online: http://www.kerlink.fr/images/Kerlink/ﬁches_produit/LoRa-
IoT-Station.pdf (accessed on 18 July 2017). 41. Seller, O.; Sornin, N. Low Power Long Range Transmitter. U.S. Patent 9,252,834, 6 August 2014.
© 2017 by the authors. Licensee MDPI, Basel, Switzerland. This article is an open access article distributed under the terms and conditions of the Creative Commons Attribution (CC BY) license (http://creativecommons.org/licenses/by/4.0/).

