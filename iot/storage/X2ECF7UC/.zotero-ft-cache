This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT

1

Monitoring of Large-Area IoT Sensors Using a LoRa Wireless Mesh Network System: Design and Evaluation
Huang-Chen Lee , Senior Member, IEEE, and Kai-Hsiang Ke

Abstract— Although many techniques exist to transfer data from the widely distributed sensors that make up the Internet of Things (IoT) (e.g., using 3G/4G networks or cables), these methods are associated with prohibitively high costs, making them impractical for real-life applications. Recently, several emerging wireless technologies have been proposed to provide long-range communication for IoT sensors. Among these, LoRa has been examined for long-range performance. Although LoRa shows good performance for long-range transmission in the countryside, its radio signals can be attenuated over distance, and buildings, trees, and other radio signal sources may interfere with the signals. Our observations show that in urban areas, LoRa requires dense deployment of LoRa gateways (GWs) to ensure that indoor LoRa devices can successfully transfer data back to remote GWs. Wireless mesh networking is a solution for increasing communication range and packet delivery ratio (PDR) without the need to install additional GWs. This paper presents a LoRa mesh networking system for large-area monitoring of IoT applications. We deployed 19 LoRa mesh networking devices over an 800 m × 600 m area on our university campus and installed a GW that collected data at 1-min intervals. The proposed LoRa mesh networking system achieved an average 88.49% PDR, whereas the star-network topology used by LoRa achieved only 58.7% under the same settings. To the best of our knowledge, this is the ﬁrst academic study discussing LoRa mesh networking in detail and evaluating its performance via real experiments.
Index Terms— Data collection, Internet of Things (IoT), LoRa, long-range wireless area network (LoRaWAN), multihop, physical layer (PHY), sensor, wireless mesh network.
I. INTRODUCTION
T HE Internet of Things (IoT) aims to enable conventional sensing devices to communicate with other devices and to cooperatively provide intelligent service. For example, IoT can be used to monitor air quality in a city to provide real-time information and warnings to inhabitants as well as to control air pollution [1], [2]. Another example is monitoring of solar panels [3]; smart panels can be installed on the roofs of several buildings to optimize their collective efﬁciency. As the number of sensors in an IoT system grows, however, the issue of how to transfer data among those devices becomes increasingly
Manuscript received October 9, 2017; revised February 22, 2018; accepted February 23, 2018. This work was supported by ICP DAS Company Ltd., Taiwan. The Associate Editor coordinating the review process was Dr. Domenico Grimaldi. (Corresponding author: Huang-Chen Lee.)
The authors are with the Department of Communications Engineering, Advanced Institute for Manufacturing with Hightech Innovations, National ChungCheng University, Chiayi 62102, Taiwan (e-mail: huclee@ccu.edu.tw).
Color versions of one or more of the ﬁgures in this paper are available online at http://ieeexplore.ieee.org.
Digital Object Identiﬁer 10.1109/TIM.2018.2814082

complex, and data transfer needs must be balanced with operating considerations and infrastructure costs. In contrast to existing short-range wireless communication technologies currently used for indoor IoT sensors [4], several techniques have been proposed for providing long-range and outdoor wireless communication, such as Sigfox [5], LoRa/LoRaWAN [6], NB-IoT, and LTE-M [7]. Among these, LoRaWAN, which is based on the LoRa physical layer (PHY) [8] implementation, is a network standard for telecom operators. It allows them to provide network service and enable devices to wirelessly transfer data over long distances to remote gateways (GWs). LoRaWAN uses a star-network topology for communication between LoRa GWs and IoT devices; only one hop is allowed between a GW and a LoRa device. Some experiments have shown that a LoRa device can transmit data 15 km in an open area, which is sufﬁcient for most current long-range IoT applications. However, indoor LoRa devices may still be unable to communicate wirelessly with a nearby GW, due to obstacles between sensors, which can attenuate wireless signal strength and result in data losses and communication errors.
Increasing the spreading factor (SF) of LoRa PHY to 12 can signiﬁcantly extend the communication range by increasing the receiver sensitivity [9], but the drawback is that doing so can lower the data throughput rate and cause more severe data collision due to the longer times required for transmission. This issue can be exacerbated when a large number of high-density LoRa devices send wireless data and receive acknowledgments at the same time. Some studies [11] have shown that these conditions can cause the packet delivery ratio (PDR) to drop signiﬁcantly. To solve this issue, telecom operators need to deploy more LoRaWAN GWs to increase the probability of receiving the wireless data from the LoRaWAN devices; this solution increases the cost of the network infrastructure.
Wireless mesh networks are one feasible solution to increase the communication performance of devices in indoor networks. This approach allows all LoRa devices on the network to act as routers and relay data from other devices. In this paper, which is based on [10], we explore the use of wireless mesh networks based on LoRa PHY with the aim of collecting reliable data on the performance of this technique.
Fig. 1 shows a snapshot of the network topology of the proposed LoRa mesh network on our university campus. In Fig. 1, GW denotes the gateway that manages the network and collects data from the IoT sensors, which are indicated

0018-9456 © 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

2

IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT

Fig. 1. Network topology snapshot of the LoRa mesh network devices distributed around a 600 m × 800 m university campus.

by circles with numbers. Nineteen sensors were installed in different buildings across the 600 m × 800 m university campus. The yellow lines connecting the circles indicate the topological paths generated by the data being relayed to the GWs at the moment of the snapshot.
The example in Fig. 1 shows that data generated by sensor 4 were relayed by sensors 1 and 3 before ﬁnally arriving at the GW. Note that the network topology is formed automatically and may change due to environmental changes. Each sensor decides locally which sensor is the best one to help relay its data. Using this approach, a sensor that cannot directly communicate with the GW may ﬁnd other sensors to help it to transfer data to the GW, thereby raising the packet delivery performance (PDR) of each sensor.
We analyzed the communication performance of the wireless mesh network and the result shows that mesh networks can deliver better performance without incurring the cost of installing additional GWs. We also analyzed the performance tradeoffs of different conﬁgurations.
Brieﬂy, the contributions of this paper are as follows.
1) Whereas other studies [11]–[16] have continued to focus on the analysis of the standard LoRaWAN protocols, discussing how to alleviate the issues caused by signal attenuation and collision in high-density wireless devices, this paper proposes a LoRa mesh networking system and evaluates its performance. We thereby identify a new approach for fulﬁlling the practical need to collect data from IoT sensors scattered over a campus-sized area without using expensive 3G/4G networks or laying cables for data transmission.
2) This paper is one of a few works to empirically evaluate the performance of LoRa mesh networking. The evaluation illustrates that LoRa signals can be attenuated or blocked by buildings and other obstacles

and that the proposed design can mitigate this problem by using mesh networking to increase PDR without deploying additional GWs. 3) The proposed LoRa mesh network module can be integrated with other IoT applications to help collect data from distributed sensors, bypassing complex data transmission, and collection issues. Users do not need to know how to build a network or route the data, because all the communication protocols are contained in the module. This signiﬁcantly simpliﬁes the use of long-range wireless communication and facilitates IoT applications over large regions.
II. RELATED WORK AND DESIGN GOALS
Several long-range wireless communication technologies have recently been proposed. LoRa was one of the ﬁrst such technologies to become commercially available; therefore, many academic studies have been devoted to discuss and analyze LoRa’s performance. LoRa (speciﬁcally, LoRa PHY) is a long-range wireless transmission technique, and LoRaWAN is a networking design that enables telecom operators to provide subscription services based on LoRa PHY. LoRa PHY is a proprietary chirp spread spectrum scheme that uses the sub1 GHz wireless frequency band. It features extremely high sensitivity, down to −137 dBm, and a maximal link budget of up to 157 dB [23]. Several parameters of LoRa PHY can be adjusted for different performance goals, including power level, SF, bandwidth (BW), and coding rate (CR). Changes in power level, SF, BW, and CR involve multiple tradeoffs among transmission time on air (data throughput), power consumption, and transmission range, and different tradeoffs result in varying receiver sensitivities, transmission time on air, and signal-to-noise ratios (SNRs).
In a study of how SF affects receiver sensitivity in LoRa and LoRaWAN [13], researchers used a Semtech SX1276 Mbed

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

LEE et al.: MONITORING OF LARGE-AREA IoT SENSORS USING A LoRa WIRELESS MESH NETWORK SYSTEM

3

shield as the end device and a Cisco 910 industrial router as the GW. The BW setting of the LoRa device was 125 kHz, the CR was 4/5, and the power output level was set to the minimum, 2 dBm, with a 3-dBi antenna. A packet transmission test showed that the receiver sensitivity (the minimum signal strength needed to decode the incoming packet correctly) was −123 dBm with an SF of 7. This improved to −135 dBm when the SF was increased to 12, that is, larger SF resulted in better receiver sensitivity and longer transmission range. The researchers also tested the transmission range under different SF settings in an outdoor, urban area; the results indicated that, with an SF of 12, the transmission range could reach 3500 m with a 40% PDR; the PDR collapsed to 0% at SF 7 or 9. However, the larger SF also resulted in slow data throughput. The researchers tested the throughput of LoRaWAN at BW = 125 kHz, and the results illustrated that the throughput was about 780 bytes/s at an SF of 7 and dropped to only 28 bytes/s at an SF of 12. This shows that the channel data capacity was limited if the SF was large.
The design and drawbacks of LoRaWAN are similar to those of the ALOHA [17] protocol, as there is no mechanism to arbitrate access to a shared wireless frequency. Transmissions by more than one transmitter at the same time may result in data collision. LoRaWAN uses this approach to simplify the design of the media access control layer for battery-powered LoRa device, which is required for saving valuable energy, thus prolonging its lifetime. Therefore, a LoRa device can transmit data to the GW at any time, causing signiﬁcant packet collision if many devices transmit signal simultaneously [11].
To test long-range outdoor transmission, Petäjäjärvi et al. [14] installed a LoRa node on the roof rack of a car and another on the radio mast of a boat. They tested the communication range of their system using a frequency of 868 MHz and an output power level of 14 dBm, with an SF of 12. They observed that the maximal communication range in an open area was more than 15 km on land and 30 km over water. However, this good performance is mainly due to the lack of obstructions and use of only a few LoRa devices transmitting data on the same frequency simultaneously.
When a GW needs to serve a large number of LoRa devices at the same time, the capacity of the uplink channel available to a LoRaWAN node strongly depends on the distance from the base station [15]. With so many devices, the capacity could drop to a mere 100 bits/s on average, especially for LoRa channels with high SF and for the most distant nodes. Additionally, in LoRaWAN, there is no clear channel assessment mechanism, which increases the probability of packet collision. The PDR can drop to just 25% when node density is very high [11]. Deploying additional GWs can increase the performance in terms of receiving data, but at added cost. Directional antennas have also been considered as a means of alleviating interference in LoRa networks [12], but only simulations have been evaluated to date. The time-related performance of LoRa and LoRaWAN was also evaluated [16] to determine the uncertainty of schedule to transmission and long-term clock stability.
One commercial device from NiceRF [18] can supposedly help to form a LoRa mesh network, but very limited

information is provided in its datasheet, including information about how to form a mesh network, how to relay data, and the communication performance of the device. The device datasheet [18, p. 8] indicates that it is simply based on repeating the received data in the same network ID. Therefore, this approach is similar to the Adhoc on-demand distance vector routing method of Zigbee and the managed ﬂood method of Bluetooth 5.0 mesh networks [19]. This approach should work when network trafﬁc is low, but it may be difﬁcult to maintain the communication quality as trafﬁc increases, and it may not be able to manage the network topology. In contrast, the industrial application standard time-slotted channel hopping wireless mesh network systems such as WirelessHART [20] and the ISA100.11a [21] standard both support graph routing as well as source routing; both standards are based on the IEEE 802.15.4. In the architecture of WirelessHART, a special computer network manager manages the network topology and communication schedule. It also manages the communication quality and adapts to different types of trafﬁc and changes in its environment. ISA100.11a implements its routing mechanism in a data link layer for data forwarding based on routing graphs, which are created by the system manager in the ISA100.11a architecture. Both WirelessHART and ISA100.11a can provide better communication reliability as the network is centrally managed, but they are not speciﬁcally designed for monitoring large areas such as a university campus. Therefore, it may be inappropriate to make a direct comparison between these standards and the design proposed here.
The conclusion based on these previous studies, focusing on evaluating the performance of LoRa/LoRaWAN, is clear: to serve more high-density and indoor LoRa devices requires deployment of more LoRa GWs. However, this approach defeats the original purpose of LoRa/LoRaWAN, that is, to provide an inexpensive and efﬁcient IoT communication service. Another issue is that users may need to pay telecom operators for subscriptions to a LoRaWAN service, and, even as subscribers, they might not receive good communication quality if the operator’s GW is far away.
In response to these issues, this paper takes a different approach by building a wireless mesh network system based on LoRa PHY rather than LoRaWAN. The proposed design can collect data from IoT sensors distributed across a large region, such as a tall building or a university campus, using only a single LoRa GW. The design allows all LoRa devices to act as data routers, thereby enhancing the communication performance of indoor devices that may have difﬁculty in communicating with the GW directly. The design goals of the proposed system are as follows.
1) The campus-wide wireless mesh network must be able to collect data from IoT sensors, even indoor sensors. The network should be able to function in environments with physical obstacles such as buildings, and it should provide automatic routing of data back to the GW. This is very important if nonprofessional users are to manage the system.
2) The deployment procedure for the IoT sensor should not require any prior conﬁguration. Users should be able

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

4

IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT

Fig. 3. System architecture.

Fig. 2. Architecture of the proposed LoRa wireless mesh network module.

to simply install their IoT sensors without considering communication issues. Unlike LoRaWAN, there should be no need to add GWs to increase performance; only one GW should be needed. 3) The wireless mesh network must be manageable. Information about the network routing path, data delivery ratio, received signal strength (RSS), and SNR of each path should be collected and displayed on the GW. This information should help the manager understand the status of the system and correct communication problems in the case of weak data links. 4) The design should be empirically veriﬁed in an outdoor environment to ensure that the system works in practical scenarios. These goals guided the design of our system, which is described in Section III.
III. SYSTEM ARCHITECTURE AND DESIGN
In this section, we describe the design of the system. The basic design of the LoRa wireless mesh network module is shown in Fig. 2. It is based on a Nuvoton Nano100LE3BN [22], an ARM M0 microprocessor, and a Semtech SX1278 [23] LoRa RF 430 MHz transceiver with a 1.9-dBi gain helical antenna. The current design focuses on wireless communication performance rather than, for instance, low-power requirements; therefore, all nodes and the GWs are wall powered via 5-V USB adapters. The microprocessor communicates with the LoRa transceiver via a serial peripheral interface (SPI) to send and receive data wirelessly. The microprocessor is also integrated with a USB-UART converter Silicon Lab CP2102 to convert UART to USB for communicating with the application processor. The nodes and the GWs use the same hardware platform. All mesh networking protocols are run on the ARM M0 microprocessor. This module can act as a radio module, similar to XBee [12], to accept AT-commands from an application processor with USB or UART. An example of an AT-command list can be found in [24]; therefore, the application processor can use this module as a network interface, so users do not need to worry about how the wireless network is formed. Fig. 3 illustrates the architecture of the proposed LoRa wireless mesh network system. The integration of the IoT sensors with the LoRa wireless mesh network module forms the mesh

Fig. 4. Basic ﬂowchart of a GW.
network automatically. The GW of this system will sequentially collect the data accumulated in the IoT sensors. The GW outputs the data to the management user interface, displaying the status of the wireless mesh network and showing the data in the IoT sensors. The user’s application can read the data from the user interface, which is useful in applications such as electricity/water–meter monitoring or solar panel management.
We introduce a network formation scenario, schematically shown in Fig. 4. Child_list is a data structure that is initially empty. It is held by the GW and will store the list of LoRa nodes joined to its network. In the initial stage, the GW will broadcast beacons periodically (i.e., every 60 s) inviting other LoRa nodes (hereafter called nodes) to join its network, as shown in the ﬂowchart. A LoRa node hearing the beacon from the nearby GW may join this network by sending a JOIN request and setting the GW as its parent.
Fig. 4 shows how the GW adds the joined node to its child_list and then begins to gather data by calling the subfunction node_query, as illustrated in Fig. 5. This function sends a QUERY request to the target node to gather data from the node in the child_list. If the QUERY request times out, then the function adds one to the counter timeout_count, marking the target node as missing if timeout_count > 5. The GW will remove the missing node from its child_list and will not attempt to gather data from it in the next node query. Once the GW has the ﬁrst child, and child_list is not empty, the GW will stop broadcasting the periodical beacon. Instead, the GW will use the data packets sent to its children as beacons for notifying other nodes to join it if necessary, as shown in Fig. 4.

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

LEE et al.: MONITORING OF LARGE-AREA IoT SENSORS USING A LoRa WIRELESS MESH NETWORK SYSTEM

5

Fig. 5. Flowchart of subfunction node_query of a GW.

Fig. 7. Flowchart of the subfunction process_packet of a LoRa node.

Fig. 6. Basic ﬂowchart of a LoRa node.
If a node can hear the beacon from the GW, it must be able to overhear the data packet from the same GW. So this approach saves time by eliminating unnecessary beacon broadcasting by the GW.
As shown in Fig. 6, a power-ON node m will listen for a beacon from a nearby GW or will overhear a data packet (functioning as a beacon for m) from a nearby GW or node. If m has not yet joined the network, it will choose a suitable network parent (either the GW or a node). The choice of a suitable network parent is based on multiple factors. In this design, the node stores the RSS indicator (RSSI) of recently received beacons/packets from different GWs or nodes in a candidate list. The node’s hop-count distance to the GW is also recorded in the list. The node m selects the best parent from

the list based on its own subjective decision, i.e., the node with the strongest RSSI and with the smallest hop-count distance to the GW in the present moment. The reason behind this is that a node will try to ﬁnd a parent that is the closest to the GW but that also has a good communication quality.
Therefore, considering buildings, obstacles, interferences in the ﬁeld, and the location of the node, that is, whether it is indoors or outdoors or on the ﬁrst ﬂoor or the top ﬂoor, the geographically nearest node based on the 2-D top-down view is not always the best parent candidate. The various methods for deciding on a suitable parent candidate are not discussed deeply in this paper. In the practical implementation, the GW has a global-view topological map of the mesh network after the network is formed, and it can force assignment of a new parent to a node according to its comprehensive information. This approach is reasonable, as it is very difﬁcult for a node to ﬁnd the best parent with its own local-view and limited knowledge.
After the node m decides on a suitable parent, it sends a JOIN request and waits for conﬁrmation before joining the network. If the node m receives a conﬁrmation, then it will join the network. Afterward, if node m receives a data or command packet, it will process this packet and respond as appropriate by calling the subfunction process_packet.
As shown in Fig. 7, process_packet determines what type of packet has been received and processes the packet as appropriate. If a node n receives a JOIN request from another node, then n may accept or reject this request based on its current status (for example, n may reject the JOIN request if n already has too many children) and respond accordingly. If the incoming packet is a data or command packet, and if the packet destination is n itself, then n will process the packet

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

6

IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT

Fig. 8. Procedure for a node joining the network and querying the GW.

Fig. 9. PDR at different distances under different SF settings.

and respond accordingly; for example, n will respond to a data request or command from the GW. If the destination is not n itself but the packet source is n’s parent or child, then n will help to relay this packet to the destination; otherwise, it will drop the packet.
We present an example scenario, illustrated in Fig. 8, in which node 1 joins the network and sets the GW as its parent. The GW adds node 1 to its child_list. Then, the GW queries nodes in its child_list for data. In this design, the GW initiates the query procedure. As shown in Fig. 8, the GW sends query M1 to node 1, and node 1 reports its data M2 back to the GW. Meanwhile, the nearby node 3 overhears M2. Note that M2 for node 3 is a beacon. Thus, node 3 joins the network and sets node 1 as its parent. Node 1 notiﬁes the GW of the newly joined node 3. The mesh network is formed and all nodes are connected to the GW based on the procedure. Therefore, in the next query round, the GW will query node 3 to gather its data using the message sequence M3, M4, M5, and M6. Based on this sequence, all the nodes can join this multihop wireless mesh network, and the GW can query all the nodes.
In addition, because the GW has a global-view topological map of the mesh network and has all the routing path information, in this design, the node can ask the GW for the routing path to another node; therefore, the routing is implemented. However, in the real-world application, in most cases, the GW will initiate the query procedure for collecting data from the nodes; direct communication between nodes is used less frequently.
IV. EVALUATION AND DISCUSSION
We evaluated the proposed system to verify the applicability of the design. In this section, we describe and discuss our evaluation.
A. Preliminary Experiments
First, we tested the proposed LoRa module at different transmission distances by setting the output power level to 20 dBm and the BW to 125 kHz. Two nodes were placed 1 m above the ground. The transmitter sends 200 packets to the receiver, which is placed in the transmitter’s line of sight on a street in an urban area, with moving and stationary obstacles (i.e., pedestrians, cars, and buildings) between them.

This experiment tested the PDR of two nodes under different SF settings, including SF = 6, 9, and 12. According to the design of the LoRa PHY layer, larger SF paired with higher receiver sensitivity should result in higher PDR. Fig. 9 shows that SF = 12 yielded the best PDR among all the tested distances. With SF = 6, the PDR was 56% at 300 m and dropped to 0% at 500 m. With SF = 12, the PDR was 98% at 500 m, observably better than SF = 6. Even when the distance was extended to 1000 m, the PDR remained at 54%. This experiment conﬁrmed that large SF can increase the transmission range and data delivery performance.
B. In-Building Range Test
In order to further investigate the communication performance of the designed LoRa module, we conducted an experiment in a ﬁve-story classroom building on our university campus to test how the LoRa signal traveled vertically across the building’s ﬂoors. The receiver node was installed on the ﬁfth ﬂoor (5F), the top ﬂoor of this building, and transmitter nodes were installed on 1F, 2F, 3F, 4F, and 5F. For two nodes, we used the same test procedure as in the previous test. Different LoRa PHY settings were tested, including various SF and BW values. The RSSI, PDR, and time on air were collected for evaluation.
Fig. 10 shows the PDR at BW = 250 kHz. When the transmitter was placed on 1F, the LoRa radio signal had to travel through four concrete stories to 5F. Therefore, all the PDRs for 1F are low compared with those of the other ﬂoors. For the LoRa transceiver, the larger BW can increase the PHY rate and reduce the time on air, but it also lowers the PDR as the output power is distributed across a larger BW. Setting S F = 6 further lowers the receiver sensitivity and causes even lower PDR. As a result, the PDRs at SF = 6 are the lowest among the SF settings in this experiment.
Fig. 11 shows the PDRs at BW = 125 kHz. All PDRs at BW = 125 kHz were higher than the PDRs at BW = 250 kHz, particularly at SF = 6 on 1F. However, in both tests, the PDR of SF = 6 was still low compared with PDR at other SF settings. Although the PDRs were all almost 100% at SF settings from 7 to 12 (Fig. 11), the PDRs with SF = 6 ranged from 80% to 93%. We conclude that,

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

LEE et al.: MONITORING OF LARGE-AREA IoT SENSORS USING A LoRa WIRELESS MESH NETWORK SYSTEM

7

Fig. 10.

PDR on different ﬂoors under different SF settings

(BW = 250 kHz).

Fig. 13. devices.

Another network topology snapshot of the LoRa mesh network

Fig. 11.

PDR on different ﬂoors under different SF settings

(BW = 125 kHz).

SPI between the microprocessor and the LoRa transceiver is SPI, and the time measurement is not very accurate, some uncertainties may be introduced, varying estimations of the time on air. However, this might be acceptable as this result is for understanding how SF and BW affect the time on air. We can see that larger SF and smaller BW resulted in longer time on air. The time on air was only 16 ms for SF = 6 and BW = 250 kHz, but it increased to 2881 ms for SF = 12 and BW = 62.5 kHz. Therefore, although larger SF and smaller BW settings increase the PDR, these settings also signiﬁcantly prolong the time on air and may cause serious packet collision if multiple transmitters send data simultaneously. We can compare this drawback to singlehop LoRaWAN systems, which suffer from low PDR with a high density of LoRa devices, as mentioned in [13]. In the proposed system, the GW initiates all communications and queries devices. Therefore, the LoRa node cannot actively send out data, thus avoiding packet collision at the cost of long transmission delays. Although this delay is a drawback, in the context of the IoT data collecting, this approach prevents packet collision without introducing complications into the simpliﬁed design.

Fig. 12. Time on air (in millisecond) under different BW and SF settings.
if we want to increase the PDR, we should set the SF to a larger number and the BW to a smaller number.
Fig. 12 illustrates how time on air (the amount of time needed to transmit data wirelessly) was affected by different BW and SF settings for a packet with a 20-byte payload. The time on air is measured using the GPIO interrupt of the node’s microprocessor; the GPIO interrupt was triggered when the LoRa transceiver to send data and receiving the notiﬁcation of data sent out from the transceiver, and to measure the time interval between two interrupt triggering with timer. As the

C. Campus-Scale Experiment: 19 LoRa Nodes on a University Campus
In the campus-scale experiment, we placed 19 LoRa nodes (originally, we installed 20 nodes, but node 6 was lost during the experiment), distributed in an 800 m × 600 m area of our university campus. We allowed the GW to collect data at 1-min intervals for eight days. In this setting, for each node, the maximum latency is 60 s, depending on when the node is queried by the GW. Each node is queried by the GW one time every minute, so it will be queried 60 (min) × 24 (h) × 8 (days) = 11 520 times (packets) if a node is connected to the network during all eight days. The LoRa PHY parameters were set to SF = 12 and BW = 250 kHz. In this experiment, we focused only on communication performance; the content of data packets was not considered. The nodes form a wireless mesh network automatically and the GW collects data from these nodes periodically based on a multihop network.

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

8

IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT

Fig. 14. PDR under different hop-count limitations.

Fig. 15. Pictures of the GW and nodes deployed in this experiment.
Referring back to the snapshot of the network topology shown in Fig. 1, the color of the circles with node numbers indicates the ﬂoor of the building on which each node was installed (e.g., 1F or RF). Nodes at 1F, like node 12, need the help of other nodes to relay data to the GW (GW in Fig. 1), because they cannot communicate with the GW directly. In this case, node 14 at 5F and node 3 at 8F-assisted node 12 in relaying its data to the GW (the path is denoted by 12-14-3-GW).
Another snapshot of the network topology was taken and is shown in Fig. 13. In this snapshot, node 2 has changed its parent to node 3 and has skipped node 14, communicating with the GW using the path 12-3-GW. These results conﬁrm that our LoRa mesh network module can dynamically form a wireless mesh network and adapt to environmental changes. Note that, in both snapshots, node 18 was not connected to the network at the moment the snapshot was taken. Further examination revealed that it was located indoors and was not in a good position to contact a potential parent. Node 18

still achieved at most an average PDR of 69.74%, as shown in Fig. 14.
Fig. 15 shows how the GW and the nodes were deployed in this experiment. The GW uses a 3-dBi omniantenna installed on the roof of the building. All nodes were installed at locations that were not in the line of sight of the GW.
Fig. 14 shows the end-to-end PDR of this campus-scale experiment. The PDR was counted on the GW side, based on the data log collected in this experiment. For ease of evaluation, data were analyzed by applying different limitedhop counts. In Fig. 14, 1Hop indicates that all nodes were restricted to sending data to the GW with only one hop, that is, with no relay from other nodes. If a data packet was delivered back to the GW with more than two hops, this packet was not counted in 1Hop PDR. Therefore, the performance of 1Hop includes only packets delivered with one hop, so it can be seen as a LoRaWAN simulation. We can see that 1Hop PDRs are relatively low. Some nodes did not successfully deliver any data to the GW, resulting in PDRs of 0% (i.e., nodes 1, 4, 8, 12, 17, 18, and 19 in Fig. 14). This result indicates that the one-hop LoRa network does not perform well for indoor nodes, which again conﬁrmed the analysis of [11]–[13]. The PDR could fall even further if nodes are allowed to send data actively (such as in the ALOHA protocol in LoRaWAN approach). The proposed design, by contrast, uses a pollingbased approach, whereby all the nodes listen for requests from the GW, then report data only when queried, avoiding the problem of intranetwork packet collision.
For these low-PDR nodes, with the exception of node 4, the PDRs increased dramatically if the hop-count constraint was relaxed to 3Hop, allowing a node to use, at most, three hops to deliver data to the GW. For example, the PDR of node 12 was 0% at 1Hop, but it increased to 94.94% at 3Hop. For all nodes, the average 1Hop PDR was 58.7% and the average 3Hop PDR was 88.49%. These results support our assertion that the proposed LoRa mesh networking solution can increase PDR without deploying an additional GW, avoiding additional infrastructure costs associated with the collecting IoT sensor data.
With regard to the relationship between transmission distance and PDR, multiple factors affect the PDR,

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

LEE et al.: MONITORING OF LARGE-AREA IoT SENSORS USING A LoRa WIRELESS MESH NETWORK SYSTEM

9

Fig. 16. Parent selections of node 10 in this experiment.

Fig. 17. Relationship between PDR and RSSI.

Fig. 18. Relationship between PDR and SNR.

including buildings, obstacles, interferences in the ﬁeld, and the location of the node, such as whether it is indoors or outdoors, or whether it is on a ﬁrst ﬂoor or top ﬂoor. Thus, the geographical distance based on the top-down view does not always correlate with the PDR. Transmission distance is not a good factor for estimating PDR, which is very difﬁcult to model without considering these factors.
Fig. 16 shows the parent candidates for node 10 in the experiment. Note that this does not include the case in which node 10 sends data directly to the GW. In this design, a node chooses its parent according to its current local information. If the environment changes or the node loses contact with its

current parent for a period of time (i.e., 5 min pass without receiving any command or data request from its parent), then the node will try to ﬁnd a new parent by sending a JOIN request. Fig. 16 shows that if node 10 cannot join the GW, then it has four parent candidates: nodes 3, 9, 14, and 15. Referring to the pie chart in Fig. 16 (left), we can see that node 9 was node 10’s parent 74% of time and transferred 7085 packets. The bar chart in Fig. 16 (right) indicates that node 9 had the highest average PDR, almost 100%, and the strongest RSSI among all the parent candidates.
Fig. 17 shows the relationship between RSSI and PDR. These signal quality statistics are based on the delivery of

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

10

IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT

all packets to the GW. We can see that the average PDR was above 96.1% when RSSI was larger than −110 dBm, and the average PDR dropped to 5.8% when the RSSI was smaller than −130 dBm. In the range from −110 to −130 dBm, the RSSIs decreased as the standard deviation of PDR increased, indicating unreliable communication. The maximum standard deviation of PDR occurred when RSSI was in the range from −120 to −130 dBm. In this range, packet delivery was unreliable, so nodes should avoid low RSSI parents if a stable communication path is to be established.
Fig. 18 illustrates the relationship between PDR and SNR. We can see that larger SNR accompanies higher PDR and smaller standard deviation of SNR. For all SNR values larger than −5, the PDRs are greater than 94.2%. A signiﬁcant cliff appears in the PDR trend at SNR below −20, dropping the average PDR to only 5.4%; by contrast, the PDR was still 65% when the SNR was in the range from −15 to −20.
The above-mentioned information in combination with the results suggests that a stable LoRa PHY link with a PDR > 90% can be achieved with RSSI > −110 dBm and SNR > −5. By contrast, this would be impractical for LoRaWAN systems, which require the deployment of more GWs near the nodes to achieve the same RSSI and SNR. This further supports the proposed design, which can increase PDR while circumventing the requirement for additional GWs.
V. DISCUSSION AND CONCLUSION
This paper presents the design of a LoRa wireless mesh network system for collecting data from IoT sensors distributed across a large geographical area. Our preliminary and in-building experiments conﬁrmed the ﬁndings of previous studies regarding the effect of various LoRa PHY parameters (e.g., SF and BW) on communication performance, including PDR, and time on air. In our campus-scale experiment, 19 LoRa nodes were distributed over an 800 m × 600 m area. Data analysis comparing the LoRa PHY one-hop wireless network (i.e., simulated LoRaWAN) with our proposed LoRa mesh network shows that the mesh network can signiﬁcantly increase PDR without installing additional GWs. In addition, parent selections, PDR versus RSSI and PDR versus SNR, were comprehensively analyzed. The results suggest thresholds for RSSI and SNR for maintaining communication quality. These thresholds may be impractical for LoRaWAN architecture, where achieving the ideal RSSI and SNR would require deployment of many additional GWs, thus raising the cost of the infrastructure.
As far as we know, this is the ﬁrst academic study extending LoRa PHY to mesh networking. It is also the ﬁrst to evaluate such a mesh network in practical experiments over a large geographical area. This paper has explored the potential of IoT sensor deployment and monitoring and collecting of data from those IoT sensors in an area requiring long-range transmissions. Further study on this topic will focus on adjusting the SF/BW parameters dynamically to raise PDR. Further study will also be required to understand how to minimize delays in data transmission from the nodes. In the current design, the node can send out data only if it has received

a command to do so from the GW. If nodes are allowed to send data actively, without waiting for a data request from the GW, as in the ALOHA LoRaWAN approach, packet collision may decrease PDR in the event that many nodes send data simultaneously. Striking a balance between transmission delay and packet collision is a complex task.
Regarding the timing performance degradation, as the proposed method uses a mesh network, the number of nodes that a network can serve is smaller than for conventional startopology networks. Referring to Fig. 8, for a one-hop node (i.e., node 1 in Fig. 8), the message transmission time is 2t, where t is the time to transfer a message M. For a twohop node (i.e., node 3 in the ﬁgure), the time is 4t, and for a three-hop node it is 6t. Considering a given period time p, the number of nodes from which a GW can collect data in a star-topology network is p ÷ 2t, but this drops to only one-third of that ( p ÷ 6t) when all the nodes are three-hop nodes in the mesh network. The mesh network is a solution for trading off long range with multiple hops, and it can reduce the number of nodes that can be served in given period of time. Therefore, this degradation of timing performance should be considered in designing the IoT data collecting system. Meanwhile, in this design, in order to avoid multiple nodes simultaneously uploading their data over the wireless network, causing data collisions, the GW is responsible for polling data from the nodes and the nodes are not allowed to actively upload data. The drawback of this approach is that the latency between generating data in a node to uploading that data to the GW is high. However, the polling approach has greater ﬂexibility by allowing the GW to decide when to query which node, in contrast to the approach in which communication is initiated by nodes or centralized scheduling.
In addition, questions remain about the security of such a network. As this paper focuses on data transmission, security issues have not been discussed in this paper. However, we can directly apply LoRaWAN’s security solution, which uses application server to provide application session keys for end-to-end security and network server to provide network session keys for network session security in a multihop network.
Finally, the cost in terms of power consumption may also be an issue if this system is to be implemented with, for instance, battery-powered nodes. Regarding the issue of low power at nodes, the router node needs to help relay data from other nodes, so its wireless transceiver must be on at all times; thus, high power consumption is unavoidable. Therefore, in the current design, all the router nodes are wall powered. If some nodes have limited energy, a straightforward approach can be used to disable the data relaying function of these nodes, similar to LoRa Class A end devices [25]. Thus, energy used in wireless communication can be saved as a simple node, that is, one with its data relaying function disabled, only enables its wireless transceiver while it needs to send or receive data. However, this requires further modifying the protocol and introducing friend nodes as deﬁned in the Bluetooth 5.0 mesh network [19] to assist the simple nodes in buffering and relaying data. As the current design has been demonstrated the correctness and performance of the system,

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

LEE et al.: MONITORING OF LARGE-AREA IoT SENSORS USING A LoRa WIRELESS MESH NETWORK SYSTEM

11

such modiﬁcations of speciﬁc requirements can be pursued in the future work.
ACKNOWLEDGMENT
The authors would like to thank ICP DAS Company Ltd., Taiwan, for its technology support. They would also like to thank P.-J. Lee and P.-C. Kuo for their excellent assistance.
REFERENCES
[1] Y. Cheng et al., “AirCloud: A cloud-based air-quality monitoring system for everyone,” in Proc. SenSys, Nov. 2014, pp. 251–265.
[2] J. Shah and B. Mishra, “IoT enabled environmental monitoring system for smart cities,” in Proc. Int. Conf. Internet Things Appl. (IOTA), Jan. 2016, pp. 383–388.
[3] B. Ando, S. Baglio, A. Pistorio, G. M. Tina, and C. Ventura, “Sentinella: Smart monitoring of photovoltaic systems at panel level,” IEEE Trans. Instrum. Meas., vol. 64, no. 8, pp. 2188–2199, Aug. 2015.
[4] G. Mois, S. Folea, and T. Sanislav, “Analysis of three IoT-based wireless sensors for environmental monitoring,” IEEE Trans. Instrum. Meas., vol. 66, no. 8, pp. 2056–2064, Aug. 2017.
[5] Sigfox. (2017). Sigfox—The Global Communications Service Provider for the Internet of Things (IoT). Accessed: Sep. 2, 2017. [Online]. Available: https://www.sigfox.com/en
[6] LoRa-Alliance. Accessed: Sep. 2, 2017. [Online]. Available: https://www.lora-alliance.org/
[7] K. Flynn. (2017). Standardization of NB-IOT Completed. Accessed: Sep. 2, 2017. [Online]. Available: http://www.3gpp.org/news -events/3gpp-news/1785-nb_iot_complete
[8] (2017). LoRa Modulation Basics. Accessed: Sep. 3, 2017. [Online]. Available: http://www.semtech.com/images/datasheet/an1200.22.pdf
[9] M. Centenaro, L. Vangelista, A. Zanella, and M. Zorzi, “Long-range communications in unlicensed bands: The rising stars in the IoT and smart city scenarios,” IEEE Wireless Commun., vol. 23, no. 5, pp. 60–67, Oct. 2016.
[10] K.-H. Ke, Q.-W. Liang, G.-J. Zeng, J.-H. Lin, and H.-C. Lee, “Demo abstract: A LoRa wireless mesh networking module for campus-scale monitoring,” in Proc. 16th Int. Conf. Inf. Process. Sensor Netw. (IPSN), Pittsburgh, PA, USA, Apr. 2017, pp. 259–260.
[11] N. Varsier and J. Schwoerer, “Capacity limits of LoRaWAN technology for smart metering applications,” in Proc. IEEE Int. Conf. Commun. (ICC), Paris, France, May 2017, pp. 1–6.
[12] T. Voigt, M. C. Bor, U. Roedig, and J. M. Alonso, “Mitigating internetwork interference in LoRa networks,” in Proc. Int. Conf. Embedded Wireless Syst. Netw. (EWSN), Uppsala, Sweden, Feb. 2017, pp. 323–328.
[13] A. Augustin, J. Yi, T. Clausen, and W. M. Townsley, “A study of LoRa: Long range & low power networks for the Internet of Things,” Sensors, vol. 16, no. 9, p. 1466, 2016.
[14] J. Petäejäejäervi, K. Mikhaylov, A. Roivainen, T. Hänninen, and M. Pettissalo, “On the coverage of LPWANs: Range evaluation and channel attenuation model for LoRa technology,” in Proc. 14th Int. Conf. ITS Telecommun., Dec. 2015, pp. 55–59.
[15] K. Mikhaylov, J. Petäejäejäervi, and T. Haenninen, “Analysis of capacity and scalability of the LoRa low power wide area network technology,” in Proc. 22th Eur.Wireless Conf., Eur. Wireless (VDE), May 2016, pp. 1–6.
[16] M. Rizzi, P. Ferrari, A. Flammini, and E. Sisinni, “Evaluation of the IoT LoRaWAN solution for distributed measurement applications,” IEEE Trans. Instrum. Meas., vol. 66, no. 12, pp. 3340–3349, Dec. 2017.

[17] N. Abramson, “THE ALOHA SYSTEM: Another alternative for com-

puter communications,” in Proc. Fall Joint Comput. Conf. (AFIPS Fall),

New York, NY, USA, 1970, pp. 281–285.

[18] (2017). NiceRF LoRa-MESH Series Mesh Network Modules. [Online].

Available: http://nicerf.com/product_149_203.html

[19] (2017). Bluetooth 5.0 Mesh Networking Speciﬁcations.

Accessed: Dec. 30, 2017. [Online]. Available: https://www.bluetooth.

com/speciﬁcations/mesh-speciﬁcations

[20] Industrial Communication Networks—Wireless Communica-

tion Network and Communication Proﬁles—WirelessHART,

Standard IEC 62591:2010, 2010.

[21] (2017). The ISA100 Standards Overview & Status. [Online]. Available:

http://isa100wci.org/Documents/PDF/ISA100_Standards-Overview_

WCI_Webinar_V3_12Apr10.aspx

[22] Nuvoton. (2017). NUC100 Advanced Series. Accessed: Sep. 19, 2017.

[Online].

Available:

http://www.nuvoton.com/hq/products/

microcontrollers/arm-cortex-m0-mcus/nuc100-200-advanced-series/

[23] Semtech. (2017). SX1278 137 MHz to 525 MHz Low Power Long

Range Transceiver. Accessed: Sep. 19, 2017. [Online]. Available:

http://www.semtech.com/wireless-rf/rf-transceivers/sx1278/

[24] (2017). XBee/XBee-PRO S1 802.15.4 (Legacy) RF Modules.

Accessed: Dec. 30, 2017. [Online]. Available: https://www.digi.com/

resources/documentation/Digidocs/90000982/Default.htm

[25] (2017). LoRaWAN Classes. Accessed: Dec. 30, 2017. [Online]. Avail-

able: https://www.lora-alliance.org/technology

Huang-Cheng Lee (SM’12) received the Ph.D. degree from National Tsing-Hua University, Hsin-Chu, Taiwan, in 2010.
Since 2000, he has been in the industry and has a wide breadth of experience designing personal digital assistants, cellular phones, and low-power embedded systems. In 2011, he joined the Department of Communications Engineering and Electrical Engineering, National Chung-Cheng University, Chiayi, Taiwan, where he has been an Associate Professor since 2015. He has a strong track record of collaborating with industry partners to transfer technologies from academic research into practice. His current research interests include wireless sensors, mesh networking, Internet of Things, and low-power embedded systems, especially for natural and industrial environment monitoring. Dr. Lee has been an Associate Editor of the IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT since 2015 and an Associate Editor of the IEEE SENSORS JOURNAL since 2017.
Kai-Hsiang Ke received the B.S. and M.S. degrees from the Department of Communications Engineering, National Chung-Cheng University, Chiayi, Taiwan, in 2015 and 2017, respectively.
He is currently an Engineer with Delta Electronics, Tainan, Taiwan.

