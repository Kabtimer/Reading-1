Smart Water Grid Management using LPWAN IoT Technology

M Saravanan
Ericsson Research India Ericsson India Global Services Pvt. Ltd
Chennai, India m.saravanan@ericsson.com
Abstract–As the world population increases at a steady rate, providing clean water to the masses in an efficient manner is one of the biggest challenges faced in the modern era. Controlling the flow of water so that it doesn’t go to waste is another challenge. Water flow is generally managed through locks and manually controlling these gates often turn out to be a long-winding process. Due to recent technological progress and increased connectivity in rural areas, a system of IoT devices proved to be alternative for managing the water grid. A new Low Power Wide Area Network (LPWAN) technology called LoRa is explored in our study for the communication of these IoT devices. The LoRa devices can communicate within a range of 2-4 KMs while running on batteries that last for years. As a pilot project, we implemented a smart water grid management system in Mori, a village in the eastern Godavari district in Andhra Pradesh situated near to Bay of Bengal. The water grid management system proposed in this paper involves different sensors deployed at various strategically chosen locations to measure the quality of water by generating real time data. The system also provides an alert mechanism which notifies the different level of authorities through email and SMS in case of any issues. Furthermore, it provides a solution for handling the locks that have been employed in and around the village to control the flow of water in a timely manner. The sensors attached with a micro controller in the LoRa module will communicate to the cloud environment through the LoRa gateway. A web page provides the interface to the residents and to the authorities to gauge the water quality after analyzing the data using the prediction algorithm.
Keywords—Water Grid; LPWAN; LoRa; Ericsson Cloud; IoT Sensors;
I. INTRODUCTION
Water as a critical resource for human survival is well documented. It is required for drinking, sanitation, agriculture, manufacturing among others. Although roughly 70% of the earth is covered by water, only 2.5% of this water content is fresh water suitable for use in the mentioned activities [1]. This presents us with a challenge of optimizing the usage of the available quantity of fresh water and ensuring a sustained supply of it. Even with fresh water being such a scarce resource, a large portion of it flows directly into the oceans without ever being used by the society. This scenario exists both in developed as

Arindam Das and Vishakh Iyer
Research Interns SRM University Chennai, India {arindam.das, vishakh.iyer}@ericsson.com
well as developing countries and can be largely attributed to the poor resource management and the slow response mechanism with existing technologies.
There are various technologies existing today to facilitate M2M-IoT communication for smart city development. Wireless communication technologies are well established and consist of clearly defined standards. These technologies are geared towards network throughput instead of reducing the power consumption [2]. With advancements like Bluetooth-LE (Low Energy), power consumption is taken as a major consideration, but these technologies still fall short due to having only short range capabilities. Technologies like GSM and LTE provide a massive range which aims to provide higher and higher network throughput at the cost of power consumption. Long Range (LoRa) Radio is one of the recently introduced LPWAN technologies. It provides lower throughput than the previously mentioned technologies [3].
A pilot project of smart water grid solution was tried out in Mori village situated in the south-eastern delta of Andhra Pradesh, India. The village, like many Indian villages deals with severe issues related to the quality and improper maintenance of water. There are problems related to mixing of clean water with the sewage, incomplete water treatment, intermittent water supply and inefficient management of flow control gates. Our proposed solution tries to address many of these problems using a system of connected low powered long range devices which communicate among themselves and generate real time data. The resolution of water quality issues is sped up by automatically sending out alerts to the local authorities instead of waiting for the residents to complain about it. The supply of water is monitored by sensors fitted in the village’s central water tank. This greatly helps to reduce the wastage and scarcity issues faced by the village. The streamlining of the water supply continues with the automation of water locks employed in and around the village to control the flow of water in canals. The scenario before the proposed solution was employed would entail a series of events where a resident would pass the information to the village panchayat, the panchayat would send a worker to manually lift or lower the lock. With automation, information can be instantly passed on to the authorities who can

978-1-5090-5284793-30/17/$31.00 ©2017 IEEE

then decide to alter the locks in a very short time. The proposed solution consists of five inherent stages
 Sensors – A total of seven sensors are deployed in three locations including two canals and the common village tank. These sensors compute the ORP, pH, Salinity, Level, Turbidity, Temperature and Flow of water.
 LoRa Module – The LoRa module is responsible for extracting the sensor data through an Arduino Microcontroller and transmitting the same to a LoRa Gateway.
 LoRa Gateway – The LoRa Gateway is configured to collate data from all the LoRa modules and then send the same for processing in the cloud.
 Ericsson Cloud – After getting the data from the gateway, the Ericsson Cloud (Implemented in Ericsson Research Lab) is responsible for storing and running analytics on the data.
 Website – The website displays real time data from the Ericsson Cloud of various sensor values. The prediction algorithm helps to determine gauge value which represents the water quality at a glance.
A. Our contributions in this paper 1) The study greatly improves the water quality in the
region by providing real time information to the residents and the authorities. A high level of transparency with relation to the information gives the authorities an incentive to maintain the water quality and supply.
2) An alert mechanism to streamlining the water locks which have been employed around the village to control the water flow. This speeds up the process of lowering and raising locks for flood management and controls the sea and fresh water mixing in estuaries.
3) Advanced analytics that enable the residents and farmers receive optimal quality water for domestic and irrigational use according to their needs.
II. RELATED WORK
Smart Grid solutions to manage resources have been picking up pace in recent times. Due to the frequent draught like situation faced by the residents of South Eastern Queensland, Australia, an urban scheme called SEQWater was created with an aim to connect areas with surplus of water and transport this water to areas facing a shortage [4]. This was done by extensively laying out pipes spanning 532 KM in the region connecting dams, water treatment plants, reservoirs, pumping stations etc. Large scale national level smart grid solutions like Malta’s Enemalta and Singapore’s WaterWise are used to monitor and manage electricity and water usage almost in realtime, identify thefts and leaks, control pricing etc., [5, 6].
The use of Information and Communications Technology (ICT), like with other domains has been gaining some traction for water management. South Korea’s Integrated Water

Resource Management (IWRM) project processes real-time hydrological data like rainfall, water level in rivers & lakes and transmits it to water management centers and dams [7]. This gives them the ability to predict flooding and forecast precipitation.
A large scale implementation of IoT sensors coupled with LoRaWAN communication can be seen in Dubai. Telecom operator du [8] is using it to build a smart city infrastructure which can help the citizens of Dubai better interact with their surroundings and manage city resources. LoRaWAN is being used in a smaller scale to control Street Lights in few of countries, giving a higher degree of control over the amount of light needed and better managing energy requirements [9]. LoRaWAN is also being used in Helsinki for creating smarter parking solutions [10]. Here, the LoRa based system handles the parking payment, parking location, and provides analytics for the city authorities in decision making.
The studies on IoT and LoRaWAN based solutions for urban and rural infrastructure development show the potential of this technology and how critical it can be. Our smart water grid solution is also one such project built with LoRaWAN technology that aim to better utilize the resources provided to us.
III. TECHNOLOGY OVERVIEW
For our system, we have explored various technologies starting form cellular networks to NBIoT. After comparing all our alternatives, we decided on LoRa from the LPWAN family. LPWAN technologies are ideal for devices that need to send minimal data over a long range with particular constraints around power consumption and computational power [3].
Many of the LPWAN solutions perform well in less dense environments – like in less populated cities and rugged outdoor environments. These developments over traditional cellular networks improves suitability for IoT applications – by including the array of low-power, low-bandwidth LTE developments like LTE-MTC, NB-LTE-M, and NB-IoT.
LPWAN technology is used when other wireless networks aren’t a good fit with some case studies. Bluetooth (or BLE), WiFi and ZigBee are often not suited for long-range performance. Cellular M2M networks are costly, consume a lot of power and are expensive to set up. Narrowband IoT (NB‑IoT), also known as LTE Cat is similar to Low Power Wide Area (LPWA) technology and works virtually anywhere. It can be easily set up on existing mobile networks and handles small amounts infrequent bi-directional data communication, securely and reliably. It also provides some of the same advantages as LoRa, such as low power consumption, excellent penetration coverage and lower component costs. LoRa provides additional benefits of lower network setup and maintenance costs due to it being on an unlicensed spectrum communication. This results in easier network setup without any dependencies like existing mobile network availability and very low operational cost.

LoRaWAN networks are star-of-stars topology in which gateways relay messages between node devices and a central network server or cloud in the back-end to store the data. Gateways are connected to the network server via any IP links such as 2G, 3G, 4G dongles or Wi-Fi, whereas end-devices use single-hop LoRaWAN communication to one or many gateways in MAC protocol. All communication is generally bi-directional, although uplink communication from end-devices to the network server is strongly favored. These attributes make a LoRa network structure simple, efficient and robust for IoT communication.
A standard process is followed for uploading the data on the cloud. Additional features of processing the sensor data are built in to the cloud. By applying machine learning algorithms like logistic regression model [11] the quality of water could be visually represented on a gauge. The cloud also facilitates the sending of specific email and SMS alerts to the authorities and helps in real time visualization of the data on our web page.

A. Logistic Regression Model The usage of logistic regression model in our study is
applicable as a two-fold process: First, the logistic regression aids in listing out the sensor parameters based on their significance towards the contribution of water quality. Next, we derive a LogLinear model using the selected list of sensor values for predicting the quality of water in public supply and water flow in canals. The Log-Linear model derived using the logistic regression Y is defined in Eqn. (1). Each of the regression coefficients describe the size of contribution of the sensor values towards the prediction of water quality (between zero and one) depending upon the potability.

Y = β0 + β1 S1,c + β2 S2,c + …. + βn Sn,c

(1)

In which Y is the prediction of usability of the water and S is the sensor values of flow, temperature, salinity, etc., included in the regression; c refers to the Lora module at specific location; βj is the logistic regression coefficient for the corresponding sensor values. The logistic regression model takes real-value sensor inputs and makes a prediction the default class (class 0).If the predicted value is greater than our threshold, we can take the output as a prediction for the other class (class 1). The job of the learning algorithm will be to discover the best values for the coefficients (βj, (0≤j≤n) based on the training data.

IV. CHALLENGES
There were four initial challenges faced during our work on this pilot project. They are listed here for better understanding of the project.
 Distinguishing data collected from each location  Displaying a generalized result which makes sense to
villagers  Creating an auto alert mechanism  Addressing network connectivity issues in the village

Each LoRa module along with its accompanying sensor data needed to be tied to a particular location. Each location in the grid has its own characteristics and the data needs to be processed on the cloud independently. Our early prototypes bundled all the data together before sending it to the cloud. This would give us an indication of water quality issues without us knowing where the issue lied. After numerous iterations, it was decided that each LoRa module would send its data separately with specific location information which could be deciphered from the LoRa device ID.
It is often very hard to comprehend raw sensor data which is displayed on our website. To solve this issue and to predict the water quality, we run a Logistic Regression model [11] which outputs values either zero or one depending on the potability. The gauge value represents the consolidated sensor coefficient values in a meaningful way from the reference of each sensor values. The reference provides a weightage to each sensor value and finally normalizes it to a value between 0 and 100. This way one could glance at the gauge and get a fair idea of the quality of water being served in the region.
The biggest challenge we faced was in the networking part, as the entire village stretches to cover 3 KMs of dense coconut tree foliage and has poor GSM coverage. To keep the cost down and to provide connectivity at a low operational and maintenance cost, we have considered many alternatives. Finally, we settled on employing LoRa technology because it satisfies all the constraints with respect to our requirements. The two main advantages of using LoRa in this study are:
 Signal Propagation – LoRa permits us to alter our signal frequency, thereby allowing us to optimize the signal for the exact scenario in our test area.
 Minimal power consumption – LoRa provides years’ worth of life using simple AA batteries. Alternatively, a solar cell could be connected to the LoRa device, making it have a virtually unlimited lifetime.
V. SYSTEM OVERVIEW
The proposed system consists of various components that continuously monitor the water quality and aid in decision making. The system consists of five major components: water quality sensors, LoRa Nodes, LoRa Gateway, Ericsson cloud and a web portal to visualize this data. Our system has a built in alert triggering mechanism with which various alerts can be triggered to the concerned authorities in case of any changes in water quality or flow. Our modules and gateways are equipped with an ultra-low power consumption medium that works on the LPWAN principle. Fig. 2 provides a detailed overview of the five inherent stages of the proposed system followed by an explanation.
A. Sensors There are 7 standard sensors attached with the Arduino microcontroller as a part of LoRa module for providing various

details about the quality and flow of the water. These sensors are namely ORP, PH, Salinity, Level, Flow, Turbidity and Temperature.

microcontroller extracts the sensor data and transmits it to the LoRa gateway through the attached LoRa RF module. This block can be considered as the main block of the entire system as it gets the real time data from the sensors. The sensors are configured as shown in Fig 2. Each and every sensor node is separately configured with the Microcontroller through its digital pins to get the data out of it. Similarly, LoRa RF Module is interfaced with the Microcontroller to GPIO pins using interfacing connectors and cables to send the data to the LoRa gateway sequentially.

Fig. 1. Overview of Proposed System
1) ORP Sensor - ORP (Oxidation Reduction Potential) is a popular water quality parameter that is normally measured as the voltage between a platinum measuring electrode and a reference electrode [12]. ORP is classically based on a Standard Hydrogen Electrode (SHE) as a reference. This sensor indicates the quality of the water.
2) PH Sensor- A pH Meter is a scientific instrument that measures the hydrogen-ion concentration (or pH) in a solution. This sensor defines the acidity and alkalinity level of the water [12].
3) Salinity Sensor – This sensor measures the level of salt present in the water. Pure water has a high resistance to the flow of electricity whereas salt water has a high electrical conductivity and a salinity sensor works with this principle [13].
4) Level Sensor – Level sensors are ultrasonic sensors which have an acoustic transducer which vibrates at ultrasonic frequencies [14]. The pulses are emitted in a cone-shaped beam aimed at a target object which returns after hitting the target object. The time taken for this beam to return gives us the distance, which is the level of the water in the canal or tank.
5) Turbidity Sensor- Turbidity sensors measure the amount of light that is scattered by the suspended solids in both tank and canal water [15]. As the amount of total suspended solids (TSS) in water increases, the water’s turbidity level (and cloudiness or haziness) also increases.
6) Temperature Sensor- A temperature sensor measures the hotness or coolness of an object. The sensor’s working base is the voltage that’s read across the diode [16]. The temperature rises whenever the voltage increases. This gives the temperature measurement of the water in the canal and tank.
7) Flow sensor – This measures liquid flowing through a pipe or a container by counting the pulses from the output of the sensor. We can easily calculate the flow rate (in liters/hour) using a suitable conversion formula [17].

Fig. 2. Code Snippet – Sensor configuration
As per the code snippet given in Fig 3, we have used LoRa SX 1272 chipset and its relevant library codes to configure the module at 867 MHz as permitted by the Indian Govt. for an unlicensed spectrum communication for LoRa.
Fig. 3. Code Snippet – Packet formation and transmission
Fig 4 shows a simple example of how we interfaced the Ultrasonic Sensor with the microcontroller. Similarly, other sensors can also be interfaced in the same manner. Each sensor’s data is transmitted separately to the microcontroller, packetized and then forwarded to LoRa Gateway.

B. LoRa Module This module consists of 2 main components, an Arduino
Nano Microcontroller and a LoRa RF module. The

Fig. 4. Code Snippet- Standard sensor configuration

C. LoRa Gateway Our LoRa gateway is connected to the network server via
standard IP connection for sending data to the cloud. LoRa modules use single-hop wireless communication to transmit data to the gateways. The LoRa gateway is configured with the LoRa RF modules to get sensor data in the form of packets using simple MAC protocol i.e. it distinguishes each LoRa Module and its packets with the sender module’s unique node address and App_Key.
The LoRa network structure can be easily configured for a range of 3 to 10 KMs by altering the signal frequency. In our pilot project conducted in Mori village spanning around 3 KMs, we configured 3 LoRa modules in the village with a single gateway. Each node first establishes a connection with the gateway and then starts transmitting its data to the cloud. The location of the nodes and the gateway is mapped on Fig 5.
The LoRa gateway is configured with a microcontroller that takes care of storing data, keeping track of connection acknowledgements and giving instructions to the LoRa module. The LoRa gateway is also attached with a GSM 3G dongle to forward the data to Ericsson cloud (Connected with Ericsson Research Lab). GSM connectivity is only needed to store the data into cloud and can be replaced with WIFI or broadband connectivity.

unless the sensor values normalize. This centralized record of data will be analyzed with the prediction model which helps monitor and control the water quality automatically.
Fig. 6. SMS and Email Alert E. Web Page
The web page is connected with the Ericsson cloud to get real time updates from the LoRa gateway is open for everyone to check the water quality. The water quality gauge visually highlights the quality of the water on a scale of 0-100. The web page built using the Google Maps API displays each sensor value based on the LoRa module’s location as shown in Fig 7. The web page can be visited at http://ericssonsmartvillage.com/.

Fig. 7. Web page for Pilot Project

Fig. 5. Mapping LoRa Modules with Gateway in Mori
D. Ericsson Cloud Ericsson Cloud collects and stores the data received from
LoRa gateway and runs prediction models on this data. the data from the gateway is stored in separate channels based on the LoRa module’s device ID (location). The analytical processing on the data is used in the web page for our water quality monitoring gauge as well as to trigger alerts. Alerts are sent to the concerned authorities in the form of SMS and Emails like the ones shown in Fig 6. The system monitors the sensor readings and escalates the situation by alerting a next level authority

VI. RESULTS AND DISCUSSION
We employed the Logistic Regression model to analyze sensor data stored in the cloud for each LoRa module location to show the gauge value (it is a combination of other parameters qualified based on its threshold value) to represent the quality of water. This model helps generate a meaningful score which clearly represents the consolidated view of sensor values related to the present water quality in the tanks and canals of the village in the web page as shown in Fig 7. A sample data set extracted from the sensor database is given in Fig 8.
From the dataset stored in the cloud, we run Logistic regression model using Weka package [11] to get regression coefficient for the corresponding sensor values and to show the same in Fig 9. Using the test set of size 250, we found that 99%

of the values are correctly classified to predict the potability of the water in the tank and canals as shown in Fig 9.

We are also interested to work out and compare with other communication protocols like MQTT, COAP to measure the efficiency in communication. This can make our proposed system compatible and integrate with other IoT systems for running different use cases relevant to the society. Furthermore, the designed system can be rebuilt with Ericsson AppIoT framework to improve its security and scalability. Our system can easily scale to all the villages of Andhra Pradesh for implementing water grid system to uplift the society.

Fig. 8. Sample data set
For example, LoRa module installed in the Salt Lake location deals with only 4 sensors (pH, ORP, Salinity and Turbidity) and based on the logistic regression model, Eqn. (1) can be rewritten as Y = 10.5815 + 0.0556 S1,3 – 0.001 S2,3 – 0.0082 S3,3 – 5.5919 S4,3
Fig. 9.Calculation of Regression Coefficients
VII. CONCLUSION AND FUTURE WORK The continuous innovations in technology are to make human life simpler and efficient. IoT devices are in pole position to create meaningful solutions due to their simplicity and versatility. In particular, low power devices like LoRa and its implementations in various fields are very exciting because of the specific use cases and the longevity these devices offer. We have also used LoRa paired with sensors in our Smart Water Grid project to check the water quality in Mori Village. The prediction model run on the cloud for the sensor data shows a high level of accuracy in predicting the potability of water. An implementation of our low power IoT based water grid solution showed us the potential of such a project and we hope that such projects can be implemented all over the world, starting with Mori and its neighboring villages and towns.

REFERENCES
[1] NG Hegde, Water scarcity and security in India, Internet: http://www.indiawaterportal.org/articles/water-scarcity-and-security-india, 03 April 2012
[2] A Kumar, J. Sengupta and Y. Liu., 3GPP LTE: The Future of Mobile Broadband”, Wireless Personal Communication, 62, issue 3, (Feb 2012): 671-686, Springer
[3] Aloÿs Augustin, Jiazi Yi, Thomas Clausen and William Mark Townsley, “A Study of LoRa: Long Range & Low Power Networks for the Internet of Things,”, Sensors, 16, Issue 9 ( September 2016).
[4] Hary Goldstein, “South East Queensland Water Strategy”, The State of Queensland (Queensland Water Commission) report, 2010
[5] Malta’s Smart Grid Solution, Internet: http://spectrum.ieee.org/energy/environment/maltas-smart-grid-solution, 28 May 2010 [06 Feb 2017]
[6] Allen, Michael, Ami Preis, Mudasser Iqbal and Andrew J. Whittle. “Case Study: a Smart Water Grid in Singapore.” Water Practice & Technology 7, no. 4 (November 26, 2012): 1–8.
[7] G.W. Choi, K.Y. Chong, S.J. Kim and T.S. Ryu “SWMI: new paradigm of water resources management for SDGs”, Smart Water, 1, no. 3, Dec. 2016, Springer
[8] “du brings Internet of Things to life with LoRa demos at Gitex,” Internet: http://www.du.ae/about-us/media-centre/newsdetail/2015/10/22/du-bringsinternet-of-things-to-life-with-lora-demos-at-gitex, 22 October 2015
[9] “inteliLIGHT LoRa streetlight controller, implemented in 28 countries on 4 continents” http://intelilight.eu/blog/2016/07/13/intelilight-lora-streetlightcontroller-implemented-28-countries-4-continents/, July 13, 2016
[10] S. Charles, “The design and implementation of a smart-parking system for Helsinki Area”, Aalto University Library, Aug, 2016
[11] M. Hall, E.Frank, G. Holmes, B. Pfahringer, P. Reutemann, and I.H. Witten. The WEKA Data Mining Software: An Update. SIGKDD Explorations, Volume 11, Issue 1, 2009.
[12] Yokogawa – “Back to the pHuture - pH and ORP learning Hand Book”, Yokogawa Electric Corporation, First edition 2014
[13] S. Bhat, "Salinity (conductivity) sensor based on parallel plate capacitors", Graduate Theses and Dissertations, Scholar Commons, University of South Florida,2005
[14] How Liquid Level Sensors Work - http://www.tc-fluidcontrol.com/aboutus/blog-posts/how-liquid-level-sensors-work/ [06 Feb 2017]
[15] Abhimanyu Mathur “Insight - Learn the Working of a Turbidity Sensor” Internet: http://www.engineersgarage.com/insight/how-turbidity-sensorworks
[16] Convectronics, “Temperature Sensors: General Operating Principles”, NIST.
[17] T.K. Hareendran “Working with Water Flow Sensors & Arduino” Internet: http://www.electroschematics.com/12145/working-with-water-flowsensors-arduino/

